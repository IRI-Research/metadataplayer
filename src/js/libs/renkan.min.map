{"version":3,"file":"renkan.min.js","sources":["templates.js","../../js/main.js","../../js/router.js","../../js/dataloader.js","../../js/models.js","../../js/defaults.js","../../js/i18n.js","../../js/full-json.js","../../js/save-once.js","../../js/ldtjson-bin.js","../../js/list-bin.js","../../js/wikipedia-bin.js","paper-renderer.js"],"names":["this","obj","__t","__p","_","escape","__e","Array","prototype","join","renkan","translate","edge","title","options","show_edge_editor_uri","uri","properties","length","each","ontology","label","property","show_edge_editor_style","show_edge_editor_style_color","show_edge_editor_style_dash","dash","show_edge_editor_style_thickness","thickness","show_edge_editor_style_arrow","arrow","show_edge_editor_direction","show_edge_editor_nodes","from_color","shortenText","from_title","to_title","show_edge_editor_creator","has_creator","created_by_title","show_edge_tooltip_color","color","show_edge_tooltip_uri","short_uri","show_edge_tooltip_nodes","to_color","show_edge_tooltip_creator","created_by_color","Rkns","Utils","getFullURL","image","description","static_url","url","show_bins","show_editor","node","show_node_editor_uri","change_types","types","type","charAt","toUpperCase","substring","show_node_editor_description","show_node_editor_description_richtext","show_node_editor_size","size","show_node_editor_style","show_node_editor_style_color","show_node_editor_style_dash","show_node_editor_style_thickness","show_node_editor_image","image_placeholder","clip_path","allow_image_upload","show_node_editor_creator","change_shapes","shapes","shape","show_node_tooltip_color","show_node_tooltip_uri","show_node_tooltip_description","show_node_tooltip_image","show_node_tooltip_creator","_id","print","__j","call","arguments","show_top_bar","editor_mode","project","get","show_user_list","show_user_color","user_color_editable","colorPicker","home_button_url","home_button_title","show_fullscreen_button","show_addnode_button","show_addedge_button","show_export_button","show_save_button","show_open_button","show_bookmarklet","show_search_field","resize","show_zoom","save_view","hide_nodes","root","$","jQuery","pickerColors","__renkans","_BaseBin","_renkan","_opts","find","hide","addClass","appendTo","title_icon_$","_this","attr","href","html","click","destroy","slideDown","resizeBins","refresh","count_$","title_$","main_$","auto_refresh","window","setInterval","detach","Renkan","push","defaults","templates","renkanJST","node_editor_templates","template","types_templates","value","key","property_files","f","getJSON","data","concat","read_only","router","Router","Models","Project","dataloader","DataLoader","Loader","setCurrentUser","user_id","user_name","addUser","current_user","renderer","redrawUsers","container","tabs","search_engines","current_user_list","UsersList","on","_tmpl","map","c","Renderer","Scene","search","_select","_input","_form","_search","_key","Search","getSearchTitle","className","getBgClass","_el","setSearchEngine","submit","val","search_engine","mouseenter","mouseleave","bins","_bin","Bin","elementDropped","_mainDiv","siblings","is","slideUp","_e","_t","_models","where","_model","highlightModel","mouseout","unhighlightAll","e","dragDrop","err","preventDefault","touch","originalEvent","changedTouches","off","canvas_$","offset","w","width","h","height","pageX","left","pageY","top","onMouseMove","div","document","createElement","appendChild","cloneNode","dropData","text/html","innerHTML","onMouseDown","onMouseUp","dataTransfer","setData","lastsearch","lastval","regexpFromTextOrArray","source","tab","render","_text","i18n","language","substr","onStatusChange","listClasses","split","classes","i","_d","outerHeight","css","getUUID4","replace","r","Math","random","v","toString","getUID","pad","n","Date","ID_AUTO_INCREMENT","ID_BASE","getUTCFullYear","getUTCMonth","getUTCDate","_base","_n","_uidbase","test","img","Image","src","res","inherit","_baseClass","_callbefore","_class","_arg","apply","slice","_init","_initialized","extend","replaceText","makeReplaceFunc","l","k","charsrx","txt","toLowerCase","remrx","j","remsrc","charsub","getSource","inp","removeChars","String","fromCharCode","RegExp","_textOrArray","testrx","replacerx","isempty","_replace","text","_MIN_DRAG_DISTANCE","_NODE_BUTTON_WIDTH","_EDGE_BUTTON_INNER","_EDGE_BUTTON_OUTER","_CLICKMODE_ADDNODE","_CLICKMODE_STARTEDGE","_CLICKMODE_ENDEDGE","_NODE_SIZE_STEP","LN2","_MIN_SCALE","_MAX_SCALE","_MOUSEMOVE_RATE","_DOUBLETAP_DELAY","_DOUBLETAP_DISTANCE","_USER_PLACEHOLDER","default_user_color","_BOOKMARKLET_CODE","_maxlength","drawEditBox","_options","_coords","_path","_xmargin","_selector","tooltip_width","tooltip_padding","_height","_isLeft","x","paper","view","center","_left","tooltip_arrow_length","_right","_top","y","tooltip_margin","max","tooltip_arrow_width","min","_bottom","segments","point","add","fillColor","Color","Gradient","tooltip_top_color","tooltip_bottom_color","increaseBrightness","hex","percent","parseInt","g","b","Backbone","routes","index","parameters","result","forEach","part","item","decodeURIComponent","trigger","converters","from1to2","len","nodes","style","edges","schema_version","dataConverters","convert","schemaVersionFrom","getSchemaVersion","schemaVersionTo","converterName","load","set","validate","guid","RenkanModel","RelationalModel","idAttribute","constructor","id","prepare","addReference","_propName","_list","_default","_element","User","toJSON","Node","relations","HasOne","relatedModel","created_by","position","Edge","from","to","View","isArray","zoom_level","hidden_nodes","RosterUser","blacklist","HasMany","reverseRelation","includeInJSON","_props","_user","findOrCreate","addNode","_node","addEdge","_edge","addView","_view","removeNode","remove","removeEdge","_project","users","views","_item","t","version","initialize","filter","json","clone","attributes","Model","Collection","omit","site_id","model","navigator","userLanguage","popup_editor","editor_panel","manual_save","size_bug_fix","force_resize","allow_double_click","zoom_on_scroll","element_delete_delay","autoscale_padding","default_view","default_index_view","update_url","user_name_editable","show_minimap","minimap_width","minimap_height","minimap_padding","minimap_background_color","minimap_border_color","minimap_highlight_color","minimap_highlight_weight","buttons_background","buttons_label_color","buttons_label_font_size","ghost_opacity","default_dash_array","show_node_circles","clip_node_images","node_images_fill_mode","node_size_base","node_stroke_width","node_stroke_max_width","selected_node_stroke_width","selected_node_stroke_max_width","node_stroke_witdh_scale","node_fill_color","highlighted_node_fill_color","node_label_distance","node_label_max_length","label_untitled_nodes","default","video","edge_stroke_width","edge_stroke_max_width","selected_edge_stroke_width","selected_edge_stroke_max_width","edge_stroke_witdh_scale","edge_label_distance","edge_label_max_length","edge_arrow_length","edge_arrow_width","edge_arrow_max_width","edge_gap_in_bundles","label_untitled_edges","tooltip_border_color","tooltip_border_width","tooltip_opacity","richtext_editor_config","toolbarGroups","name","groups","removePlugins","uploaded_image_max_kb","fr","Edit Node","Edit Edge","Title:","URI:","Description:","From:","To:","Image URL:","Choose Image File:","Full Screen","Add Node","Add Edge","Save Project","Open Project","Auto-save enabled","Connection lost","Created by:","Zoom In","Zoom Out","Edit","Remove","Cancel deletion","Link to another node","Enlarge","Shrink","Click on the background canvas to add a node","Click on a first node to start the edge","Click on a second node to complete the edge","Wikipedia","Wikipedia in ","French","English","Japanese","Untitled project","Lignes de Temps","Loading, please wait","Edge color:","Dash:","Thickness:","Arrow:","Node color:","Choose color","Change edge direction","Do you really wish to remove node ","Do you really wish to remove edge ","This file is not an image","Image size must be under ","Size:","KB","Choose from vocabulary:","SKOS Documentation properties","has note","has example","has definition","SKOS Semantic relations","has broader","has narrower","has related","Dublin Core Metadata","has contributor","covers","created by","has date","published by","has source","has subject","Dragged resource","Search the Web","Search in Bins","Close bin","Refresh bin","(untitled)","Select contents:","Drag items from this website, drop them in Renkan","Drag this button to your bookmark bar. When on a third-party website, click it to enable drag-and-drop from the website to Renkan.","Shapes available","Circle","Square","Diamond","Hexagone","Ellipse","Star","Cloud","Triangle","Zoom Fit","Download Project","Save view","View saved view","Renkan 'Drag-to-Add' bookmarklet","(unknown user)","<unknown user>","Search in graph","Search in ","jsonIO","_proj","http_method","_load","redrawActive","loadingStatus","_data","saveStatus","_save","ajax","contentType","JSON","stringify","success","textStatus","jqXHR","_thrSave","throttle","setTimeout","changedAttributes","hasChanged","jsonIOSaveOnClick","_saveWarn","_onLeave","getdata","rx","matches","location","hash","match","beforeSend","_checkLeave","removeClass","save","hasClass","Ldt","ProjectBin","ldt_type","Resclass","console","error","tagTemplate","annotationTemplate","proj_id","project_id","ldt_platform","searchbase","highlight","convertTC","_ms","_res","_totalSeconds","abs","floor","_hours","_minutes","_seconds","_html","_projtitle","meta","count","tags","_tag","_title","htitle","encodedtitle","encodeURIComponent","annotations","_annotation","_description","content","_duration","end","begin","_img","hdescription","start","duration","mediaid","media","annotationid","show","dataType","lang","_q","ResultsBin","segmentTemplate","max_results","highlightrx","objects","_segment","_begin","start_ts","_end","iri_id","element_id","format","q","limit","ResourceList","resultTemplate","list","trim","_match","langs","en","ja","query","_result","encodeURI","snippet","define","_BaseRepresentation","_renderer","_changeBinding","redraw","change","_removeBinding","removeRepresentation","defer","_selectBinding","select","_unselectBinding","unselect","_super","_func","moveTo","unhighlight","mousedown","mouseup","getUtils","getRenderer","requtils","BaseRepresentation","_BaseButton","_pos","sector","_newTarget","source_representation","cloud_path","builders","circle","getShape","Path","getImageShape","radius","rectangle","Rectangle","ellipse","polygon","RegularPolygon","diamond","d","SQRT2","rotate","star","cloud","path","scale","triangle","svg","ShapeBuilder","NodeRepr","node_layer","activate","buildShape","hidden","ghost","strokeWidth","h_ratio","labels_$","normal_buttons","NodeEditButton","NodeRemoveButton","NodeLinkButton","NodeEnlargeButton","NodeShrinkButton","NodeHideButton","NodeShowButton","pending_delete_buttons","NodeRevertButton","all_buttons","active_buttons","last_circle_radius","minimap","minimap_circle","__representation","miniframe","node_group","addChild","_getStrokeWidth","has","_getSelectedStrokeWidth","changed","shapeBuilder","sendToBack","_model_coords","Point","_baseRadius","exp","is_dragging","paper_coords","toPaperCoords","circle_radius","setSectorSize","node_image","subtract","image_delta","multiply","old_act_btn","opacity","dashArray","selected","isEditable","highlighted","_strokeWidth","_color","_dash","strokeColor","_pc","lastImage","showImage","minipos","toMinimapCoords","miniradius","minisize","Size","fitBounds","dontRedrawEdges","ed","repr","getRepresentationByModel","from_representation","to_representation","_image","image_cache","clipPath","hasClipPath","_clip","baseRadius","centerPoint","instructions","lastCoords","minX","Infinity","minY","maxX","maxY","transformCoords","tabc","relative","newCoords","parseFloat","isY","instr","coords","lineTo","cubicCurveTo","quadraticCurveTo","_raster","Raster","locked","Group","clipped","_circleClip","divide","insertAbove","paperShift","_delta","openEditor","removeRepresentationsOfType","_editor","addRepresentation","draw","_uri","showNeighbors","hideButtons","buttons_timeout","undefined","hideNeighbors","indexNode","hiddenNodes","indexOf","splice","textToReplace","hlvalue","throttledPaperDraw","saveCoords","toModelCoords","_event","_isTouch","unselectAll","click_target","edge_layer","bundle","addToBundles","line","arrow_scale","pivot","arrow_angle","EdgeEditButton","EdgeRemoveButton","EdgeRevertButton","minimap_line","_getArrowScale","_opacity","_arrow_scale","_p0a","_p1a","_v","_r","_u","_ortho","_group_pos","getPosition","_p0b","_p1b","_a","angle","_textdelta","_handle","visible","handleIn","handleOut","bounds","_textpos","transform","-moz-transform","-webkit-transform","text_angle","reject","TempEdge","_p0","_p1","end_pos","_c","_hitResult","hitTest","findTarget","_endDrag","_target","_destmodel","_BaseEditor","buttons_layer","editor_block","_pts","range","editor_$","BaseEditor","NodeEditor","readOnlyTemplate","_created_by","_template","_image_placeholder","_size","keys","editorInstance","ckeditor","closeEditor","cleanEditor","editor","focusManager","blur","onFieldChange","checkDirty","getData","resetDirty","assign","keyCode","files","FileReader","alert","onload","target","readAsDataURL","focus","_picker","hover","shiftSize","_newsize","shiftThickness","_oldThickness","_newThickness","titlehtml","EdgeEditor","_from_model","_to_model","BaseButton","_NodeButton","sectorInner","lastSectorInner","drawSector","startAngle","endAngle","imageName","clearTimeout","NodeButton","delid","delete_list","time","valueOf","confirm","addHiddenNode","unset","_off","_point","addTempEdge","MiniFrame","filesaver","representations","notif_$","setup","totalScroll","mouse_down","selected_target","Layer","background_layer","topleft","bottomRight","cliprectangle","bundles","click_mode","_allowScroll","_originalScale","_zooming","_lastTapX","_lastTapY","icon_cache","imgname","throttledMouseMove","mousemove","mousewheel","onScroll","touchstart","_touches","touches","_lastTap","pow","onDoubleClick","touchmove","_newScale","_scaleRatio","_newOffset","setScale","touchend","dblclick","dragover","dragenter","dragleave","drop","parse","bindClick","selector","fname","evt","fadeIn","delay","fadeOut","mouseover","onResize","_ratio","newWidth","newHeight","ratioH","delta","ratioW","resizeZoom","_thRedraw","addRepresentations","_thRedrawUsers","history","el","_params","_delay","fixSize","autoScale","$cpwrapper","$cplist","$this","rxs","_now","findWhere","delete_scheduled","rescaleMinimap","last","_repr","_inR","_outR","_startAngle","_endAngle","_padding","_imgname","_caption","_startRads","PI","_endRads","_startdx","sin","_startdy","cos","_startXIn","_startYIn","_startXOut","_startYOut","_enddx","_enddy","_endXIn","_endYIn","_endXOut","_endYOut","_centerR","_centerRads","_centerX","_centerY","_centerXIn","_centerXOut","_centerYIn","_centerYOut","_textX","_textY","arcTo","closed","PointText","characterStyle","fontSize","paragraphStyle","justification","_visible","_restPos","_grp","_imgdelta","_currentPos","_edgeRepr","_bundle","_er","_dir","savebtn","tip","redrawMiniframe","bottomright","_xx","_yy","_minx","_miny","_maxx","_maxy","_scale","at","_type","RendererType","_collection","userTemplate","allUsers","models","ulistHtml","$userpanel","$name","$cpitems","$colorsquare","$input","empty","parent","background","_representation","_representations","_from","_tmpEdge","last_point","updateUrl","_scrolldelta","SQRT1_2","open","defaultDropHandler","newNode","tweetdiv","_svgimgs","_svgpaths","_imgs","_as","fields","drop_enhancer","jsondata","drop_handler","_nodedata","fullScreen","_isFull","mozFullScreen","webkitIsFullScreen","_requestMethods","_cancelMethods","widthAft","heightAft","viewSize","addNodeBtn","addEdgeBtn","exportProject","projectJSON","projectId","fileNameToSaveAs","space_id","objId","idsMap","projectJSONStr","blob","Blob","isEmptyObject","validViewIndex","viewIndex","viewParams","params","init","idNode","_index","validIndex","foldBins","sizeAft","foldBinsButton","sizeBef","animate","ViewRepr","initialScale","showNodes","hideNodes","hideNode","_offset","zoomOut","zoomIn","_scaleWidth","_scaleHeight","force_view","getFragment","round","navigate","param","require","config","paths","jquery","underscore","ckeditor-core","ckeditor-jquery","shim","deps","startRenkan"],"mappings":"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","sourcesContent":["this[\"renkanJST\"] = this[\"renkanJST\"] || {};\n\nthis[\"renkanJST\"][\"templates/colorpicker.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<li data-color=\"' +\n((__t = (c)) == null ? '' : __t) +\n'\" style=\"background: ' +\n((__t = (c)) == null ? '' : __t) +\n'\"></li>';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/edgeeditor.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n    <span class=\"Rk-CloseX\">&times;</span>' +\n__e(renkan.translate(\"Edit Edge\")) +\n'</span>\\n</h2>\\n<p>\\n    <label>' +\n__e(renkan.translate(\"Title:\")) +\n'</label>\\n    <input class=\"Rk-Edit-Title\" type=\"text\" value=\"' +\n__e(edge.title) +\n'\" />\\n</p>\\n';\n if (options.show_edge_editor_uri) { ;\n__p += '\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"URI:\")) +\n'</label>\\n        <input class=\"Rk-Edit-URI\" type=\"text\" value=\"' +\n__e(edge.uri) +\n'\" />\\n        <a class=\"Rk-Edit-Goto\" href=\"' +\n__e(edge.uri) +\n'\" target=\"_blank\"></a>\\n    </p>\\n    ';\n if (options.properties.length) { ;\n__p += '\\n        <p>\\n            <label>' +\n__e(renkan.translate(\"Choose from vocabulary:\")) +\n'</label>\\n            <select class=\"Rk-Edit-Vocabulary\">\\n                ';\n _.each(options.properties, function(ontology) { ;\n__p += '\\n                    <option class=\"Rk-Edit-Vocabulary-Class\" value=\"\">\\n                        ' +\n__e( renkan.translate(ontology.label) ) +\n'\\n                    </option>\\n                    ';\n _.each(ontology.properties, function(property) { var uri = ontology[\"base-uri\"] + property.uri; ;\n__p += '\\n                        <option class=\"Rk-Edit-Vocabulary-Property\" value=\"' +\n__e( uri ) +\n'\"\\n                            ';\n if (uri === edge.uri) { ;\n__p += ' selected';\n } ;\n__p += '>\\n                            ' +\n__e( renkan.translate(property.label) ) +\n'\\n                        </option>\\n                    ';\n }) ;\n__p += '\\n                ';\n }) ;\n__p += '\\n            </select>\\n        </p>\\n';\n } } ;\n__p += '\\n';\n if (options.show_edge_editor_style) { ;\n__p += '\\n    <div class=\"Rk-Editor-p\">\\n      ';\n if (options.show_edge_editor_style_color) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-color\">\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Edge color:\")) +\n'</span>\\n        <div class=\"Rk-Edit-ColorPicker-Wrapper\">\\n            <span class=\"Rk-Edit-Color\" style=\"background: &lt;%-edge.color%>;\">\\n                <span class=\"Rk-Edit-ColorTip\"></span>\\n            </span>\\n            ' +\n((__t = ( renkan.colorPicker )) == null ? '' : __t) +\n'\\n            <span class=\"Rk-Edit-ColorPicker-Text\">' +\n__e( renkan.translate(\"Choose color\") ) +\n'</span>\\n        </div>\\n      </div>\\n      ';\n } ;\n__p += '\\n      ';\n if (options.show_edge_editor_style_dash) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-dash\">\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Dash:\")) +\n'</span>\\n        <input type=\"checkbox\" name=\"Rk-Edit-Dash\" class=\"Rk-Edit-Dash\" ' +\n__e( edge.dash ) +\n' />\\n      </div>\\n      ';\n } ;\n__p += '\\n      ';\n if (options.show_edge_editor_style_thickness) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-thickness\">\\n          <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Thickness:\")) +\n'</span>\\n          <a href=\"#\" class=\"Rk-Edit-Size-Btn\" id=\"Rk-Edit-Thickness-Down\">-</a>\\n          <span class=\"Rk-Edit-Size-Disp\" id=\"Rk-Edit-Thickness-Value\">' +\n__e( edge.thickness ) +\n'</span>\\n          <a href=\"#\" class=\"Rk-Edit-Size-Btn\" id=\"Rk-Edit-Thickness-Up\">+</a>\\n      </div>\\n      ';\n } ;\n__p += '\\n      ';\n if (options.show_edge_editor_style_arrow) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-arrow\">\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Arrow:\")) +\n'</span>\\n        <input type=\"checkbox\" name=\"Rk-Edit-Arrow\" class=\"Rk-Edit-Arrow\" ' +\n__e( edge.arrow ) +\n' />\\n      </div>\\n      ';\n } ;\n__p += '\\n    </div>\\n';\n } ;\n__p += '\\n';\n if (options.show_edge_editor_direction) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Edit-Direction\">' +\n__e( renkan.translate(\"Change edge direction\") ) +\n'</span>\\n    </p>\\n';\n } ;\n__p += '\\n';\n if (options.show_edge_editor_nodes) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"From:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e(edge.from_color) +\n';\"></span>\\n        ' +\n__e( shortenText(edge.from_title, 25) ) +\n'\\n    </p>\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"To:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: >%-edge.to_color%>;\"></span>\\n        ' +\n__e( shortenText(edge.to_title, 25) ) +\n'\\n    </p>\\n';\n } ;\n__p += '\\n';\n if (options.show_edge_editor_creator && edge.has_creator) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Created by:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: &lt;%-edge.created_by_color%>;\"></span>\\n        ' +\n__e( shortenText(edge.created_by_title, 25) ) +\n'\\n    </p>\\n';\n } ;\n__p += '\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/edgeeditor_readonly.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n    <span class=\"Rk-CloseX\">&times;</span>\\n    ';\n if (options.show_edge_tooltip_color) { ;\n__p += '\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e( edge.color ) +\n';\"></span>\\n    ';\n } ;\n__p += '\\n    <span class=\"Rk-Display-Title\">\\n        ';\n if (edge.uri) { ;\n__p += '\\n            <a href=\"' +\n__e(edge.uri) +\n'\" target=\"_blank\">\\n        ';\n } ;\n__p += '\\n        ' +\n__e(edge.title) +\n'\\n        ';\n if (edge.uri) { ;\n__p += ' </a> ';\n } ;\n__p += '\\n    </span>\\n</h2>\\n';\n if (options.show_edge_tooltip_uri && edge.uri) { ;\n__p += '\\n    <p class=\"Rk-Display-URI\">\\n        <a href=\"' +\n__e(edge.uri) +\n'\" target=\"_blank\">' +\n__e( edge.short_uri ) +\n'</a>\\n    </p>\\n';\n } ;\n__p += '\\n<p>' +\n((__t = (edge.description)) == null ? '' : __t) +\n'</p>\\n';\n if (options.show_edge_tooltip_nodes) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"From:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e( edge.from_color ) +\n';\"></span>\\n        ' +\n__e( shortenText(edge.from_title, 25) ) +\n'\\n    </p>\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"To:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e( edge.to_color ) +\n';\"></span>\\n        ' +\n__e( shortenText(edge.to_title, 25) ) +\n'\\n    </p>\\n';\n } ;\n__p += '\\n';\n if (options.show_edge_tooltip_creator && edge.has_creator) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Created by:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e( edge.created_by_color ) +\n';\"></span>\\n        ' +\n__e( shortenText(edge.created_by_title, 25) ) +\n'\\n    </p>\\n';\n } ;\n__p += '\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/ldtjson-bin/annotationtemplate.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<li class=\"Rk-Bin-Item\" draggable=\"true\"\\n    data-image=\"' +\n__e( Rkns.Utils.getFullURL(image) ) +\n'\"\\n    data-uri=\"' +\n((__t = (ldt_platform)) == null ? '' : __t) +\n'ldtplatform/ldt/front/player/' +\n((__t = (mediaid)) == null ? '' : __t) +\n'/#id=' +\n((__t = (annotationid)) == null ? '' : __t) +\n'\"\\n    data-title=\"' +\n__e(title) +\n'\" data-description=\"' +\n__e(description) +\n'\">\\n\\n    <img class=\"Rk-Ldt-Annotation-Icon\" src=\"' +\n((__t = (image)) == null ? '' : __t) +\n'\" />\\n    <h4>' +\n((__t = (htitle)) == null ? '' : __t) +\n'</h4>\\n    <p>' +\n((__t = (hdescription)) == null ? '' : __t) +\n'</p>\\n    <p>Start: ' +\n((__t = (start)) == null ? '' : __t) +\n', End: ' +\n((__t = (end)) == null ? '' : __t) +\n', Duration: ' +\n((__t = (duration)) == null ? '' : __t) +\n'</p>\\n    <div class=\"Rk-Clear\"></div>\\n</li>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/ldtjson-bin/segmenttemplate.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<li class=\"Rk-Bin-Item\" draggable=\"true\"\\n    data-image=\"' +\n__e( Rkns.Utils.getFullURL(image) ) +\n'\"\\n    data-uri=\"' +\n((__t = (ldt_platform)) == null ? '' : __t) +\n'ldtplatform/ldt/front/player/' +\n((__t = (mediaid)) == null ? '' : __t) +\n'/#id=' +\n((__t = (annotationid)) == null ? '' : __t) +\n'\"\\n    data-title=\"' +\n__e(title) +\n'\" data-description=\"' +\n__e(description) +\n'\">\\n\\n    <img class=\"Rk-Ldt-Annotation-Icon\" src=\"' +\n((__t = (image)) == null ? '' : __t) +\n'\" />\\n    <h4>' +\n((__t = (htitle)) == null ? '' : __t) +\n'</h4>\\n    <p>' +\n((__t = (hdescription)) == null ? '' : __t) +\n'</p>\\n    <p>Start: ' +\n((__t = (start)) == null ? '' : __t) +\n', End: ' +\n((__t = (end)) == null ? '' : __t) +\n', Duration: ' +\n((__t = (duration)) == null ? '' : __t) +\n'</p>\\n    <div class=\"Rk-Clear\"></div>\\n</li>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/ldtjson-bin/tagtemplate.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<li class=\"Rk-Bin-Item\" draggable=\"true\"\\n    data-image=\"' +\n__e( Rkns.Utils.getFullURL(static_url+'img/ldt-tag.png') ) +\n'\"\\n    data-uri=\"' +\n((__t = (ldt_platform)) == null ? '' : __t) +\n'ldtplatform/ldt/front/search/?search=' +\n((__t = (encodedtitle)) == null ? '' : __t) +\n'&field=all\"\\n    data-title=\"' +\n__e(title) +\n'\" data-description=\"Tag \\'' +\n__e(title) +\n'\\'\">\\n\\n    <img class=\"Rk-Ldt-Tag-Icon\" src=\"' +\n__e(static_url) +\n'img/ldt-tag.png\" />\\n    <h4>' +\n((__t = (htitle)) == null ? '' : __t) +\n'</h4>\\n    <div class=\"Rk-Clear\"></div>\\n</li>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/list-bin.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<li class=\"Rk-Bin-Item Rk-ResourceList-Item\" draggable=\"true\"\\n    data-uri=\"' +\n__e(url) +\n'\" data-title=\"' +\n__e(title) +\n'\"\\n    data-description=\"' +\n__e(description) +\n'\"\\n    ';\n if (image) { ;\n__p += '\\n        data-image=\"' +\n__e( Rkns.Utils.getFullURL(image) ) +\n'\"\\n    ';\n } else { ;\n__p += '\\n        data-image=\"\"\\n    ';\n } ;\n__p += '\\n>';\n if (image) { ;\n__p += '\\n    <img class=\"Rk-ResourceList-Image\" src=\"' +\n__e(image) +\n'\" />\\n';\n } ;\n__p += '\\n<h4 class=\"Rk-ResourceList-Title\">\\n    ';\n if (url) { ;\n__p += '\\n        <a href=\"' +\n__e(url) +\n'\" target=\"_blank\">\\n    ';\n } ;\n__p += '\\n    ' +\n((__t = (htitle)) == null ? '' : __t) +\n'\\n    ';\n if (url) { ;\n__p += '</a>';\n } ;\n__p += '\\n    </h4>\\n    ';\n if (description) { ;\n__p += '\\n        <p class=\"Rk-ResourceList-Description\">' +\n((__t = (hdescription)) == null ? '' : __t) +\n'</p>\\n    ';\n } ;\n__p += '\\n    ';\n if (image) { ;\n__p += '\\n        <div style=\"clear: both;\"></div>\\n    ';\n } ;\n__p += '\\n</li>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/main.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n\n if (options.show_bins) { ;\n__p += '\\n    <div class=\"Rk-Bins\">\\n        <div class=\"Rk-Bins-Head\">\\n            <h2 class=\"Rk-Bins-Title\">' +\n__e( translate(\"Select contents:\")) +\n'</h2>\\n            <form class=\"Rk-Web-Search-Form Rk-Search-Form\">\\n                <input class=\"Rk-Web-Search-Input Rk-Search-Input\" type=\"search\"\\n                    placeholder=\"' +\n__e( translate('Search the Web') ) +\n'\" />\\n                <div class=\"Rk-Search-Select\">\\n                    <div class=\"Rk-Search-Current\"></div>\\n                    <ul class=\"Rk-Search-List\"></ul>\\n                </div>\\n                <input type=\"submit\" value=\"\"\\n                    class=\"Rk-Web-Search-Submit Rk-Search-Submit\" title=\"' +\n__e( translate('Search the Web') ) +\n'\" />\\n            </form>\\n            <form class=\"Rk-Bins-Search-Form Rk-Search-Form\">\\n                <input class=\"Rk-Bins-Search-Input Rk-Search-Input\" type=\"search\"\\n                    placeholder=\"' +\n__e( translate('Search in Bins') ) +\n'\" /> <input\\n                    type=\"submit\" value=\"\"\\n                    class=\"Rk-Bins-Search-Submit Rk-Search-Submit\"\\n                    title=\"' +\n__e( translate('Search in Bins') ) +\n'\" />\\n            </form>\\n        </div>\\n        <ul class=\"Rk-Bin-List\"></ul>\\n    </div>\\n';\n } ;\n__p += ' ';\n if (options.show_editor) { ;\n__p += '\\n    <div class=\"Rk-Render Rk-Render-';\n if (options.show_bins) { ;\n__p += 'Panel';\n } else { ;\n__p += 'Full';\n } ;\n__p += '\"></div>\\n';\n } ;\n__p += '\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/nodeeditor.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n\n //TODO: change class to id ;\n__p += '\\n<h2>\\n    <span class=\"Rk-CloseX\">&times;</span>' +\n__e(renkan.translate(\"Edit Node\")) +\n'</span>\\n</h2>\\n<p>\\n    <label>' +\n__e(renkan.translate(\"Title:\")) +\n'</label>\\n    <input class=\"Rk-Edit-Title\" type=\"text\" value=\"' +\n__e(node.title) +\n'\" />\\n</p>\\n';\n if (options.show_node_editor_uri) { ;\n__p += '\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"URI:\")) +\n'</label>\\n        <input class=\"Rk-Edit-URI\" type=\"text\" value=\"' +\n__e(node.uri) +\n'\" />\\n        <a class=\"Rk-Edit-Goto\" href=\"' +\n__e(node.uri) +\n'\" target=\"_blank\"></a>\\n    </p>\\n';\n } ;\n__p += ' ';\n if (options.change_types) { ;\n__p += '\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"Types available\")) +\n':</label>\\n        <select class=\"Rk-Edit-Type\">\\n          ';\n _.each(types, function(type) { ;\n__p += '\\n            <option class=\"Rk-Edit-Vocabulary-Property\" value=\"' +\n__e( type ) +\n'\"';\n if (node.type === type) { ;\n__p += ' selected';\n } ;\n__p += '>\\n                ' +\n__e( renkan.translate(type.charAt(0).toUpperCase() + type.substring(1)) ) +\n'\\n            </option>\\n          ';\n }); ;\n__p += '\\n        </select>\\n    </p>\\n';\n } ;\n__p += ' ';\n if (options.show_node_editor_description) { ;\n__p += '\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"Description:\")) +\n'</label>\\n        ';\n if (options.show_node_editor_description_richtext) { ;\n__p += '\\n            <div class=\"Rk-Edit-Description\" contenteditable=\"true\">' +\n((__t = (node.description)) == null ? '' : __t) +\n'</div>\\n        ';\n } else { ;\n__p += '\\n            <textarea class=\"Rk-Edit-Description\">' +\n((__t = (node.description)) == null ? '' : __t) +\n'</textarea>\\n        ';\n } ;\n__p += '\\n    </p>\\n';\n } ;\n__p += ' ';\n if (options.show_node_editor_size) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Size:\")) +\n'</span>\\n        <a href=\"#\" class=\"Rk-Edit-Size-Btn\" id=\"Rk-Edit-Size-Down\">-</a>\\n        <span class=\"Rk-Edit-Size-Disp\" id=\"Rk-Edit-Size-Value\">' +\n__e(node.size) +\n'</span>\\n        <a href=\"#\" class=\"Rk-Edit-Size-Btn\" id=\"Rk-Edit-Size-Up\">+</a>\\n    </p>\\n';\n } ;\n__p += ' ';\n if (options.show_node_editor_style) { ;\n__p += '\\n    <div class=\"Rk-Editor-p\">\\n      ';\n if (options.show_node_editor_style_color) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-color\">\\n        <span class=\"Rk-Editor-Label\">\\n        ' +\n__e(renkan.translate(\"Node color:\")) +\n'</span>\\n        <div class=\"Rk-Edit-ColorPicker-Wrapper\">\\n            <span class=\"Rk-Edit-Color\" style=\"background: ' +\n__e(node.color) +\n';\">\\n                <span class=\"Rk-Edit-ColorTip\"></span>\\n            </span>\\n            ' +\n((__t = ( renkan.colorPicker )) == null ? '' : __t) +\n'\\n            <span class=\"Rk-Edit-ColorPicker-Text\">' +\n__e( renkan.translate(\"Choose color\") ) +\n'</span>\\n        </div>\\n      </div>\\n      ';\n } ;\n__p += '\\n      ';\n if (options.show_node_editor_style_dash) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-dash\">\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Dash:\")) +\n'</span>\\n        <input type=\"checkbox\" name=\"Rk-Edit-Dash\" class=\"Rk-Edit-Dash\" ' +\n__e( node.dash ) +\n' />\\n      </div>\\n      ';\n } ;\n__p += '\\n      ';\n if (options.show_node_editor_style_thickness) { ;\n__p += '\\n      <div id=\"Rk-Editor-p-thickness\">\\n          <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Thickness:\")) +\n'</span>\\n          <a href=\"#\" class=\"Rk-Edit-Size-Btn\" id=\"Rk-Edit-Thickness-Down\">-</a>\\n          <span class=\"Rk-Edit-Size-Disp\" id=\"Rk-Edit-Thickness-Value\">' +\n__e(node.thickness) +\n'</span>\\n          <a href=\"#\" class=\"Rk-Edit-Size-Btn\" id=\"Rk-Edit-Thickness-Up\">+</a>\\n      </div>\\n      ';\n } ;\n__p += '\\n    </div>\\n';\n } ;\n__p += ' ';\n if (options.show_node_editor_image) { ;\n__p += '\\n    <div class=\"Rk-Edit-ImgWrap\">\\n        <div class=\"Rk-Edit-ImgPreview\">\\n            <img src=\"' +\n__e(node.image || node.image_placeholder) +\n'\" />\\n            ';\n if (node.clip_path) { ;\n__p += '\\n                <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" viewbox=\"0 0 1 1\" preserveAspectRatio=\"none\">\\n                    <path style=\"stroke-width: .02; stroke:red; fill-opacity:.3; fill:red;\" d=\"' +\n__e( node.clip_path ) +\n'\" />\\n                </svg>\\n            ';\n };\n__p += '\\n        </div>\\n    </div>\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"Image URL:\")) +\n'</label>\\n        <div>\\n            <a class=\"Rk-Edit-Image-Del\" href=\"#\"></a>\\n            <input class=\"Rk-Edit-Image\" type=\"text\" value=\\'' +\n__e(node.image) +\n'\\' />\\n        </div>\\n    </p>\\n';\n if (options.allow_image_upload) { ;\n__p += '\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"Choose Image File:\")) +\n'</label>\\n        <input class=\"Rk-Edit-Image-File\" type=\"file\" accept=\"image/*\" />\\n    </p>\\n';\n };\n\n } ;\n__p += ' ';\n if (options.show_node_editor_creator && node.has_creator) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Created by:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e(node.created_by_color) +\n';\"></span>\\n        ' +\n__e( shortenText(node.created_by_title, 25) ) +\n'\\n    </p>\\n';\n } ;\n__p += ' ';\n if (options.change_shapes) { ;\n__p += '\\n    <p>\\n        <label>' +\n__e(renkan.translate(\"Shapes available\")) +\n':</label>\\n        <select class=\"Rk-Edit-Shape\">\\n          ';\n _.each(shapes, function(shape) { ;\n__p += '\\n            <option class=\"Rk-Edit-Vocabulary-Property\" value=\"' +\n__e( shape ) +\n'\"';\n if (node.shape === shape) { ;\n__p += ' selected';\n } ;\n__p += '>\\n                ' +\n__e( renkan.translate(shape.charAt(0).toUpperCase() + shape.substring(1)) ) +\n'\\n            </option>\\n          ';\n }); ;\n__p += '\\n        </select>\\n    </p>\\n';\n } ;\n__p += '\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/nodeeditor_readonly.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n    <span class=\"Rk-CloseX\">&times;</span>\\n    ';\n if (options.show_node_tooltip_color) { ;\n__p += '\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e(node.color) +\n';\"></span>\\n    ';\n } ;\n__p += '\\n    <span class=\"Rk-Display-Title\">\\n        ';\n if (node.uri) { ;\n__p += '\\n            <a href=\"' +\n__e(node.uri) +\n'\" target=\"_blank\">\\n        ';\n } ;\n__p += '\\n        ' +\n__e(node.title) +\n'\\n        ';\n if (node.uri) { ;\n__p += '</a>';\n } ;\n__p += '\\n    </span>\\n</h2>\\n';\n if (node.uri && options.show_node_tooltip_uri) { ;\n__p += '\\n    <p class=\"Rk-Display-URI\">\\n        <a href=\"' +\n__e(node.uri) +\n'\" target=\"_blank\">' +\n__e(node.short_uri) +\n'</a>\\n    </p>\\n';\n } ;\n__p += ' ';\n if (options.show_node_tooltip_description) { ;\n__p += '\\n    <p class=\"Rk-Display-Description\">' +\n((__t = (node.description)) == null ? '' : __t) +\n'</p>\\n';\n } ;\n__p += ' ';\n if (node.image && options.show_node_tooltip_image) { ;\n__p += '\\n    <img class=\"Rk-Display-ImgPreview\" src=\"' +\n__e(node.image) +\n'\" />\\n';\n } ;\n__p += ' ';\n if (node.has_creator && options.show_node_tooltip_creator) { ;\n__p += '\\n    <p>\\n        <span class=\"Rk-Editor-Label\">' +\n__e(renkan.translate(\"Created by:\")) +\n'</span>\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e(node.created_by_color) +\n';\"></span>\\n        ' +\n__e( shortenText(node.created_by_title, 25) ) +\n'\\n    </p>\\n';\n } ;\n__p += '\\n    <a href=\"#?idNode=' +\n__e(node._id) +\n'\">' +\n__e(renkan.translate(\"Link to the node\")) +\n'</a>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/nodeeditor_video.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n    <span class=\"Rk-CloseX\">&times;</span>\\n    ';\n if (options.show_node_tooltip_color) { ;\n__p += '\\n        <span class=\"Rk-UserColor\" style=\"background: ' +\n__e(node.color) +\n';\"></span>\\n    ';\n } ;\n__p += '\\n    <span class=\"Rk-Display-Title\">\\n        ';\n if (node.uri) { ;\n__p += '\\n            <a href=\"' +\n__e(node.uri) +\n'\" target=\"_blank\">\\n        ';\n } ;\n__p += '\\n        ' +\n__e(node.title) +\n'\\n        ';\n if (node.uri) { ;\n__p += '</a>';\n } ;\n__p += '\\n    </span>\\n</h2>\\n';\n if (node.uri && options.show_node_tooltip_uri) { ;\n__p += '\\n     <video width=\"320\" height=\"240\" controls>\\n        <source src=\"' +\n__e(node.uri) +\n'\" type=\"video/mp4\">\\n     </video> \\n';\n } ;\n__p += '\\n    <a href=\"#?idnode=' +\n__e(node._id) +\n'\">' +\n__e(renkan.translate(\"Link to the node\")) +\n'</a>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/scene.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n\n if (options.show_top_bar) { ;\n__p += '\\n    <div class=\"Rk-TopBar\">\\n        <div class=\"loader\"></div>\\n        ';\n if (!options.editor_mode) { ;\n__p += '\\n            <h2 class=\"Rk-PadTitle\">\\n                ' +\n__e( project.get(\"title\") || translate(\"Untitled project\")) +\n'\\n            </h2>\\n        ';\n } else { ;\n__p += '\\n            <input type=\"text\" class=\"Rk-PadTitle\" value=\"' +\n__e( project.get('title') || '' ) +\n'\" placeholder=\"' +\n__e(translate('Untitled project')) +\n'\" />\\n        ';\n } ;\n__p += '\\n        ';\n if (options.show_user_list) { ;\n__p += '\\n            <div class=\"Rk-Users\">\\n                <div class=\"Rk-CurrentUser\">\\n                    ';\n if (options.show_user_color) { ;\n__p += '\\n                        <div class=\"Rk-Edit-ColorPicker-Wrapper\">\\n                            <span class=\"Rk-CurrentUser-Color\">\\n                            ';\n if (options.user_color_editable) { ;\n__p += '\\n                                <span class=\"Rk-Edit-ColorTip\"></span>\\n                            ';\n } ;\n__p += '\\n                            </span>\\n                            ';\n if (options.user_color_editable) { print(colorPicker) } ;\n__p += '\\n                        </div>\\n                    ';\n } ;\n__p += '\\n                    <span class=\"Rk-CurrentUser-Name\">&lt;unknown user&gt;</span>\\n                </div>\\n                <ul class=\"Rk-UserList\"></ul>\\n            </div>\\n        ';\n } ;\n__p += '\\n        ';\n if (options.home_button_url) {;\n__p += '\\n            <div class=\"Rk-TopBar-Separator\"></div>\\n            <a class=\"Rk-TopBar-Button Rk-Home-Button\" href=\"' +\n__e( options.home_button_url ) +\n'\">\\n                <div class=\"Rk-TopBar-Tooltip\">\\n                    <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                        ' +\n__e( translate(options.home_button_title) ) +\n'\\n                    </div>\\n                </div>\\n            </a>\\n        ';\n } ;\n__p += '\\n        ';\n if (options.show_fullscreen_button) { ;\n__p += '\\n            <div class=\"Rk-TopBar-Separator\"></div>\\n            <div class=\"Rk-TopBar-Button Rk-FullScreen-Button\">\\n                <div class=\"Rk-TopBar-Tooltip\">\\n                    <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                        ' +\n__e(translate(\"Full Screen\")) +\n'\\n                    </div>\\n                </div>\\n            </div>\\n        ';\n } ;\n__p += '\\n        ';\n if (options.editor_mode) { ;\n__p += '\\n            ';\n if (options.show_addnode_button) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <div class=\"Rk-TopBar-Button Rk-AddNode-Button\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                            ' +\n__e(translate(\"Add Node\")) +\n'\\n                        </div>\\n                    </div>\\n                </div>\\n            ';\n } ;\n__p += '\\n            ';\n if (options.show_addedge_button) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <div class=\"Rk-TopBar-Button Rk-AddEdge-Button\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                            ' +\n__e(translate(\"Add Edge\")) +\n'\\n                        </div>\\n                    </div>\\n                </div>\\n            ';\n } ;\n__p += '\\n            ';\n if (options.show_export_button) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <div class=\"Rk-TopBar-Button Rk-Export-Button\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                            ' +\n__e(translate(\"Download Project\")) +\n'\\n                        </div>\\n                    </div>\\n                </div>\\n            ';\n } ;\n__p += '\\n            ';\n if (options.show_save_button) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <div class=\"Rk-TopBar-Button Rk-Save-Button\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\"></div>\\n                    </div>\\n                </div>\\n            ';\n } ;\n__p += '\\n            ';\n if (options.show_open_button) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <div class=\"Rk-TopBar-Button Rk-Open-Button\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                            ' +\n__e(translate(\"Open Project\")) +\n'\\n                        </div>\\n                    </div>\\n                </div>\\n            ';\n } ;\n__p += '\\n            ';\n if (options.show_bookmarklet) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <a class=\"Rk-TopBar-Button Rk-Bookmarklet-Button\" href=\"#\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                            ' +\n__e(translate(\"Renkan \\'Drag-to-Add\\' bookmarklet\")) +\n'\\n                        </div>\\n                    </div>\\n                </a>\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n            ';\n } ;\n__p += '\\n        ';\n } else { ;\n__p += '\\n            ';\n if (options.show_export_button) { ;\n__p += '\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n                <div class=\"Rk-TopBar-Button Rk-Export-Button\">\\n                    <div class=\"Rk-TopBar-Tooltip\">\\n                        <div class=\"Rk-TopBar-Tooltip-Contents\">\\n                            ' +\n__e(translate(\"Download Project\")) +\n'\\n                        </div>\\n                    </div>\\n                </div>\\n                <div class=\"Rk-TopBar-Separator\"></div>\\n            ';\n } ;\n__p += '\\n        ';\n }; ;\n__p += '\\n        ';\n if (options.show_search_field) { ;\n__p += '\\n            <form action=\"#\" class=\"Rk-GraphSearch-Form\">\\n                <input type=\"search\" class=\"Rk-GraphSearch-Field\" placeholder=\"' +\n__e( translate('Search in graph') ) +\n'\" />\\n            </form>\\n            <div class=\"Rk-TopBar-Separator\"></div>\\n        ';\n } ;\n__p += '\\n    </div>\\n';\n } ;\n__p += '\\n<div class=\"Rk-Editing-Space';\n if (!options.show_top_bar) { ;\n__p += ' Rk-Editing-Space-Full';\n } ;\n__p += '\">\\n    <div class=\"Rk-Labels\"></div>\\n    <canvas class=\"Rk-Canvas\" ';\n if (options.resize) { ;\n__p += ' resize=\"\" ';\n } ;\n__p += ' ></canvas>\\n    <div class=\"Rk-Notifications\"></div>\\n    <div class=\"Rk-Editor\">\\n        ';\n if (options.show_bins) { ;\n__p += '\\n            <div class=\"Rk-Fold-Bins\">&laquo;</div>\\n        ';\n } ;\n__p += '\\n        ';\n if (options.show_zoom) { ;\n__p += '\\n            <div class=\"Rk-ZoomButtons\">\\n                <div class=\"Rk-ZoomIn\" title=\"' +\n__e(translate('Zoom In')) +\n'\"></div>\\n                <div class=\"Rk-ZoomFit\" title=\"' +\n__e(translate('Zoom Fit')) +\n'\"></div>\\n                <div class=\"Rk-ZoomOut\" title=\"' +\n__e(translate('Zoom Out')) +\n'\"></div>\\n                ';\n if (options.editor_mode && options.save_view) { ;\n__p += '\\n                    <div class=\"Rk-ZoomSave\" title=\"' +\n__e(translate('Save view')) +\n'\"></div>\\n                ';\n } ;\n__p += '\\n                ';\n if (options.save_view) { ;\n__p += '\\n                    <div class=\"Rk-ZoomSetSaved\" title=\"' +\n__e(translate('View saved view')) +\n'\"></div>\\n                    ';\n if (options.hide_nodes) { ;\n__p += '\\n                \\t   <div class=\"Rk-ShowHiddenNodes\" title=\"' +\n__e(translate('Show hidden nodes')) +\n'\"></div>\\n                    ';\n } ;\n__p += '       \\n                ';\n } ;\n__p += '\\n            </div>\\n        ';\n } ;\n__p += '\\n    </div>\\n</div>\\n';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/search.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<li class=\"' +\n((__t = ( className )) == null ? '' : __t) +\n'\" data-key=\"' +\n((__t = ( key )) == null ? '' : __t) +\n'\">' +\n((__t = ( title )) == null ? '' : __t) +\n'</li>';\n\n}\nreturn __p\n};\n\nthis[\"renkanJST\"][\"templates/wikipedia-bin/resulttemplate.html\"] = function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<li class=\"Rk-Wikipedia-Result Rk-Bin-Item\" draggable=\"true\"\\n    data-uri=\"' +\n__e(url) +\n'\" data-title=\"Wikipedia: ' +\n__e(title) +\n'\"\\n    data-description=\"' +\n__e(description) +\n'\"\\n    data-image=\"' +\n__e( Rkns.Utils.getFullURL( static_url + 'img/wikipedia.png' ) ) +\n'\">\\n\\n    <img class=\"Rk-Wikipedia-Icon\" src=\"' +\n__e(static_url) +\n'img/wikipedia.png\">\\n    <h4 class=\"Rk-Wikipedia-Title\">\\n        <a href=\"' +\n__e(url) +\n'\" target=\"_blank\">' +\n((__t = (htitle)) == null ? '' : __t) +\n'</a>\\n    </h4>\\n    <p class=\"Rk-Wikipedia-Snippet\">' +\n((__t = (hdescription)) == null ? '' : __t) +\n'</p>\\n</li>\\n';\n\n}\nreturn __p\n};","/* Declaring the Renkan Namespace Rkns and Default values */\n\n(function(root) {\n\n    \"use strict\";\n\n    if (typeof root.Rkns !== \"object\") {\n        root.Rkns = {};\n    }\n\n    var Rkns = root.Rkns;\n    var $ = Rkns.$ = root.jQuery;\n    var _ = Rkns._ = root._;\n\n    Rkns.pickerColors = [\"#8f1919\", \"#a80000\", \"#d82626\", \"#ff0000\", \"#e87c7c\", \"#ff6565\", \"#f7d3d3\", \"#fecccc\",\n        \"#8f5419\", \"#a85400\", \"#d87f26\", \"#ff7f00\", \"#e8b27c\", \"#ffb265\", \"#f7e5d3\", \"#fee5cc\",\n        \"#8f8f19\", \"#a8a800\", \"#d8d826\", \"#feff00\", \"#e8e87c\", \"#feff65\", \"#f7f7d3\", \"#fefecc\",\n        \"#198f19\", \"#00a800\", \"#26d826\", \"#00ff00\", \"#7ce87c\", \"#65ff65\", \"#d3f7d3\", \"#ccfecc\",\n        \"#198f8f\", \"#00a8a8\", \"#26d8d8\", \"#00feff\", \"#7ce8e8\", \"#65feff\", \"#d3f7f7\", \"#ccfefe\",\n        \"#19198f\", \"#0000a8\", \"#2626d8\", \"#0000ff\", \"#7c7ce8\", \"#6565ff\", \"#d3d3f7\", \"#ccccfe\",\n        \"#8f198f\", \"#a800a8\", \"#d826d8\", \"#ff00fe\", \"#e87ce8\", \"#ff65fe\", \"#f7d3f7\", \"#feccfe\",\n        \"#000000\", \"#242424\", \"#484848\", \"#6d6d6d\", \"#919191\", \"#b6b6b6\", \"#dadada\", \"#ffffff\"\n    ];\n\n    Rkns.__renkans = [];\n\n    var _BaseBin = Rkns._BaseBin = function(_renkan, _opts) {\n        if (typeof _renkan !== \"undefined\") {\n            this.renkan = _renkan;\n            this.renkan.$.find(\".Rk-Bin-Main\").hide();\n            this.$ = Rkns.$('<li>')\n                .addClass(\"Rk-Bin\")\n                .appendTo(_renkan.$.find(\".Rk-Bin-List\"));\n            this.title_icon_$ = Rkns.$('<span>')\n                .addClass(\"Rk-Bin-Title-Icon\")\n                .appendTo(this.$);\n\n            var _this = this;\n\n            Rkns.$('<a>')\n                .attr({\n                    href: \"#\",\n                    title: _renkan.translate(\"Close bin\")\n                })\n                .addClass(\"Rk-Bin-Close\")\n                .html('&times;')\n                .appendTo(this.$)\n                .click(function() {\n                    _this.destroy();\n                    if (!_renkan.$.find(\".Rk-Bin-Main:visible\").length) {\n                        _renkan.$.find(\".Rk-Bin-Main:last\").slideDown();\n                    }\n                    _renkan.resizeBins();\n                    return false;\n                });\n            Rkns.$('<a>')\n                .attr({\n                    href: \"#\",\n                    title: _renkan.translate(\"Refresh bin\")\n                })\n                .addClass(\"Rk-Bin-Refresh\")\n                .appendTo(this.$)\n                .click(function() {\n                    _this.refresh();\n                    return false;\n                });\n            this.count_$ = Rkns.$('<div>')\n                .addClass(\"Rk-Bin-Count\")\n                .appendTo(this.$);\n            this.title_$ = Rkns.$('<h2>')\n                .addClass(\"Rk-Bin-Title\")\n                .appendTo(this.$);\n            this.main_$ = Rkns.$('<div>')\n                .addClass(\"Rk-Bin-Main\")\n                .appendTo(this.$)\n                .html('<h4 class=\"Rk-Bin-Loading\">' + _renkan.translate(\"Loading, please wait\") + '</h4>');\n            this.title_$.html(_opts.title || '(new bin)');\n            this.renkan.resizeBins();\n\n            if (_opts.auto_refresh) {\n                window.setInterval(function() {\n                    _this.refresh();\n                }, _opts.auto_refresh);\n            }\n        }\n    };\n\n    _BaseBin.prototype.destroy = function() {\n        this.$.detach();\n        this.renkan.resizeBins();\n    };\n\n    /* Point of entry */\n\n    var Renkan = Rkns.Renkan = function(_opts) {\n        var _this = this;\n\n        Rkns.__renkans.push(this);\n\n        this.options = _.defaults(_opts, Rkns.defaults, {\n            templates: _.defaults(_opts.templates, renkanJST) || renkanJST,\n            node_editor_templates: _.defaults(_opts.node_editor_templates, Rkns.defaults.node_editor_templates)\n        });\n        this.template = renkanJST['templates/main.html'];\n\n        var types_templates = {};\n        _.each(this.options.node_editor_templates, function(value, key) {\n            types_templates[key] = _this.options.templates[value];\n            delete _this.options.templates[value];\n        });\n        this.options.node_editor_templates = types_templates;\n\n        _.each(this.options.property_files, function(f) {\n            Rkns.$.getJSON(f, function(data) {\n                _this.options.properties = _this.options.properties.concat(data);\n            });\n        });\n\n        this.read_only = this.options.read_only || !this.options.editor_mode;\n\n        this.router = new Rkns.Router();\n\n        this.project = new Rkns.Models.Project();\n        this.dataloader = new Rkns.DataLoader.Loader(this.project, this.options);\n\n        this.setCurrentUser = function(user_id, user_name) {\n            this.project.addUser({\n                _id: user_id,\n                title: user_name\n            });\n            this.current_user = user_id;\n            this.renderer.redrawUsers();\n        };\n\n        if (typeof this.options.user_id !== \"undefined\") {\n            this.current_user = this.options.user_id;\n        }\n        this.$ = Rkns.$(\"#\" + this.options.container);\n        this.$\n            .addClass(\"Rk-Main\")\n            .html(this.template(this));\n\n        this.tabs = [];\n        this.search_engines = [];\n\n        this.current_user_list = new Rkns.Models.UsersList();\n\n        this.current_user_list.on(\"add remove\", function() {\n            if (this.renderer) {\n                this.renderer.redrawUsers();\n            }\n        });\n\n        this.colorPicker = (function() {\n            var _tmpl = renkanJST['templates/colorpicker.html'];\n            return '<ul class=\"Rk-Edit-ColorPicker\">' + Rkns.pickerColors.map(function(c) {\n                return _tmpl({\n                    c: c\n                });\n            }).join(\"\") + '</ul>';\n        })();\n\n        if (this.options.show_editor) {\n            this.renderer = new Rkns.Renderer.Scene(this);\n        }\n\n        if (!this.options.search.length) {\n            this.$.find(\".Rk-Web-Search-Form\").detach();\n        } else {\n            var _tmpl = renkanJST['templates/search.html'],\n                _select = this.$.find(\".Rk-Search-List\"),\n                _input = this.$.find(\".Rk-Web-Search-Input\"),\n                _form = this.$.find(\".Rk-Web-Search-Form\");\n            _.each(this.options.search, function(_search, _key) {\n                if (Rkns[_search.type] && Rkns[_search.type].Search) {\n                    _this.search_engines.push(new Rkns[_search.type].Search(_this, _search));\n                }\n            });\n            _select.html(\n                _(this.search_engines).map(function(_search, _key) {\n                    return _tmpl({\n                        key: _key,\n                        title: _search.getSearchTitle(),\n                        className: _search.getBgClass()\n                    });\n                }).join(\"\")\n            );\n            _select.find(\"li\").click(function() {\n                var _el = Rkns.$(this);\n                _this.setSearchEngine(_el.attr(\"data-key\"));\n                _form.submit();\n            });\n            _form.submit(function() {\n                if (_input.val()) {\n                    var _search = _this.search_engine;\n                    _search.search(_input.val());\n                }\n                return false;\n            });\n            this.$.find(\".Rk-Search-Current\").mouseenter(\n                function() {\n                    _select.slideDown();\n                }\n            );\n            this.$.find(\".Rk-Search-Select\").mouseleave(\n                function() {\n                    _select.hide();\n                }\n            );\n            this.setSearchEngine(0);\n        }\n        _.each(this.options.bins, function(_bin) {\n            if (Rkns[_bin.type] && Rkns[_bin.type].Bin) {\n                _this.tabs.push(new Rkns[_bin.type].Bin(_this, _bin));\n            }\n        });\n\n        var elementDropped = false;\n\n        this.$.find(\".Rk-Bins\")\n            .on(\"click\", \".Rk-Bin-Title,.Rk-Bin-Title-Icon\", function() {\n                var _mainDiv = Rkns.$(this).siblings(\".Rk-Bin-Main\");\n                if (_mainDiv.is(\":hidden\")) {\n                    _this.$.find(\".Rk-Bin-Main\").slideUp();\n                    _mainDiv.slideDown();\n                }\n            });\n\n        if (this.options.show_editor) {\n\n            this.$.find(\".Rk-Bins\").on(\"mouseover\", \".Rk-Bin-Item\", function(_e) {\n                var _t = Rkns.$(this);\n                if (_t && $(_t).attr(\"data-uri\")) {\n                    var _models = _this.project.get(\"nodes\").where({\n                        uri: $(_t).attr(\"data-uri\")\n                    });\n                    _.each(_models, function(_model) {\n                        _this.renderer.highlightModel(_model);\n                    });\n                }\n            }).mouseout(function() {\n                _this.renderer.unhighlightAll();\n            }).on(\"mousemove\", \".Rk-Bin-Item\", function(e) {\n                try {\n                    this.dragDrop();\n                } catch (err) {}\n            }).on(\"touchstart\", \".Rk-Bin-Item\", function(e) {\n                elementDropped = false;\n            }).on(\"touchmove\", \".Rk-Bin-Item\", function(e) {\n                e.preventDefault();\n                var touch = e.originalEvent.changedTouches[0],\n                    off = _this.renderer.canvas_$.offset(),\n                    w = _this.renderer.canvas_$.width(),\n                    h = _this.renderer.canvas_$.height();\n                if (touch.pageX >= off.left && touch.pageX < (off.left + w) && touch.pageY >= off.top && touch.pageY < (off.top + h)) {\n                    if (elementDropped) {\n                        _this.renderer.onMouseMove(touch, true);\n                    } else {\n                        elementDropped = true;\n                        var div = document.createElement('div');\n                        div.appendChild(this.cloneNode(true));\n                        _this.renderer.dropData({\n                            \"text/html\": div.innerHTML\n                        }, touch);\n                        _this.renderer.onMouseDown(touch, true);\n                    }\n                }\n            }).on(\"touchend\", \".Rk-Bin-Item\", function(e) {\n                if (elementDropped) {\n                    _this.renderer.onMouseUp(e.originalEvent.changedTouches[0], true);\n                }\n                elementDropped = false;\n            }).on(\"dragstart\", \".Rk-Bin-Item\", function(e) {\n                var div = document.createElement('div');\n                div.appendChild(this.cloneNode(true));\n                try {\n                    e.originalEvent.dataTransfer.setData(\"text/html\", div.innerHTML);\n                } catch (err) {\n                    e.originalEvent.dataTransfer.setData(\"text\", div.innerHTML);\n                }\n            });\n\n        }\n\n        Rkns.$(window).resize(function() {\n            _this.resizeBins();\n        });\n\n        var lastsearch = false,\n            lastval = '';\n\n        this.$.find(\".Rk-Bins-Search-Input\").on(\"change keyup paste input\", function() {\n            var val = Rkns.$(this).val();\n            if (val === lastval) {\n                return;\n            }\n            var search = Rkns.Utils.regexpFromTextOrArray(val.length > 1 ? val : null);\n            if (search.source === lastsearch) {\n                return;\n            }\n            lastsearch = search.source;\n            _.each(_this.tabs, function(tab) {\n                tab.render(search);\n            });\n\n        });\n        this.$.find(\".Rk-Bins-Search-Form\").submit(function() {\n            return false;\n        });\n    };\n\n    Renkan.prototype.translate = function(_text) {\n        if (Rkns.i18n[this.options.language] && Rkns.i18n[this.options.language][_text]) {\n            return Rkns.i18n[this.options.language][_text];\n        }\n        if (this.options.language.length > 2 && Rkns.i18n[this.options.language.substr(0, 2)] && Rkns.i18n[this.options.language.substr(0, 2)][_text]) {\n            return Rkns.i18n[this.options.language.substr(0, 2)][_text];\n        }\n        return _text;\n    };\n\n    Renkan.prototype.onStatusChange = function() {\n        this.renderer.onStatusChange();\n    };\n\n    Renkan.prototype.setSearchEngine = function(_key) {\n        this.search_engine = this.search_engines[_key];\n        this.$.find(\".Rk-Search-Current\").attr(\"class\", \"Rk-Search-Current \" + this.search_engine.getBgClass());\n        var listClasses = this.search_engine.getBgClass().split(\" \");\n        var classes = \"\";\n        for (var i = 0; i < listClasses.length; i++) {\n            classes += \".\" + listClasses[i];\n        }\n        this.$.find(\".Rk-Web-Search-Input.Rk-Search-Input\").attr(\"placeholder\", this.translate(\"Search in \") + this.$.find(\".Rk-Search-List \" + classes).html());\n    };\n\n    Renkan.prototype.resizeBins = function() {\n        var _d = +this.$.find(\".Rk-Bins-Head\").outerHeight();\n        this.$.find(\".Rk-Bin-Title:visible\").each(function() {\n            _d += Rkns.$(this).outerHeight();\n        });\n        this.$.find(\".Rk-Bin-Main\").css({\n            height: this.$.find(\".Rk-Bins\").height() - _d\n        });\n    };\n\n    /* Utility functions */\n    var getUUID4 = function() {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            var r = Math.random() * 16 | 0,\n                v = c === 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    };\n\n    Rkns.Utils = {\n        getUUID4: getUUID4,\n        getUID: (function() {\n            function pad(n) {\n                return n < 10 ? '0' + n : n;\n            }\n            var _d = new Date(),\n                ID_AUTO_INCREMENT = 0,\n                ID_BASE = _d.getUTCFullYear() + '-' +\n                pad(_d.getUTCMonth() + 1) + '-' +\n                pad(_d.getUTCDate()) + '-' +\n                getUUID4();\n            return function(_base) {\n                var _n = (++ID_AUTO_INCREMENT).toString(16),\n                    _uidbase = (typeof _base === \"undefined\" ? \"\" : _base + \"-\");\n                while (_n.length < 4) {\n                    _n = '0' + _n;\n                }\n                return _uidbase + ID_BASE + '-' + _n;\n            };\n        })(),\n        getFullURL: function(url) {\n\n            if (typeof(url) === 'undefined' || url == null) {\n                return \"\";\n            }\n            if (/https?:\\/\\//.test(url)) {\n                return url;\n            }\n            var img = new Image();\n            img.src = url;\n            var res = img.src;\n            img.src = null;\n            return res;\n\n        },\n        inherit: function(_baseClass, _callbefore) {\n\n            var _class = function(_arg) {\n                if (typeof _callbefore === \"function\") {\n                    _callbefore.apply(this, Array.prototype.slice.call(arguments, 0));\n                }\n                _baseClass.apply(this, Array.prototype.slice.call(arguments, 0));\n                if (typeof this._init === \"function\" && !this._initialized) {\n                    this._init.apply(this, Array.prototype.slice.call(arguments, 0));\n                    this._initialized = true;\n                }\n            };\n            _.extend(_class.prototype, _baseClass.prototype);\n\n            return _class;\n\n        },\n        regexpFromTextOrArray: (function() {\n            var charsub = [\n                    '[aáàâä]',\n                    '[cç]',\n                    '[eéèêë]',\n                    '[iíìîï]',\n                    '[oóòôö]',\n                    '[uùûü]'\n                ],\n                removeChars = [\n                    String.fromCharCode(768), String.fromCharCode(769), String.fromCharCode(770), String.fromCharCode(771), String.fromCharCode(807),\n                    \"｛\", \"｝\", \"（\", \"）\", \"［\", \"］\", \"【\", \"】\", \"、\", \"・\", \"‥\", \"。\", \"「\", \"」\", \"『\", \"』\", \"〜\", \"：\", \"！\", \"？\", \"　\",\n                    \",\", \" \", \";\", \"(\", \")\", \".\", \"*\", \"+\", \"\\\\\", \"?\", \"|\", \"{\", \"}\", \"[\", \"]\", \"^\", \"#\", \"/\"\n                ],\n                remsrc = \"[\\\\\" + removeChars.join(\"\\\\\") + \"]\",\n                remrx = new RegExp(remsrc, \"gm\"),\n                charsrx = _.map(charsub, function(c) {\n                    return new RegExp(c);\n                });\n\n            function replaceText(_text) {\n                var txt = _text.toLowerCase().replace(remrx, \"\"),\n                    src = \"\";\n\n                function makeReplaceFunc(l) {\n                    return function(k, v) {\n                        l = l.replace(charsrx[k], v);\n                    };\n                }\n                for (var j = 0; j < txt.length; j++) {\n                    if (j) {\n                        src += remsrc + \"*\";\n                    }\n                    var l = txt[j];\n                    _.each(charsub, makeReplaceFunc(l));\n                    src += l;\n                }\n                return src;\n            }\n\n            function getSource(inp) {\n                switch (typeof inp) {\n                    case \"string\":\n                        return replaceText(inp);\n                    case \"object\":\n                        var src = '';\n                        _.each(inp, function(v) {\n                            var res = getSource(v);\n                            if (res) {\n                                if (src) {\n                                    src += '|';\n                                }\n                                src += res;\n                            }\n                        });\n                        return src;\n                }\n                return '';\n            }\n\n            return function(_textOrArray) {\n                var source = getSource(_textOrArray);\n                if (source) {\n                    var testrx = new RegExp(source, \"im\"),\n                        replacerx = new RegExp('(' + source + ')', \"igm\");\n                    return {\n                        isempty: false,\n                        source: source,\n                        test: function(_t) {\n                            return testrx.test(_t);\n                        },\n                        replace: function(_text, _replace) {\n                            return _text.replace(replacerx, _replace);\n                        }\n                    };\n                } else {\n                    return {\n                        isempty: true,\n                        source: '',\n                        test: function() {\n                            return true;\n                        },\n                        replace: function(_text) {\n                            return text;\n                        }\n                    };\n                }\n            };\n        })(),\n        /* The minimum distance (in pixels) the mouse has to move to consider an element was dragged */\n        _MIN_DRAG_DISTANCE: 2,\n        /* Distance between the inner and outer radius of buttons that appear when hovering on a node */\n        _NODE_BUTTON_WIDTH: 40,\n\n        _EDGE_BUTTON_INNER: 2,\n        _EDGE_BUTTON_OUTER: 40,\n        /* Constants used to know if a specific action is to be performed when clicking on the canvas */\n        _CLICKMODE_ADDNODE: 1,\n        _CLICKMODE_STARTEDGE: 2,\n        _CLICKMODE_ENDEDGE: 3,\n        /* Node size step: Used to calculate the size change when clicking the +/- buttons */\n        _NODE_SIZE_STEP: Math.LN2 / 4,\n        _MIN_SCALE: 1 / 20,\n        _MAX_SCALE: 20,\n        _MOUSEMOVE_RATE: 80,\n        _DOUBLETAP_DELAY: 800,\n        /* Maximum distance in pixels (squared, to reduce calculations)\n         * between two taps when double-tapping on a touch terminal */\n        _DOUBLETAP_DISTANCE: 20 * 20,\n        /* A placeholder so a default colour is displayed when a node has a null value for its user property */\n        _USER_PLACEHOLDER: function(_renkan) {\n            return {\n                color: _renkan.options.default_user_color,\n                title: _renkan.translate(\"(unknown user)\"),\n                get: function(attr) {\n                    return this[attr] || false;\n                }\n            };\n        },\n        /* The code for the \"Drag and Add Bookmarklet\", slightly minified and with whitespaces removed, though\n         * it doesn't seem that it's still a requirement in newer browsers (i.e. the ones compatibles with canvas drawing)\n         */\n        _BOOKMARKLET_CODE: function(_renkan) {\n            return \"(function(a,b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r){a=document;b=a.body;c=a.location.href;j='draggable';m='text/x-iri-';d=a.createElement('div');d.innerHTML='<p_style=\\\"position:fixed;top:0;right:0;font:bold_18px_sans-serif;color:#fff;background:#909;padding:10px;z-index:100000;\\\">\" +\n                _renkan.translate(\"Drag items from this website, drop them in Renkan\").replace(/ /g, \"_\") +\n                \"</p>'.replace(/_/g,String.fromCharCode(32));b.appendChild(d);e=[{r:/https?:\\\\/\\\\/[^\\\\/]*twitter\\\\.com\\\\//,s:'.tweet',n:'twitter'},{r:/https?:\\\\/\\\\/[^\\\\/]*google\\\\.[^\\\\/]+\\\\//,s:'.g',n:'google'},{r:/https?:\\\\/\\\\/[^\\\\/]*lemonde\\\\.fr\\\\//,s:'[data-vr-contentbox]',n:'lemonde'}];f=false;e.forEach(function(g){if(g.r.test(c)){f=g;}});if(f){h=function(){Array.prototype.forEach.call(a.querySelectorAll(f.s),function(i){i[j]=true;k=i.style;k.borderWidth='2px';k.borderColor='#909';k.borderStyle='solid';k.backgroundColor='rgba(200,0,180,.1)';})};window.setInterval(h,500);h();};a.addEventListener('dragstart',function(k){l=k.dataTransfer;l.setData(m+'source-uri',c);l.setData(m+'source-title',a.title);n=k.target;if(f){o=n;while(!o.attributes[j]){o=o.parentNode;if(o==b){break;}}}if(f&&o.attributes[j]){p=o.cloneNode(true);l.setData(m+'specific-site',f.n)}else{q=a.getSelection();if(q.type==='Range'||!q.type){p=q.getRangeAt(0).cloneContents();}else{p=n.cloneNode();}}r=a.createElement('div');r.appendChild(p);l.setData('text/x-iri-selected-text',r.textContent.trim());l.setData('text/x-iri-selected-html',r.innerHTML);},false);})();\";\n        },\n        /* Shortens text to the required length then adds ellipsis */\n        shortenText: function(_text, _maxlength) {\n            return (_text.length > _maxlength ? (_text.substr(0, _maxlength) + '…') : _text);\n        },\n        /* Drawing an edit box with an arrow and positioning the edit box according to the position of the node/edge being edited\n         * Called by Rkns.Renderer.NodeEditor and Rkns.Renderer.EdgeEditor */\n        drawEditBox: function(_options, _coords, _path, _xmargin, _selector) {\n            _selector.css({\n                width: (_options.tooltip_width - 2 * _options.tooltip_padding)\n            });\n            var _height = _selector.outerHeight() + 2 * _options.tooltip_padding,\n                _isLeft = (_coords.x < paper.view.center.x ? 1 : -1),\n                _left = _coords.x + _isLeft * (_xmargin + _options.tooltip_arrow_length),\n                _right = _coords.x + _isLeft * (_xmargin + _options.tooltip_arrow_length + _options.tooltip_width),\n                _top = _coords.y - _height / 2;\n            if (_top + _height > (paper.view.size.height - _options.tooltip_margin)) {\n                _top = Math.max(paper.view.size.height - _options.tooltip_margin, _coords.y + _options.tooltip_arrow_width / 2) - _height;\n            }\n            if (_top < _options.tooltip_margin) {\n                _top = Math.min(_options.tooltip_margin, _coords.y - _options.tooltip_arrow_width / 2);\n            }\n            var _bottom = _top + _height;\n            /* jshint laxbreak:true */\n            _path.segments[0].point = _path.segments[7].point = _coords.add([_isLeft * _xmargin, 0]);\n            _path.segments[1].point.x = _path.segments[2].point.x = _path.segments[5].point.x = _path.segments[6].point.x = _left;\n            _path.segments[3].point.x = _path.segments[4].point.x = _right;\n            _path.segments[2].point.y = _path.segments[3].point.y = _top;\n            _path.segments[4].point.y = _path.segments[5].point.y = _bottom;\n            _path.segments[1].point.y = _coords.y - _options.tooltip_arrow_width / 2;\n            _path.segments[6].point.y = _coords.y + _options.tooltip_arrow_width / 2;\n            _path.fillColor = new paper.Color(new paper.Gradient([_options.tooltip_top_color, _options.tooltip_bottom_color]), [0, _top], [0, _bottom]);\n            _selector.css({\n                left: (_options.tooltip_padding + Math.min(_left, _right)),\n                top: (_options.tooltip_padding + _top)\n            });\n            return _path;\n        },\n        // from http://stackoverflow.com/a/6444043\n        increaseBrightness: function (hex, percent){\n            // strip the leading # if it's there\n            hex = hex.replace(/^\\s*#|\\s*$/g, '');\n\n            // convert 3 char codes --> 6, e.g. `E0F` --> `EE00FF`\n            if(hex.length === 3){\n                hex = hex.replace(/(.)/g, '$1$1');\n            }\n\n            var r = parseInt(hex.substr(0, 2), 16),\n                g = parseInt(hex.substr(2, 2), 16),\n                b = parseInt(hex.substr(4, 2), 16);\n\n            return '#' +\n               ((0|(1<<8) + r + (256 - r) * percent / 100).toString(16)).substr(1) +\n               ((0|(1<<8) + g + (256 - g) * percent / 100).toString(16)).substr(1) +\n               ((0|(1<<8) + b + (256 - b) * percent / 100).toString(16)).substr(1);\n        }\n    };\n})(window);\n\n/* END main.js */\n","(function(root) {\n    \"use strict\";\n    \n    var Backbone = root.Backbone;\n    \n    var Router = root.Rkns.Router = Backbone.Router.extend({\n        routes: {\n            '': 'index'\n        },\n        \n        index: function (parameters) {\n            \n            var result = {};\n            if (parameters !== null){\n                parameters.split(\"&\").forEach(function(part) {\n                    var item = part.split(\"=\");\n                    result[item[0]] = decodeURIComponent(item[1]);\n                });\n            }\n            this.trigger('router', result);        \n        }  \n    });\n\n})(window);","(function(root) {\n\n    \"use strict\";\n\n    var DataLoader = root.Rkns.DataLoader = {\n        converters: {\n            from1to2: function(data) {\n\n                var i, len;\n                if(typeof data.nodes !== 'undefined') {\n                    for(i=0, len=data.nodes.length; i<len; i++) {\n                        var node = data.nodes[i];\n                        if(node.color) {\n                            node.style = {\n                                color: node.color,\n                            };\n                        }\n                        else {\n                            node.style = {};\n                        }\n                    }\n                }\n                if(typeof data.edges !== 'undefined') {\n                    for(i=0, len=data.edges.length; i<len; i++) {\n                        var edge = data.edges[i];\n                        if(edge.color) {\n                            edge.style = {\n                                color: edge.color,\n                            };\n                        }\n                        else {\n                            edge.style = {};\n                        }\n                    }\n                }\n\n                data.schema_version = \"2\";\n\n                return data;\n            },\n        }\n    };\n\n\n    DataLoader.Loader = function(project, options) {\n        this.project = project;\n        this.dataConverters = _.defaults(options.converters || {}, DataLoader.converters);\n    };\n\n\n    DataLoader.Loader.prototype.convert = function(data) {\n        var schemaVersionFrom = this.project.getSchemaVersion(data);\n        var schemaVersionTo = this.project.getSchemaVersion();\n\n        if (schemaVersionFrom !== schemaVersionTo) {\n            var converterName = \"from\" + schemaVersionFrom + \"to\" + schemaVersionTo;\n            if (typeof this.dataConverters[converterName] === 'function') {\n                data = this.dataConverters[converterName](data);\n            }\n        }\n        return data;\n    };\n\n    DataLoader.Loader.prototype.load = function(data) {\n        this.project.set(this.convert(data), {\n            validate: true\n        });\n    };\n\n})(window);\n","(function(root) {\n    \"use strict\";\n\n    var Backbone = root.Backbone;\n\n    var Models = root.Rkns.Models = {};\n\n    Models.getUID = function(obj) {\n        var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,\n                function(c) {\n                    var r = Math.random() * 16 | 0, v = c === 'x' ? r\n                            : (r & 0x3 | 0x8);\n                    return v.toString(16);\n                });\n        if (typeof obj !== 'undefined') {\n            return obj.type + \"-\" + guid;\n        }\n        else {\n            return guid;\n        }\n    };\n\n    var RenkanModel = Backbone.RelationalModel.extend({\n        idAttribute : \"_id\",\n        constructor : function(options) {\n\n            if (typeof options !== \"undefined\") {\n                options._id = options._id || options.id || Models.getUID(this);\n                options.title = options.title || \"\";\n                options.description = options.description || \"\";\n                options.uri = options.uri || \"\";\n\n                if (typeof this.prepare === \"function\") {\n                    options = this.prepare(options);\n                }\n            }\n            Backbone.RelationalModel.prototype.constructor.call(this, options);\n        },\n        validate : function() {\n            if (!this.type) {\n                return \"object has no type\";\n            }\n        },\n        addReference : function(_options, _propName, _list, _id, _default) {\n            var _element = _list.get(_id);\n            if (typeof _element === \"undefined\" &&\n                typeof _default !== \"undefined\") {\n                _options[_propName] = _default;\n            }\n            else {\n                _options[_propName] = _element;\n            }\n        }\n    });\n\n    // USER\n    var User = Models.User = RenkanModel.extend({\n        type : \"user\",\n        prepare : function(options) {\n            options.color = options.color || \"#666666\";\n            return options;\n        },\n        toJSON : function() {\n            return {\n                _id : this.get(\"_id\"),\n                title : this.get(\"title\"),\n                uri : this.get(\"uri\"),\n                description : this.get(\"description\"),\n                color : this.get(\"color\")\n            };\n        }\n    });\n\n    // NODE\n    var Node = Models.Node = RenkanModel.extend({\n        type : \"node\",\n        relations : [ {\n            type : Backbone.HasOne,\n            key : \"created_by\",\n            relatedModel : User\n        } ],\n        prepare : function(options) {\n            var project = options.project;\n            this.addReference(options, \"created_by\", project.get(\"users\"),\n                    options.created_by, project.current_user);\n            options.description = options.description || \"\";\n            return options;\n        },\n        toJSON : function() {\n            return {\n                _id : this.get(\"_id\"),\n                title : this.get(\"title\"),\n                uri : this.get(\"uri\"),\n                description : this.get(\"description\"),\n                position : this.get(\"position\"),\n                image : this.get(\"image\"),\n                style : this.get(\"style\"),\n                created_by : this.get(\"created_by\") ? this.get(\"created_by\")\n                        .get(\"_id\") : null,\n                size : this.get(\"size\"),\n                clip_path : this.get(\"clip_path\"),\n                shape : this.get(\"shape\"),  \n                type : this.get(\"type\")\n            };\n        }\n    });\n\n    // EDGE\n    var Edge = Models.Edge = RenkanModel.extend({\n        type : \"edge\",\n        relations : [ {\n            type : Backbone.HasOne,\n            key : \"created_by\",\n            relatedModel : User\n        }, {\n            type : Backbone.HasOne,\n            key : \"from\",\n            relatedModel : Node\n        }, {\n            type : Backbone.HasOne,\n            key : \"to\",\n            relatedModel : Node\n        } ],\n        prepare : function(options) {\n            var project = options.project;\n            this.addReference(options, \"created_by\", project.get(\"users\"),\n                    options.created_by, project.current_user);\n            this.addReference(options, \"from\", project.get(\"nodes\"),\n                    options.from);\n            this.addReference(options, \"to\", project.get(\"nodes\"), options.to);\n            return options;\n        },\n        toJSON : function() {\n            return {\n                _id : this.get(\"_id\"),\n                title : this.get(\"title\"),\n                uri : this.get(\"uri\"),\n                description : this.get(\"description\"),\n                from : this.get(\"from\") ? this.get(\"from\").get(\"_id\") : null,\n                to : this.get(\"to\") ? this.get(\"to\").get(\"_id\") : null,\n                style : this.get(\"style\"),\n                created_by : this.get(\"created_by\") ? this.get(\"created_by\")\n                        .get(\"_id\") : null\n            };\n        }\n    });\n\n    // View\n    var View = Models.View = RenkanModel.extend({\n        type : \"view\",\n        relations : [ {\n            type : Backbone.HasOne,\n            key : \"created_by\",\n            relatedModel : User\n        } ],\n        prepare : function(options) {\n            var project = options.project;\n            this.addReference(options, \"created_by\", project.get(\"users\"),\n                    options.created_by, project.current_user);\n            options.description = options.description || \"\";\n            if (typeof options.offset !== \"undefined\") {\n                var offset = {};\n                if (Array.isArray(options.offset)) {\n                    offset.x = options.offset[0];\n                    offset.y = options.offset.length > 1 ? options.offset[1]\n                            : options.offset[0];\n                }\n                else if (options.offset.x != null) {\n                    offset.x = options.offset.x;\n                    offset.y = options.offset.y;\n                }\n                options.offset = offset;\n            }\n            return options;\n        },\n        toJSON : function() {\n            return {\n                _id : this.get(\"_id\"),\n                zoom_level : this.get(\"zoom_level\"),\n                offset : this.get(\"offset\"),\n                title : this.get(\"title\"),\n                description : this.get(\"description\"),\n                created_by : this.get(\"created_by\") ? this.get(\"created_by\")\n                        .get(\"_id\") : null,\n                hidden_nodes: this.get(\"hidden_nodes\")\n            // Don't need project id\n            };\n        }\n    });\n\n    // PROJECT\n    var Project = Models.Project = RenkanModel.extend({\n        schema_version : \"2\",\n        type : \"project\",\n        blacklist : [ 'saveStatus', 'loadingStatus'],\n        relations : [ {\n            type : Backbone.HasMany,\n            key : \"users\",\n            relatedModel : User,\n            reverseRelation : {\n                key : 'project',\n                includeInJSON : '_id'\n            }\n        }, {\n            type : Backbone.HasMany,\n            key : \"nodes\",\n            relatedModel : Node,\n            reverseRelation : {\n                key : 'project',\n                includeInJSON : '_id'\n            }\n        }, {\n            type : Backbone.HasMany,\n            key : \"edges\",\n            relatedModel : Edge,\n            reverseRelation : {\n                key : 'project',\n                includeInJSON : '_id'\n            }\n        }, {\n            type : Backbone.HasMany,\n            key : \"views\",\n            relatedModel : View,\n            reverseRelation : {\n                key : 'project',\n                includeInJSON : '_id'\n            }\n        } ],\n        addUser : function(_props, _options) {\n            _props.project = this;\n            var _user = User.findOrCreate(_props);\n            this.get(\"users\").push(_user, _options);\n            return _user;\n        },\n        addNode : function(_props, _options) {\n            _props.project = this;\n            var _node = Node.findOrCreate(_props);\n            this.get(\"nodes\").push(_node, _options);\n            return _node;\n        },\n        addEdge : function(_props, _options) {\n            _props.project = this;\n            var _edge = Edge.findOrCreate(_props);\n            this.get(\"edges\").push(_edge, _options);\n            return _edge;\n        },\n        addView : function(_props, _options) {\n            _props.project = this;\n            // TODO: check if need to replace with create only\n            var _view = View.findOrCreate(_props);\n            // TODO: Should we remember only one view?\n            this.get(\"views\").push(_view, _options);\n            return _view;\n        },\n        removeNode : function(_model) {\n            this.get(\"nodes\").remove(_model);\n        },\n        removeEdge : function(_model) {\n            this.get(\"edges\").remove(_model);\n        },\n        validate : function(options) {\n            var _project = this;\n            _.each(\n              [].concat(options.users, options.nodes, options.edges,options.views),\n              function(_item) {\n                if (_item) {\n                    _item.project = _project;\n                }\n              }\n            );\n        },\n        getSchemaVersion : function(data) {\n          var t = data;\n          if(typeof(t) === \"undefined\") {\n            t = this;\n          }\n          var version = t.schema_version;\n          if(!version) {\n            return 1;\n          }\n          else {\n            return version;\n          }\n        },\n        // Add event handler to remove edges when a node is removed\n        initialize : function() {\n            var _this = this;\n            this.on(\"remove:nodes\", function(_node) {\n                _this.get(\"edges\").remove(\n                        _this.get(\"edges\").filter(\n                                function(_edge) {\n                                    return _edge.get(\"from\") === _node ||\n                                           _edge.get(\"to\") === _node;\n                                }));\n            });\n        },\n        toJSON : function() {\n            var json = _.clone(this.attributes);\n            for ( var attr in json) {\n                if ((json[attr] instanceof Backbone.Model) ||\n                        (json[attr] instanceof Backbone.Collection) ||\n                        (json[attr] instanceof RenkanModel)) {\n                    json[attr] = json[attr].toJSON();\n                }\n            }\n            return _.omit(json, this.blacklist);\n        }\n    });\n\n    var RosterUser = Models.RosterUser = Backbone.Model\n            .extend({\n                type : \"roster_user\",\n                idAttribute : \"_id\",\n\n                constructor : function(options) {\n\n                    if (typeof options !== \"undefined\") {\n                        options._id = options._id ||\n                            options.id ||\n                            Models.getUID(this);\n                        options.title = options.title || \"(untitled \" + this.type + \")\";\n                        options.description = options.description || \"\";\n                        options.uri = options.uri || \"\";\n                        options.project = options.project || null;\n                        options.site_id = options.site_id || 0;\n\n                        if (typeof this.prepare === \"function\") {\n                            options = this.prepare(options);\n                        }\n                    }\n                    Backbone.Model.prototype.constructor.call(this, options);\n                },\n\n                validate : function() {\n                    if (!this.type) {\n                        return \"object has no type\";\n                    }\n                },\n\n                prepare : function(options) {\n                    options.color = options.color || \"#666666\";\n                    return options;\n                },\n\n                toJSON : function() {\n                    return {\n                        _id : this.get(\"_id\"),\n                        title : this.get(\"title\"),\n                        uri : this.get(\"uri\"),\n                        description : this.get(\"description\"),\n                        color : this.get(\"color\"),\n                        project : (this.get(\"project\") != null) ? this.get(\n                                \"project\").get(\"id\") : null,\n                        site_id : this.get(\"site_id\")\n                    };\n                }\n            });\n\n    var UsersList = Models.UsersList = Backbone.Collection.extend({\n        model : RosterUser\n    });\n\n})(window);\n","Rkns.defaults = {\n\n    language: (navigator.language || navigator.userLanguage || \"en\"),\n        /* GUI Language */\n    container: \"renkan\",\n        /* GUI Container DOM element ID */\n    search: [],\n        /* List of Search Engines */\n    bins: [],\n           /* List of Bins */\n    static_url: \"\",\n        /* URL for static resources */\n    popup_editor: true,\n        /* show the node editor as a popup inside the renkan view */\n    editor_panel: 'editor-panel',\n        /* GUI continer DOM element ID of the editor panel */\n    show_bins: true,\n        /* Show bins in left column */\n    properties: [],\n        /* Semantic properties for edges */\n    show_editor: true,\n        /* Show the graph editor... Setting this to \"false\" only shows the bins part ! */\n    read_only: false,\n        /* Allows editing of renkan without changing the rest of the GUI. Can be switched on/off on the fly to block/enable editing */\n    editor_mode: true,\n        /* Switch for Publish/Edit GUI. If editor_mode is false, read_only will be true.  */\n    manual_save: false,\n        /* In snapshot mode, clicking on the floppy will save a snapshot. Otherwise, it will show the connection status */\n    show_top_bar: true,\n        /* Show the top bar, (title, buttons, users) */\n    default_user_color: \"#303030\",\n    size_bug_fix: false,\n        /* Resize the canvas after load (fixes a bug on iPad and FF Mac) */\n    force_resize: false,\n    allow_double_click: true,\n        /* Allows Double Click to create a node on an empty background */\n    zoom_on_scroll: true,\n        /* Allows to use the scrollwheel to zoom */\n    element_delete_delay: 0,\n        /* Delay between clicking on the bin on an element and really deleting it\n           Set to 0 for delete confirm */\n    autoscale_padding: 50,\n    resize: true,\n\n    /* zoom options */\n    show_zoom: true,\n        /* show zoom buttons */\n    save_view: true,\n        /* show buttons to save view */\n    default_view: false,\n        /* Allows to load default view (zoom+offset) at start on read_only mode, instead of autoScale. the default_view will be the last */\n    default_index_view: -1,\n    \n    /* URL parsing */\n    update_url:true,\n        /* update the url each time the paper shift or on zoom in/out, with the serialized view (offset and scale) */\n    \n\n    /* TOP BAR BUTTONS */\n    show_search_field: true,\n    show_user_list: true,\n    user_name_editable: true,\n    user_color_editable: true,\n    show_user_color: true,\n    show_save_button: true,\n    show_export_button: true,\n    show_open_button: false,\n    show_addnode_button: true,\n    show_addedge_button: true,\n    show_bookmarklet: true,\n    show_fullscreen_button: true,\n    home_button_url: false,\n    home_button_title: \"Home\",\n\n    /* MINI-MAP OPTIONS */\n\n    show_minimap: true,\n        /* Show a small map at the bottom right */\n    minimap_width: 160,\n    minimap_height: 120,\n    minimap_padding: 20,\n    minimap_background_color: \"#ffffff\",\n    minimap_border_color: \"#cccccc\",\n    minimap_highlight_color: \"#ffff00\",\n    minimap_highlight_weight: 5,\n\n\n    /* EDGE/NODE COMMON OPTIONS */\n\n    buttons_background: \"#202020\",\n    buttons_label_color: \"#c000c0\",\n    buttons_label_font_size: 9,\n\n    ghost_opacity : 0.3,\n        /* opacity when the hidden element is revealed */\n    default_dash_array : [4, 5],\n        /* dash line genometry */\n\n    /* NODE DISPLAY OPTIONS */\n\n    show_node_circles: true,\n        /* Show circles for nodes */\n    clip_node_images: true,\n        /* Constraint node images to circles */\n    node_images_fill_mode: false,\n        /* Set to false for \"letterboxing\" (height/width of node adapted to show full image)\n           Set to true for \"crop\" (adapted to fill circle) */\n    node_size_base: 25,\n    node_stroke_width: 2,\n    node_stroke_max_width: 12,\n    selected_node_stroke_width: 4,\n    selected_node_stroke_max_width: 24,\n    node_stroke_witdh_scale: 5,\n    node_fill_color: \"#ffffff\",\n    highlighted_node_fill_color: \"#ffff00\",\n    node_label_distance: 5,\n        /* Vertical distance between node and label */\n    node_label_max_length: 60,\n        /* Maximum displayed text length */\n    label_untitled_nodes: \"(untitled)\",\n        /* Label to display on untitled nodes */\n    hide_nodes: true,\n        /* allow hide/show nodes */\n    change_shapes: true,\n        /* Change shapes enabled */\n    change_types: true,\n    /* Change type enabled */\n\n    /* NODE EDITOR TEMPLATE*/\n\n    node_editor_templates: {\n        \"default\": \"templates/nodeeditor_readonly.html\",\n        \"video\": \"templates/nodeeditor_video.html\"\n    },\n\n    /* EDGE DISPLAY OPTIONS */\n\n    edge_stroke_width: 2,\n    edge_stroke_max_width: 12,\n    selected_edge_stroke_width: 4,\n    selected_edge_stroke_max_width: 24,\n    edge_stroke_witdh_scale: 5,\n\n    edge_label_distance: 0,\n    edge_label_max_length: 20,\n    edge_arrow_length: 18,\n    edge_arrow_width: 12,\n    edge_arrow_max_width: 32,\n    edge_gap_in_bundles: 12,\n    label_untitled_edges: \"\",\n\n    /* CONTEXTUAL DISPLAY (TOOLTIP OR EDITOR) OPTIONS */\n\n    tooltip_width: 275,\n    tooltip_padding: 10,\n    tooltip_margin: 15,\n    tooltip_arrow_length : 20,\n    tooltip_arrow_width : 40,\n    tooltip_top_color: \"#f0f0f0\",\n    tooltip_bottom_color: \"#d0d0d0\",\n    tooltip_border_color: \"#808080\",\n    tooltip_border_width: 1,\n    tooltip_opacity: 0.8,\n\n    richtext_editor_config: {\n        toolbarGroups: [\n            { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n            { name: 'clipboard',   groups: [ 'clipboard', 'undo' ] },\n            '/',\n\t        { name: 'styles'},\n        ],\n        removePlugins : 'colorbutton,find,flash,font,forms,iframe,image,newpage,smiley,specialchar,stylescombo,templates',\n    },\n\n    /* NODE EDITOR OPTIONS */\n\n    show_node_editor_uri: true,\n    show_node_editor_description: true,\n    show_node_editor_description_richtext: true,\n    show_node_editor_size: true,\n    show_node_editor_style: true,\n    show_node_editor_style_color: true,\n    show_node_editor_style_dash: true,\n    show_node_editor_style_thickness: true,\n    show_node_editor_image: true,\n    show_node_editor_creator: true,\n    allow_image_upload: true,\n    uploaded_image_max_kb: 500,\n\n\n    /* NODE TOOLTIP OPTIONS */\n\n    show_node_tooltip_uri: true,\n    show_node_tooltip_description: true,\n    show_node_tooltip_color: true,\n    show_node_tooltip_image: true,\n    show_node_tooltip_creator: true,\n\n    /* EDGE EDITOR OPTIONS */\n\n    show_edge_editor_uri: true,\n    show_edge_editor_style: true,\n    show_edge_editor_style_color: true,\n    show_edge_editor_style_dash: true,\n    show_edge_editor_style_thickness: true,\n    show_edge_editor_style_arrow: true,\n    show_edge_editor_direction: true,\n    show_edge_editor_nodes: true,\n    show_edge_editor_creator: true,\n\n    /* EDGE TOOLTIP OPTIONS */\n\n    show_edge_tooltip_uri: true,\n    show_edge_tooltip_color: true,\n    show_edge_tooltip_nodes: true,\n    show_edge_tooltip_creator: true,\n\n};\n","Rkns.i18n = {\n    fr: {\n        \"Edit Node\": \"Édition d’un nœud\",\n        \"Edit Edge\": \"Édition d’un lien\",\n        \"Title:\": \"Titre :\",\n        \"URI:\": \"URI :\",\n        \"Description:\": \"Description :\",\n        \"From:\": \"De :\",\n        \"To:\": \"Vers :\",\n        \"Image\": \"Image\",\n        \"Image URL:\": \"URL d'Image\",\n        \"Choose Image File:\": \"Choisir un fichier image\",\n        \"Full Screen\": \"Mode plein écran\",\n        \"Add Node\": \"Ajouter un nœud\",\n        \"Add Edge\": \"Ajouter un lien\",\n        \"Save Project\": \"Enregistrer le projet\",\n        \"Open Project\": \"Ouvrir un projet\",\n        \"Auto-save enabled\": \"Enregistrement automatique activé\",\n        \"Connection lost\": \"Connexion perdue\",\n        \"Created by:\": \"Créé par :\",\n        \"Zoom In\": \"Agrandir l’échelle\",\n        \"Zoom Out\": \"Rapetisser l’échelle\",\n        \"Edit\": \"Éditer\",\n        \"Remove\": \"Supprimer\",\n        \"Cancel deletion\": \"Annuler la suppression\",\n        \"Link to another node\": \"Créer un lien\",\n        \"Enlarge\": \"Agrandir\",\n        \"Shrink\": \"Rétrécir\",\n        \"Click on the background canvas to add a node\": \"Cliquer sur le fond du graphe pour rajouter un nœud\",\n        \"Click on a first node to start the edge\": \"Cliquer sur un premier nœud pour commencer le lien\",\n        \"Click on a second node to complete the edge\": \"Cliquer sur un second nœud pour terminer le lien\",\n        \"Wikipedia\": \"Wikipédia\",\n        \"Wikipedia in \": \"Wikipédia en \",\n        \"French\": \"Français\",\n        \"English\": \"Anglais\",\n        \"Japanese\": \"Japonais\",\n        \"Untitled project\": \"Projet sans titre\",\n        \"Lignes de Temps\": \"Lignes de Temps\",\n        \"Loading, please wait\": \"Chargement en cours, merci de patienter\",\n        \"Edge color:\": \"Couleur :\",\n        \"Dash:\": \"Point. :\",\n        \"Thickness:\": \"Epaisseur :\",\n        \"Arrow:\": \"Flèche :\",\n        \"Node color:\": \"Couleur :\",\n        \"Choose color\": \"Choisir une couleur\",\n        \"Change edge direction\": \"Changer le sens du lien\",\n        \"Do you really wish to remove node \": \"Voulez-vous réellement supprimer le nœud \",\n        \"Do you really wish to remove edge \": \"Voulez-vous réellement supprimer le lien \",\n        \"This file is not an image\": \"Ce fichier n'est pas une image\",\n        \"Image size must be under \": \"L'image doit peser moins de \",\n        \"Size:\": \"Taille :\",\n        \"KB\": \"ko\",\n        \"Choose from vocabulary:\": \"Choisir dans un vocabulaire :\",\n        \"SKOS Documentation properties\": \"SKOS: Propriétés documentaires\",\n        \"has note\": \"a pour note\",\n        \"has example\": \"a pour exemple\",\n        \"has definition\": \"a pour définition\",\n        \"SKOS Semantic relations\": \"SKOS: Relations sémantiques\",\n        \"has broader\": \"a pour concept plus large\",\n        \"has narrower\": \"a pour concept plus étroit\",\n        \"has related\": \"a pour concept apparenté\",\n        \"Dublin Core Metadata\": \"Métadonnées Dublin Core\",\n        \"has contributor\": \"a pour contributeur\",\n        \"covers\": \"couvre\",\n        \"created by\": \"créé par\",\n        \"has date\": \"a pour date\",\n        \"published by\": \"édité par\",\n        \"has source\": \"a pour source\",\n        \"has subject\": \"a pour sujet\",\n        \"Dragged resource\": \"Ressource glisée-déposée\",\n        \"Search the Web\": \"Rechercher en ligne\",\n        \"Search in Bins\": \"Rechercher dans les chutiers\",\n        \"Close bin\": \"Fermer le chutier\",\n        \"Refresh bin\": \"Rafraîchir le chutier\",\n        \"(untitled)\": \"(sans titre)\",\n        \"Select contents:\": \"Sélectionner des contenus :\",\n        \"Drag items from this website, drop them in Renkan\": \"Glissez des éléments de ce site web vers Renkan\",\n        \"Drag this button to your bookmark bar. When on a third-party website, click it to enable drag-and-drop from the website to Renkan.\": \"Glissez ce bouton vers votre barre de favoris. Ensuite, depuis un site tiers, cliquez dessus pour activer 'Drag-to-Add' puis glissez des éléments de ce site vers Renkan\",\n        \"Shapes available\": \"Formes disponibles\",\n        \"Circle\": \"Cercle\",\n        \"Square\": \"Carré\",\n        \"Diamond\": \"Losange\",\n        \"Hexagone\": \"Hexagone\",\n        \"Ellipse\": \"Ellipse\",\n        \"Star\": \"Étoile\",\n        \"Cloud\": \"Nuage\",\n        \"Triangle\": \"Triangle\",\n        \"Zoom Fit\": \"Ajuster le Zoom\",\n        \"Download Project\": \"Télécharger le projet\",\n        \"Save view\": \"Sauver la vue\",\n        \"View saved view\": \"Restaurer la Vue\",\n        \"Renkan \\'Drag-to-Add\\' bookmarklet\": \"Renkan \\'Deplacer-Pour-Ajouter\\' Signet\",\n        \"(unknown user)\":\"(non authentifié)\",\n        \"<unknown user>\":\"<non authentifié>\",\n        \"Search in graph\":\"Rechercher dans carte\",\n        \"Search in \" : \"Chercher dans \"\n    }\n};\n","/* Saves the Full JSON at each modification */\n\nRkns.jsonIO = function(_renkan, _opts) {\n    var _proj = _renkan.project;\n    if (typeof _opts.http_method === \"undefined\") {\n        _opts.http_method = 'PUT';\n    }\n    var _load = function() {\n        _renkan.renderer.redrawActive = false;\n        _proj.set({\n            loadingStatus : true\n        });\n        Rkns.$.getJSON(_opts.url, function(_data) {\n            _renkan.dataloader.load(_data);\n            _proj.set({\n                loadingStatus : false\n            });\n            _proj.set({\n                saveStatus : 0\n            });\n            _renkan.renderer.redrawActive = true;\n        });\n    };\n    var _save = function() {\n        _proj.set({\n            saveStatus : 2\n        });\n        var _data = _proj.toJSON();\n        if (!_renkan.read_only) {\n            Rkns.$.ajax({\n                type : _opts.http_method,\n                url : _opts.url,\n                contentType : \"application/json\",\n                data : JSON.stringify(_data),\n                success : function(data, textStatus, jqXHR) {\n                    _proj.set({\n                        saveStatus : 0\n                    });\n                }\n            });\n        }\n\n    };\n    var _thrSave = Rkns._.throttle(function() {\n        setTimeout(_save, 100);\n    }, 1000);\n    \n    //TODO: Rearrange to avoid the 2 firts PUT due to a change in the project model\n    // Take car of setting up the listener correctly to listen the save action on the view\n    _proj.on(\"add:nodes add:edges add:users add:views\", function(_model) {\n        _model.on(\"change remove\", function(_model) {\n            _thrSave();\n        });\n        _thrSave();\n    });\n    _proj.on(\"change\", function() {\n        if (!(_proj.changedAttributes.length === 1 && _proj\n                .hasChanged('saveStatus'))) {\n            _thrSave();\n        }\n    });\n\n    _load();\n};\n","/* Saves the Full JSON once */\n\nRkns.jsonIOSaveOnClick = function(_renkan, _opts) {\n    var _proj = _renkan.project,\n        _saveWarn = false,\n        _onLeave = function() {\n            return \"Project not saved\";\n        };\n    if (typeof _opts.http_method === \"undefined\") {\n        _opts.http_method = 'POST';\n    }\n    var _load = function() {\n        var getdata = {},\n            rx = /id=([^&#?=]+)/,\n            matches = document.location.hash.match(rx);\n        if (matches) {\n            getdata.id = matches[1];\n        }\n        Rkns.$.ajax({\n            url: _opts.url,\n            data: getdata,\n            beforeSend: function(){\n                _renkan.renderer.redrawActive = false;\n            \t_proj.set({loadingStatus:true});\n            },\n            success: function(_data) {\n                _renkan.dataloader.load(_data);\n                _proj.set({loadingStatus:false});\n                _proj.set({saveStatus:0});\n                _renkan.renderer.redrawActive = true;\n            }\n        });\n    };\n    var _save = function() {\n        _proj.set(\"saved_at\", new Date());\n        var _data = _proj.toJSON();\n        Rkns.$.ajax({\n            type: _opts.http_method,\n            url: _opts.url,\n            contentType: \"application/json\",\n            data: JSON.stringify(_data),\n            beforeSend: function(){\n            \t_proj.set({saveStatus:2});\n            },\n            success: function(data, textStatus, jqXHR) {\n                $(window).off(\"beforeunload\", _onLeave);\n                _saveWarn = false;\n                _proj.set({saveStatus:0});\n                //document.location.hash = \"#id=\" + data.id;\n                //$(\".Rk-Notifications\").text(\"Saved as \"+document.location.href).fadeIn().delay(2000).fadeOut();\n            }\n        });\n    };\n    var _checkLeave = function() {\n    \t_proj.set({saveStatus:1});\n\n        var title = _proj.get(\"title\");\n        if (title && _proj.get(\"nodes\").length) {\n            $(\".Rk-Save-Button\").removeClass(\"disabled\");\n        } else {\n            $(\".Rk-Save-Button\").addClass(\"disabled\");\n        }\n        if (title) {\n            $(\".Rk-PadTitle\").css(\"border-color\",\"#333333\");\n        }\n        if (!_saveWarn) {\n            _saveWarn = true;\n            $(window).on(\"beforeunload\", _onLeave);\n        }\n    };\n    _load();\n    _proj.on(\"add:nodes add:edges add:users change\", function(_model) {\n\t    _model.on(\"change remove\", function(_model) {\n\t    \tif(!(_model.changedAttributes.length === 1 && _model.hasChanged('saveStatus'))) {\n\t    \t\t_checkLeave();\n\t    \t}\n\t    });\n\t\tif(!(_proj.changedAttributes.length === 1 && _proj.hasChanged('saveStatus'))) {\n\t\t    _checkLeave();\n    \t}\n    });\n    _renkan.renderer.save = function() {\n        if ($(\".Rk-Save-Button\").hasClass(\"disabled\")) {\n            if (!_proj.get(\"title\")) {\n                $(\".Rk-PadTitle\").css(\"border-color\",\"#ff0000\");\n            }\n        } else {\n            _save();\n        }\n    };\n};\n","(function(Rkns) {\n\"use strict\";\n\nvar _ = Rkns._;\n\nvar Ldt = Rkns.Ldt = {};\n\nvar Bin = Ldt.Bin = function(_renkan, _opts) {\n    if (_opts.ldt_type) {\n        var Resclass = Ldt[_opts.ldt_type+\"Bin\"];\n        if (Resclass) {\n            return new Resclass(_renkan, _opts);\n        }\n    }\n    console.error(\"No such LDT Bin Type\");\n};\n\nvar ProjectBin = Ldt.ProjectBin = Rkns.Utils.inherit(Rkns._BaseBin);\n\nProjectBin.prototype.tagTemplate = renkanJST['templates/ldtjson-bin/tagtemplate.html'];\n\nProjectBin.prototype.annotationTemplate = renkanJST['templates/ldtjson-bin/annotationtemplate.html'];\n\nProjectBin.prototype._init = function(_renkan, _opts) {\n    this.renkan = _renkan;\n    this.proj_id = _opts.project_id;\n    this.ldt_platform = _opts.ldt_platform || \"http://ldt.iri.centrepompidou.fr/\";\n    this.title_$.html(_opts.title);\n    this.title_icon_$.addClass('Rk-Ldt-Title-Icon');\n    this.refresh();\n};\n\nProjectBin.prototype.render = function(searchbase) {\n    var search = searchbase || Rkns.Utils.regexpFromTextOrArray();\n    function highlight(_text) {\n        var _e = _(_text).escape();\n        return search.isempty ? _e : search.replace(_e, \"<span class='searchmatch'>$1</span>\");\n    }\n    function convertTC(_ms) {\n        function pad(_n) {\n            var _res = _n.toString();\n            while (_res.length < 2) {\n                _res = '0' + _res;\n            }\n            return _res;\n        }\n        var _totalSeconds = Math.abs(Math.floor(_ms/1000)),\n            _hours = Math.floor(_totalSeconds / 3600),\n            _minutes = (Math.floor(_totalSeconds / 60) % 60),\n            _seconds = _totalSeconds % 60,\n            _res = '';\n        if (_hours) {\n            _res += pad(_hours) + ':';\n        }\n        _res += pad(_minutes) + ':' + pad(_seconds);\n        return _res;\n    }\n\n    var _html = '<li><h3>Tags</h3></li>',\n        _projtitle = this.data.meta[\"dc:title\"],\n        _this = this,\n        count = 0;\n    _this.title_$.text('LDT Project: \"' + _projtitle + '\"');\n    _.map(_this.data.tags,function(_tag) {\n        var _title = _tag.meta[\"dc:title\"];\n        if (!search.isempty && !search.test(_title)) {\n            return;\n        }\n        count++;\n        _html += _this.tagTemplate({\n            ldt_platform: _this.ldt_platform,\n            title: _title,\n            htitle: highlight(_title),\n            encodedtitle : encodeURIComponent(_title),\n            static_url: _this.renkan.options.static_url\n        });\n    });\n    _html += '<li><h3>Annotations</h3></li>';\n    _.map(_this.data.annotations,function(_annotation) {\n        var _description = _annotation.content.description,\n            _title = _annotation.content.title.replace(_description,\"\");\n        if (!search.isempty && !search.test(_title) && !search.test(_description)) {\n            return;\n        }\n        count++;\n        var _duration = _annotation.end - _annotation.begin,\n            _img = (\n                (_annotation.content && _annotation.content.img && _annotation.content.img.src) ?\n                  _annotation.content.img.src :\n                  ( _duration ? _this.renkan.options.static_url+\"img/ldt-segment.png\" : _this.renkan.options.static_url+\"img/ldt-point.png\" )\n            );\n        _html += _this.annotationTemplate({\n            ldt_platform: _this.ldt_platform,\n            title: _title,\n            htitle: highlight(_title),\n            description: _description,\n            hdescription: highlight(_description),\n            start: convertTC(_annotation.begin),\n            end: convertTC(_annotation.end),\n            duration: convertTC(_duration),\n            mediaid: _annotation.media,\n            annotationid: _annotation.id,\n            image: _img,\n            static_url: _this.renkan.options.static_url\n        });\n    });\n\n    this.main_$.html(_html);\n    if (!search.isempty && count) {\n        this.count_$.text(count).show();\n    } else {\n        this.count_$.hide();\n    }\n    if (!search.isempty && !count) {\n        this.$.hide();\n    } else {\n        this.$.show();\n    }\n    this.renkan.resizeBins();\n};\n\nProjectBin.prototype.refresh = function() {\n    var _this = this;\n    Rkns.$.ajax({\n        url: this.ldt_platform + 'ldtplatform/ldt/cljson/id/' + this.proj_id,\n        dataType: \"jsonp\",\n        success: function(_data) {\n            _this.data = _data;\n            _this.render();\n        }\n    });\n};\n\nvar Search = Ldt.Search = function(_renkan, _opts) {\n    this.renkan = _renkan;\n    this.lang = _opts.lang || \"en\";\n};\n\nSearch.prototype.getBgClass = function() {\n    return \"Rk-Ldt-Icon\";\n};\n\nSearch.prototype.getSearchTitle = function() {\n    return this.renkan.translate(\"Lignes de Temps\");\n};\n\nSearch.prototype.search = function(_q) {\n    this.renkan.tabs.push(\n        new ResultsBin(this.renkan, {\n            search: _q\n        })\n    );\n};\n\nvar ResultsBin = Ldt.ResultsBin = Rkns.Utils.inherit(Rkns._BaseBin);\n\nResultsBin.prototype.segmentTemplate = renkanJST['templates/ldtjson-bin/segmenttemplate.html'];\n\nResultsBin.prototype._init = function(_renkan, _opts) {\n    this.renkan = _renkan;\n    this.ldt_platform = _opts.ldt_platform || \"http://ldt.iri.centrepompidou.fr/\";\n    this.max_results = _opts.max_results || 50;\n    this.search = _opts.search;\n    this.title_$.html('Lignes de Temps: \"' + _opts.search + '\"');\n    this.title_icon_$.addClass('Rk-Ldt-Title-Icon');\n    this.refresh();\n};\n\nResultsBin.prototype.render = function(searchbase) {\n    if (!this.data) {\n        return;\n    }\n    var search = searchbase || Rkns.Utils.regexpFromTextOrArray();\n    var highlightrx = (search.isempty ? Rkns.Utils.regexpFromTextOrArray(this.search) : search);\n    function highlight(_text) {\n        return highlightrx.replace(_(_text).escape(), \"<span class='searchmatch'>$1</span>\");\n    }\n    function convertTC(_ms) {\n        function pad(_n) {\n            var _res = _n.toString();\n            while (_res.length < 2) {\n                _res = '0' + _res;\n            }\n            return _res;\n        }\n        var _totalSeconds = Math.abs(Math.floor(_ms/1000)),\n            _hours = Math.floor(_totalSeconds / 3600),\n            _minutes = (Math.floor(_totalSeconds / 60) % 60),\n            _seconds = _totalSeconds % 60,\n            _res = '';\n        if (_hours) {\n            _res += pad(_hours) + ':';\n        }\n        _res += pad(_minutes) + ':' + pad(_seconds);\n        return _res;\n    }\n\n    var _html = '',\n        _this = this,\n        count = 0;\n    _.each(this.data.objects,function(_segment) {\n        var _description = _segment.abstract,\n            _title = _segment.title;\n        if (!search.isempty && !search.test(_title) && !search.test(_description)) {\n            return;\n        }\n        count++;\n        var _duration = _segment.duration,\n            _begin = _segment.start_ts,\n            _end = + _segment.duration + _begin,\n            _img = (\n                _duration ?\n                  _this.renkan.options.static_url + \"img/ldt-segment.png\" :\n                  _this.renkan.options.static_url + \"img/ldt-point.png\"\n            );\n        _html += _this.segmentTemplate({\n            ldt_platform: _this.ldt_platform,\n            title: _title,\n            htitle: highlight(_title),\n            description: _description,\n            hdescription: highlight(_description),\n            start: convertTC(_begin),\n            end: convertTC(_end),\n            duration: convertTC(_duration),\n            mediaid: _segment.iri_id,\n            //projectid: _segment.project_id,\n            //cuttingid: _segment.cutting_id,\n            annotationid: _segment.element_id,\n            image: _img\n        });\n    });\n\n    this.main_$.html(_html);\n    if (!search.isempty && count) {\n        this.count_$.text(count).show();\n    } else {\n        this.count_$.hide();\n    }\n    if (!search.isempty && !count) {\n        this.$.hide();\n    } else {\n        this.$.show();\n    }\n    this.renkan.resizeBins();\n};\n\nResultsBin.prototype.refresh = function() {\n    var _this = this;\n    Rkns.$.ajax({\n        url: this.ldt_platform + 'ldtplatform/api/ldt/1.0/segments/search/',\n        data: {\n            format: \"jsonp\",\n            q: this.search,\n            limit: this.max_results\n        },\n        dataType: \"jsonp\",\n        success: function(_data) {\n            _this.data = _data;\n            _this.render();\n        }\n    });\n};\n\n})(window.Rkns);\n","Rkns.ResourceList = {};\n\nRkns.ResourceList.Bin = Rkns.Utils.inherit(Rkns._BaseBin);\n\nRkns.ResourceList.Bin.prototype.resultTemplate = renkanJST['templates/list-bin.html'];\n\nRkns.ResourceList.Bin.prototype._init = function(_renkan, _opts) {\n    this.renkan = _renkan;\n    this.title_$.html(_opts.title);\n    if (_opts.list) {\n        this.data = _opts.list;\n    }\n    this.refresh();\n};\n\nRkns.ResourceList.Bin.prototype.render = function(searchbase) {\n    var search = searchbase || Rkns.Utils.regexpFromTextOrArray();\n    function highlight(_text) {\n        var _e = _(_text).escape();\n        return search.isempty ? _e : search.replace(_e, \"<span class='searchmatch'>$1</span>\");\n    }\n    var _html = \"\",\n        _this = this,\n        count = 0;\n    Rkns._.each(this.data,function(_item) {\n        var _element;\n        if (typeof _item === \"string\") {\n            if (/^(https?:\\/\\/|www)/.test(_item)) {\n                _element = { url: _item };\n            } else {\n                _element = { title: _item.replace(/[:,]?\\s?(https?:\\/\\/|www)[\\d\\w\\/.&?=#%-_]+\\s?/,'').trim() };\n                var _match = _item.match(/(https?:\\/\\/|www)[\\d\\w\\/.&?=#%-_]+/);\n                if (_match) {\n                    _element.url = _match[0];\n                }\n                if (_element.title.length > 80) {\n                    _element.description = _element.title;\n                    _element.title = _element.title.replace(/^(.{30,60})\\s.+$/,'$1…');\n                }\n            }\n        } else {\n            _element = _item;\n        }\n        var title = _element.title || (_element.url || \"\").replace(/^https?:\\/\\/(www\\.)?/,'').replace(/^(.{40}).+$/,'$1…'),\n            url = _element.url || \"\",\n            description = _element.description || \"\",\n            image = _element.image || \"\";\n        if (url && !/^https?:\\/\\//.test(url)) {\n            url = 'http://' + url;\n        }\n        if (!search.isempty && !search.test(title) && !search.test(description)) {\n            return;\n        }\n        count++;\n        _html += _this.resultTemplate({\n            url: url,\n            title: title,\n            htitle: highlight(title),\n            image: image,\n            description: description,\n            hdescription: highlight(description),\n            static_url: _this.renkan.options.static_url\n        });\n    });\n    _this.main_$.html(_html);\n    if (!search.isempty && count) {\n        this.count_$.text(count).show();\n    } else {\n        this.count_$.hide();\n    }\n    if (!search.isempty && !count) {\n        this.$.hide();\n    } else {\n        this.$.show();\n    }\n    this.renkan.resizeBins();\n};\n\nRkns.ResourceList.Bin.prototype.refresh = function() {\n    if (this.data) {\n        this.render();\n    }\n};\n","Rkns.Wikipedia = {\n};\n\nRkns.Wikipedia.Search = function(_renkan, _opts) {\n    this.renkan = _renkan;\n    this.lang = _opts.lang || \"en\";\n};\n\nRkns.Wikipedia.Search.prototype.getBgClass = function() {\n    return \"Rk-Wikipedia-Search-Icon Rk-Wikipedia-Lang-\" + this.lang;\n};\n\nRkns.Wikipedia.Search.prototype.getSearchTitle = function() {\n    var langs = {\n        \"fr\": \"French\",\n        \"en\": \"English\",\n        \"ja\": \"Japanese\"\n    };\n    if (langs[this.lang]) {\n        return this.renkan.translate(\"Wikipedia in \") + this.renkan.translate(langs[this.lang]);\n    } else {\n        return this.renkan.translate(\"Wikipedia\") + \" [\" + this.lang + \"]\";\n    }\n};\n\nRkns.Wikipedia.Search.prototype.search = function(_q) {\n    this.renkan.tabs.push(\n        new Rkns.Wikipedia.Bin(this.renkan, {\n            lang: this.lang,\n            search: _q\n        })\n    );\n};\n\nRkns.Wikipedia.Bin = Rkns.Utils.inherit(Rkns._BaseBin);\n\nRkns.Wikipedia.Bin.prototype.resultTemplate = renkanJST['templates/wikipedia-bin/resulttemplate.html'];\n\nRkns.Wikipedia.Bin.prototype._init = function(_renkan, _opts) {\n    this.renkan = _renkan;\n    this.search = _opts.search;\n    this.lang = _opts.lang || \"en\";\n    this.title_icon_$.addClass('Rk-Wikipedia-Title-Icon Rk-Wikipedia-Lang-' + this.lang);\n    this.title_$.html(this.search).addClass(\"Rk-Wikipedia-Title\");\n    this.refresh();\n};\n\nRkns.Wikipedia.Bin.prototype.render = function(searchbase) {\n    var search = searchbase || Rkns.Utils.regexpFromTextOrArray();\n    var highlightrx = (search.isempty ? Rkns.Utils.regexpFromTextOrArray(this.search) : search);\n    function highlight(_text) {\n        return highlightrx.replace(_(_text).escape(), \"<span class='searchmatch'>$1</span>\");\n    }\n    var _html = \"\",\n        _this = this,\n        count = 0;\n    Rkns._.each(this.data.query.search, function(_result) {\n        var title = _result.title,\n            url = \"http://\" + _this.lang + \".wikipedia.org/wiki/\" + encodeURI(title.replace(/ /g,\"_\")),\n            description = Rkns.$('<div>').html(_result.snippet).text();\n        if (!search.isempty && !search.test(title) && !search.test(description)) {\n            return;\n        }\n        count++;\n        _html += _this.resultTemplate({\n            url: url,\n            title: title,\n            htitle: highlight(title),\n            description: description,\n            hdescription: highlight(description),\n            static_url: _this.renkan.options.static_url\n        });\n    });\n    _this.main_$.html(_html);\n    if (!search.isempty && count) {\n        this.count_$.text(count).show();\n    } else {\n        this.count_$.hide();\n    }\n    if (!search.isempty && !count) {\n        this.$.hide();\n    } else {\n        this.$.show();\n    }\n    this.renkan.resizeBins();\n};\n\nRkns.Wikipedia.Bin.prototype.refresh = function() {\n    var _this = this;\n    Rkns.$.ajax({\n        url: \"http://\" + _this.lang + \".wikipedia.org/w/api.php?action=query&list=search&srsearch=\" + encodeURIComponent(this.search) + \"&format=json\",\n        dataType: \"jsonp\",\n        success: function(_data) {\n            _this.data = _data;\n            _this.render();\n        }\n    });\n};\n","\ndefine('renderer/baserepresentation',['jquery', 'underscore'], function ($, _) {\n    'use strict';\n\n    /* Rkns.Renderer._BaseRepresentation Class */\n\n    /* In Renkan, a \"Representation\" is a sort of ViewModel (in the MVVM paradigm) and bridges the gap between\n     * models (written with Backbone.js) and the view (written with Paper.js)\n     * Renkan's representations all inherit from Rkns.Renderer._BaseRepresentation '*/\n\n    var _BaseRepresentation = function(_renderer, _model) {\n        if (typeof _renderer !== \"undefined\") {\n            this.renderer = _renderer;\n            this.renkan = _renderer.renkan;\n            this.project = _renderer.renkan.project;\n            this.options = _renderer.renkan.options;\n            this.model = _model;\n            if (this.model) {\n                var _this = this;\n                this._changeBinding = function() {\n                    _this.redraw({change: true});\n                };\n                this._removeBinding = function() {\n                    _renderer.removeRepresentation(_this);\n                    _.defer(function() {\n                        _renderer.redraw();\n                    });\n                };\n                this._selectBinding = function() {\n                    _this.select();\n                };\n                this._unselectBinding = function() {\n                    _this.unselect();\n                };\n                this.model.on(\"change\", this._changeBinding );\n                this.model.on(\"remove\", this._removeBinding );\n                this.model.on(\"select\", this._selectBinding );\n                this.model.on(\"unselect\", this._unselectBinding );\n            }\n        }\n    };\n\n    /* Rkns.Renderer._BaseRepresentation Methods */\n\n    _(_BaseRepresentation.prototype).extend({\n        _super: function(_func) {\n            return _BaseRepresentation.prototype[_func].apply(this, Array.prototype.slice.call(arguments, 1));\n        },\n        redraw: function() {},\n        moveTo: function() {},\n        show: function() { return \"BaseRepresentation.show\"; },\n        hide: function() {},\n        select: function() {\n            if (this.model) {\n                this.model.trigger(\"selected\");\n            }\n        },\n        unselect: function() {\n            if (this.model) {\n                this.model.trigger(\"unselected\");\n            }\n        },\n        highlight: function() {},\n        unhighlight: function() {},\n        mousedown: function() {},\n        mouseup: function() {\n            if (this.model) {\n                this.model.trigger(\"clicked\");\n            }\n        },\n        destroy: function() {\n            if (this.model) {\n                this.model.off(\"change\", this._changeBinding );\n                this.model.off(\"remove\", this._removeBinding );\n                this.model.off(\"select\", this._selectBinding );\n                this.model.off(\"unselect\", this._unselectBinding );\n            }\n        }\n    }).value();\n\n    /* End of Rkns.Renderer._BaseRepresentation Class */\n\n    return _BaseRepresentation;\n\n});\n\ndefine('requtils',[], function ($, _) {\n    'use strict';\n    return {\n        getUtils: function(){\n            return window.Rkns.Utils;\n        },\n        getRenderer: function(){\n            return window.Rkns.Renderer;\n        }\n    };\n\n});\n\n\ndefine('renderer/basebutton',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation'], function ($, _, requtils, BaseRepresentation) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* Rkns.Renderer._BaseButton Class */\n\n    /* BaseButton is extended by contextual buttons that appear when hovering on nodes and edges */\n\n    var _BaseButton = Utils.inherit(BaseRepresentation);\n\n    _(_BaseButton.prototype).extend({\n        moveTo: function(_pos) {\n            this.sector.moveTo(_pos);\n        },\n        show: function() {\n            this.sector.show();\n        },\n        hide: function() {\n            if (this.sector){\n                this.sector.hide();                \n            }\n        },\n        select: function() {\n            this.sector.select();\n        },\n        unselect: function(_newTarget) {\n            this.sector.unselect();\n            if (!_newTarget || (_newTarget !== this.source_representation && _newTarget.source_representation !== this.source_representation)) {\n                this.source_representation.unselect();\n            }\n        },\n        destroy: function() {\n            this.sector.destroy();\n        }\n    }).value();\n\n    return _BaseButton;\n\n});\n\n\ndefine('renderer/shapebuilder',[], function () {\n    'use strict';\n\n    var cloud_path = \"M0,0c-0.1218516546,-0.0336420601 -0.2451649928,0.0048580836 -0.3302944641,0.0884969975c-0.0444763883,-0.0550844815 -0.1047003238,-0.0975985034 -0.1769360893,-0.1175406746c-0.1859066673,-0.0513257002 -0.3774236254,0.0626045858 -0.4272374613,0.2541588105c-0.0036603877,0.0140753132 -0.0046241235,0.028229722 -0.0065872453,0.042307536c-0.1674179627,-0.0179317735 -0.3276106855,0.0900599386 -0.3725537463,0.2628868425c-0.0445325077,0.1712456429 0.0395025693,0.3463497959 0.1905420475,0.4183458793c-0.0082101538,0.0183442886 -0.0158652506,0.0372432828 -0.0211098452,0.0574080693c-0.0498130336,0.1915540431 0.0608692569,0.3884647499 0.2467762814,0.4397904033c0.0910577256,0.0251434257 0.1830791813,0.0103792696 0.2594677475,-0.0334472349c0.042100113,0.0928009202 0.1205930075,0.1674914182 0.2240666796,0.1960572479c0.1476344161,0.0407610407 0.297446165,-0.0238077445 0.3783262342,-0.1475652419c0.0327623278,0.0238981846 0.0691792333,0.0436665447 0.1102008706,0.0549940004c0.1859065794,0.0513256592 0.3770116432,-0.0627203154 0.4268255671,-0.2542745401c0.0250490557,-0.0963230532 0.0095494076,-0.1938010889 -0.0356681889,-0.2736906101c0.0447507424,-0.0439678867 0.0797796014,-0.0996624318 0.0969425462,-0.1656617192c0.0498137481,-0.1915564561 -0.0608688118,-0.3884669813 -0.2467755669,-0.4397928163c-0.0195699622,-0.0054005426 -0.0391731675,-0.0084429542 -0.0586916488,-0.0102888295c0.0115683912,-0.1682147574 -0.0933564223,-0.3269222408 -0.2572937178,-0.3721841203z\";\n    /* ShapeBuilder Begin */\n\n    var builders = {\n        \"circle\":{\n            getShape: function() {\n                return new paper.Path.Circle([0, 0], 1);\n            },\n            getImageShape: function(center, radius) {\n                return new paper.Path.Circle(center, radius);\n            }\n        },\n        \"rectangle\":{\n            getShape: function() {\n                return new paper.Path.Rectangle([-2, -2], [2, 2]);\n            },\n            getImageShape: function(center, radius) {\n                return new paper.Path.Rectangle([-radius, -radius], [radius*2, radius*2]);\n            }\n        },\n        \"ellipse\":{\n            getShape: function() {\n                return new paper.Path.Ellipse(new paper.Rectangle([-2, -1], [2, 1]));\n            },\n            getImageShape: function(center, radius) {\n                return new paper.Path.Ellipse(new paper.Rectangle([-radius, -radius/2], [radius*2, radius]));\n            }\n        },\n        \"polygon\":{\n            getShape: function() {\n                return new paper.Path.RegularPolygon([0, 0], 6, 1);\n            },\n            getImageShape: function(center, radius) {\n                return new paper.Path.RegularPolygon(center, 6, radius);\n            }\n        },\n        \"diamond\":{\n            getShape: function() {\n                var d = new paper.Path.Rectangle([-Math.SQRT2, -Math.SQRT2], [Math.SQRT2, Math.SQRT2]);\n                d.rotate(45);\n                return d;\n            },\n            getImageShape: function(center, radius) {\n                var d = new paper.Path.Rectangle([-radius*Math.SQRT2/2, -radius*Math.SQRT2/2], [radius*Math.SQRT2, radius*Math.SQRT2]);\n                d.rotate(45);\n                return d;\n            }\n        },\n        \"star\":{\n            getShape: function() {\n                return new paper.Path.Star([0, 0], 8, 1, 0.7);\n            },\n            getImageShape: function(center, radius) {\n                return new paper.Path.Star(center, 8, radius*1, radius*0.7);\n            }\n        },\n        \"cloud\": {\n            getShape: function() {\n                var path = new paper.Path(cloud_path);\n                return path;\n\n            },\n            getImageShape: function(center, radius) {\n                var path = new paper.Path(cloud_path);\n                path.scale(radius);\n                path.translate(center);\n                return path;\n            }\n        },\n        \"triangle\": {\n            getShape: function() {\n                return new paper.Path.RegularPolygon([0,0], 3, 1);\n            },\n            getImageShape: function(center, radius) {\n                var shape = new paper.Path.RegularPolygon([0,0], 3, 1);\n                shape.scale(radius);\n                shape.translate(center);\n                return shape;\n            }\n        },\n        \"svg\": function(path){\n            return {\n                getShape: function() {\n                    return new paper.Path(path);\n                },\n                getImageShape: function(center, radius) {\n                    // No calcul for the moment\n                    return new paper.Path();\n                }\n            };\n        }\n    };\n\n    var ShapeBuilder = function (shape){\n        if(shape === null || typeof shape === \"undefined\"){\n            shape = \"circle\";\n        }\n        if(shape.substr(0,4)===\"svg:\"){\n            return builders.svg(shape.substr(4));\n        }\n        if(!(shape in builders)){\n            shape = \"circle\";\n        }\n        return builders[shape];\n    };\n\n    ShapeBuilder.builders = builders;\n\n    return ShapeBuilder;\n\n});\n\ndefine('renderer/noderepr',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation', 'renderer/shapebuilder'], function ($, _, requtils, BaseRepresentation, ShapeBuilder) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* Rkns.Renderer.Node Class */\n\n    /* The representation for the node : A circle, with an image inside and a text label underneath.\n     * The circle and the image are drawn on canvas and managed by Paper.js.\n     * The text label is an HTML node, managed by jQuery. */\n\n    //var NodeRepr = Renderer.Node = Utils.inherit(Renderer._BaseRepresentation);\n    var NodeRepr = Utils.inherit(BaseRepresentation);\n\n    _(NodeRepr.prototype).extend({\n        _init: function() {\n            this.renderer.node_layer.activate();\n            this.type = \"Node\";\n            this.buildShape();\n            this.hidden = false;\n            this.ghost= false;\n            if (this.options.show_node_circles) {\n                this.circle.strokeWidth = this.options.node_stroke_width;\n                this.h_ratio = 1;\n            } else {\n                this.h_ratio = 0;\n            }\n            this.title = $('<div class=\"Rk-Label\">').appendTo(this.renderer.labels_$);\n\n            if (this.options.editor_mode) {\n                var Renderer = requtils.getRenderer();\n                this.normal_buttons = [\n                                       new Renderer.NodeEditButton(this.renderer, null),\n                                       new Renderer.NodeRemoveButton(this.renderer, null),\n                                       new Renderer.NodeLinkButton(this.renderer, null),\n                                       new Renderer.NodeEnlargeButton(this.renderer, null),\n                                       new Renderer.NodeShrinkButton(this.renderer, null)\n                                       ];\n                if (this.options.hide_nodes){\n                    this.normal_buttons.push(\n                            new Renderer.NodeHideButton(this.renderer, null),\n                            new Renderer.NodeShowButton(this.renderer, null)\n                            );\n                }\n                this.pending_delete_buttons = [\n                                               new Renderer.NodeRevertButton(this.renderer, null)\n                                               ];\n                this.all_buttons = this.normal_buttons.concat(this.pending_delete_buttons);\n\n                for (var i = 0; i < this.all_buttons.length; i++) {\n                    this.all_buttons[i].source_representation = this;\n                }\n                this.active_buttons = [];\n            } else {\n                this.active_buttons = this.all_buttons = [];\n            }\n            this.last_circle_radius = 1;\n\n            if (this.renderer.minimap) {\n                this.renderer.minimap.node_layer.activate();\n                this.minimap_circle = new paper.Path.Circle([0, 0], 1);\n                this.minimap_circle.__representation = this.renderer.minimap.miniframe.__representation;\n                this.renderer.minimap.node_group.addChild(this.minimap_circle);\n            }\n        },\n        _getStrokeWidth: function() {\n            var thickness = (this.model.has('style') && this.model.get('style').thickness) || 1;\n            return this.options.node_stroke_width + (thickness-1) * (this.options.node_stroke_max_width - this.options.node_stroke_width) / (this.options.node_stroke_witdh_scale-1);\n        },\n        _getSelectedStrokeWidth: function() {\n            var thickness = (this.model.has('style') && this.model.get('style').thickness) || 1;\n            return this.options.selected_node_stroke_width + (thickness-1) * (this.options.selected_node_stroke_max_width - this.options.selected_node_stroke_width) / (this.options.node_stroke_witdh_scale-1);\n        },\n        buildShape: function(){\n            if( 'shape' in this.model.changed ) {\n                delete this.img;\n            }\n            if(this.circle){\n                this.circle.remove();\n                delete this.circle;\n            }\n            // \"circle\" \"rectangle\" \"ellipse\" \"polygon\" \"star\" \"diamond\"\n            this.shapeBuilder = new ShapeBuilder(this.model.get(\"shape\"));\n            this.circle = this.shapeBuilder.getShape();\n            this.circle.__representation = this;\n            this.circle.sendToBack();\n            this.last_circle_radius = 1;\n        },\n        redraw: function(options) {\n            if( 'shape' in this.model.changed && 'change' in options && options.change ) {\n            //if( 'shape' in this.model.changed ) {\n                this.buildShape();\n            }\n            var _model_coords = new paper.Point(this.model.get(\"position\")),\n                _baseRadius = this.options.node_size_base * Math.exp((this.model.get(\"size\") || 0) * Utils._NODE_SIZE_STEP);\n            if (!this.is_dragging || !this.paper_coords) {\n                this.paper_coords = this.renderer.toPaperCoords(_model_coords);\n            }\n            this.circle_radius = _baseRadius * this.renderer.view.scale;\n            if (this.last_circle_radius !== this.circle_radius) {\n                this.all_buttons.forEach(function(b) {\n                    b.setSectorSize();\n                });\n                this.circle.scale(this.circle_radius / this.last_circle_radius);\n                if (this.node_image) {\n                    this.node_image.scale(this.circle_radius / this.last_circle_radius);\n                }\n            }\n            this.circle.position = this.paper_coords;\n            if (this.node_image) {\n                this.node_image.position = this.paper_coords.subtract(this.image_delta.multiply(this.circle_radius));\n            }\n            this.last_circle_radius = this.circle_radius;\n\n            var old_act_btn = this.active_buttons;\n\n            var opacity = 1;\n            if (this.model.get(\"delete_scheduled\")) {\n                opacity = 0.5;\n                this.active_buttons = this.pending_delete_buttons;\n                this.circle.dashArray = [2,2];\n            } else {\n                opacity = 1;\n                this.active_buttons = this.normal_buttons;\n                this.circle.dashArray = null;\n            }\n            if (this.selected && this.renderer.isEditable() && !this.ghost) {\n                if (old_act_btn !== this.active_buttons) {\n                    old_act_btn.forEach(function(b) {\n                        b.hide();\n                    });\n                }\n                this.active_buttons.forEach(function(b) {\n                    b.show();\n                });\n            }\n\n            if (this.node_image) {\n                this.node_image.opacity = this.highlighted ? opacity * 0.5 : (opacity - 0.01);\n            }\n\n            this.circle.fillColor = this.highlighted ? this.options.highlighted_node_fill_color : this.options.node_fill_color;\n\n            this.circle.opacity = this.options.show_node_circles ? opacity : 0.01;\n\n            var _text = this.model.get(\"title\") || this.renkan.translate(this.options.label_untitled_nodes) || \"\";\n            _text = Utils.shortenText(_text, this.options.node_label_max_length);\n\n            if (typeof this.highlighted === \"object\") {\n                this.title.html(this.highlighted.replace(_(_text).escape(),'<span class=\"Rk-Highlighted\">$1</span>'));\n            } else {\n                this.title.text(_text);\n            }\n\n            var _strokeWidth = this._getStrokeWidth();\n            this.title.css({\n                left: this.paper_coords.x,\n                top: this.paper_coords.y + this.circle_radius * this.h_ratio + this.options.node_label_distance + 0.5*_strokeWidth,\n                opacity: opacity\n            });\n            var _color = (this.model.has(\"style\") && this.model.get(\"style\").color) || (this.model.get(\"created_by\") || Utils._USER_PLACEHOLDER(this.renkan)).get(\"color\"),\n                _dash = (this.model.has(\"style\") && this.model.get(\"style\").dash) ? this.options.default_dash_array : null;\n            this.circle.strokeWidth = _strokeWidth;\n            this.circle.strokeColor = _color;\n            this.circle.dashArray = _dash;\n            var _pc = this.paper_coords;\n            this.all_buttons.forEach(function(b) {\n                b.moveTo(_pc);\n            });\n            var lastImage = this.img;\n            this.img = this.model.get(\"image\");\n            if (this.img && this.img !== lastImage) {\n                this.showImage();\n                if(this.circle) {\n                    this.circle.sendToBack();\n                }\n            }\n            if (this.node_image && !this.img) {\n                this.node_image.remove();\n                delete this.node_image;\n            }\n\n            if (this.renderer.minimap) {\n                this.minimap_circle.fillColor = _color;\n                var minipos = this.renderer.toMinimapCoords(_model_coords),\n                miniradius = this.renderer.minimap.scale * _baseRadius,\n                minisize = new paper.Size([miniradius, miniradius]);\n                this.minimap_circle.fitBounds(minipos.subtract(minisize), minisize.multiply(2));\n            }\n\n            if (typeof options === 'undefined' || !('dontRedrawEdges' in options) || !options.dontRedrawEdges) {\n                var _this = this;\n                _.each(\n                        this.project.get(\"edges\").filter(\n                                function (ed) {\n                                    return ((ed.get(\"to\") === _this.model) || (ed.get(\"from\") === _this.model));\n                                }\n                        ),\n                        function(edge, index, list) {\n                            var repr = _this.renderer.getRepresentationByModel(edge);\n                            if (repr && typeof repr.from_representation !== \"undefined\" && typeof repr.from_representation.paper_coords !== \"undefined\" && typeof repr.to_representation !== \"undefined\" && typeof repr.to_representation.paper_coords !== \"undefined\") {\n                                repr.redraw();\n                            }\n                        }\n                );\n            }\n            if (this.ghost){\n                this.show(true);\n            } else {\n                if (this.hidden) { this.hide(); }\n            }\n        },\n        showImage: function() {\n            var _image = null;\n            if (typeof this.renderer.image_cache[this.img] === \"undefined\") {\n                _image = new Image();\n                this.renderer.image_cache[this.img] = _image;\n                _image.src = this.img;\n            } else {\n                _image = this.renderer.image_cache[this.img];\n            }\n            if (_image.width) {\n                if (this.node_image) {\n                    this.node_image.remove();\n                }\n                this.renderer.node_layer.activate();\n                var width = _image.width,\n                    height = _image.height,\n                    clipPath = this.model.get(\"clip_path\"),\n                    hasClipPath = (typeof clipPath !== \"undefined\" && clipPath),\n                    _clip = null,\n                    baseRadius = null,\n                    centerPoint = null;\n\n                if (hasClipPath) {\n                    _clip = new paper.Path();\n                    var instructions = clipPath.match(/[a-z][^a-z]+/gi) || [],\n                    lastCoords = [0,0],\n                    minX = Infinity,\n                    minY = Infinity,\n                    maxX = -Infinity,\n                    maxY = -Infinity;\n\n                    var transformCoords = function(tabc, relative) {\n                        var newCoords = tabc.slice(1).map(function(v, k) {\n                            var res = parseFloat(v),\n                            isY = k % 2;\n                            if (isY) {\n                                res = ( res - 0.5 ) * height;\n                            } else {\n                                res = ( res - 0.5 ) * width;\n                            }\n                            if (relative) {\n                                res += lastCoords[isY];\n                            }\n                            if (isY) {\n                                minY = Math.min(minY, res);\n                                maxY = Math.max(maxY, res);\n                            } else {\n                                minX = Math.min(minX, res);\n                                maxX = Math.max(maxX, res);\n                            }\n                            return res;\n                        });\n                        lastCoords = newCoords.slice(-2);\n                        return newCoords;\n                    };\n\n                    instructions.forEach(function(instr) {\n                        var coords = instr.match(/([a-z]|[0-9.-]+)/ig) || [\"\"];\n                        switch(coords[0]) {\n                        case \"M\":\n                            _clip.moveTo(transformCoords(coords));\n                            break;\n                        case \"m\":\n                            _clip.moveTo(transformCoords(coords, true));\n                            break;\n                        case \"L\":\n                            _clip.lineTo(transformCoords(coords));\n                            break;\n                        case \"l\":\n                            _clip.lineTo(transformCoords(coords, true));\n                            break;\n                        case \"C\":\n                            _clip.cubicCurveTo(transformCoords(coords));\n                            break;\n                        case \"c\":\n                            _clip.cubicCurveTo(transformCoords(coords, true));\n                            break;\n                        case \"Q\":\n                            _clip.quadraticCurveTo(transformCoords(coords));\n                            break;\n                        case \"q\":\n                            _clip.quadraticCurveTo(transformCoords(coords, true));\n                            break;\n                        }\n                    });\n\n                    baseRadius = Math[this.options.node_images_fill_mode ? \"min\" : \"max\"](maxX - minX, maxY - minY) / 2;\n                    centerPoint = new paper.Point((maxX + minX) / 2, (maxY + minY) / 2);\n                    if (!this.options.show_node_circles) {\n                        this.h_ratio = (maxY - minY) / (2 * baseRadius);\n                    }\n                } else {\n                    baseRadius = Math[this.options.node_images_fill_mode ? \"min\" : \"max\"](width, height) / 2;\n                    centerPoint = new paper.Point(0,0);\n                    if (!this.options.show_node_circles) {\n                        this.h_ratio = height / (2 * baseRadius);\n                    }\n                }\n                var _raster = new paper.Raster(_image);\n                _raster.locked = true; // Disable mouse events on icon\n                if (hasClipPath) {\n                    _raster = new paper.Group(_clip, _raster);\n                    _raster.opacity = 0.99;\n                    /* This is a workaround to allow clipping at group level\n                     * If opacity was set to 1, paper.js would merge all clipping groups in one (known bug).\n                     */\n                    _raster.clipped = true;\n                    _clip.__representation = this;\n                }\n                if (this.options.clip_node_images) {\n                    var _circleClip = this.shapeBuilder.getImageShape(centerPoint, baseRadius);\n                    _raster = new paper.Group(_circleClip, _raster);\n                    _raster.opacity = 0.99;\n                    _raster.clipped = true;\n                    _circleClip.__representation = this;\n                }\n                this.image_delta = centerPoint.divide(baseRadius);\n                this.node_image = _raster;\n                this.node_image.__representation = _this;\n                this.node_image.scale(this.circle_radius / baseRadius);\n                this.node_image.position = this.paper_coords.subtract(this.image_delta.multiply(this.circle_radius));\n                this.node_image.insertAbove(this.circle);\n            } else {\n                var _this = this;\n                $(_image).on(\"load\", function() {\n                    _this.showImage();\n                });\n            }\n        },\n        paperShift: function(_delta) {\n            if (this.options.editor_mode) {\n                if (!this.renkan.read_only) {\n                    this.is_dragging = true;\n                    this.paper_coords = this.paper_coords.add(_delta);\n                    this.redraw();\n                }\n            } else {\n                this.renderer.view.paperShift(_delta);\n            }\n        },\n        openEditor: function() {\n            this.renderer.removeRepresentationsOfType(\"editor\");\n            var _editor = this.renderer.addRepresentation(\"NodeEditor\",null);\n            _editor.source_representation = this;\n            _editor.draw();\n        },\n        select: function() {\n            this.selected = true;\n            this.circle.strokeWidth = this._getSelectedStrokeWidth();\n            if (this.renderer.isEditable() && !this.hidden) {\n                this.active_buttons.forEach(function(b) {\n                    b.show();\n                });\n            }\n            var _uri = this.model.get(\"uri\");\n            if (_uri) {\n                $('.Rk-Bin-Item').each(function() {\n                    var _el = $(this);\n                    if (_el.attr(\"data-uri\") === _uri) {\n                        _el.addClass(\"selected\");\n                    }\n                });\n            }\n            if (!this.options.editor_mode) {\n                this.openEditor();\n            }\n\n            if (this.renderer.minimap) {\n                this.minimap_circle.strokeWidth = this.options.minimap_highlight_weight;\n                this.minimap_circle.strokeColor = this.options.minimap_highlight_color;\n            }\n            //if the node is hidden and the mouse hover it, it appears as a ghost\n            if (this.hidden) {\n                this.show(true);\n            }\n            else {\n                this.showNeighbors(true);\n            }\n            this._super(\"select\");\n        },\n        hideButtons: function() {\n            this.all_buttons.forEach(function(b) {\n                b.hide();\n            });\n            delete(this.buttonTimeout);\n        },\n        unselect: function(_newTarget) {\n            if (!_newTarget || _newTarget.source_representation !== this) {\n                this.selected = false;\n                var _this = this;\n                this.buttons_timeout = setTimeout(function() { _this.hideButtons(); }, 200);\n                this.circle.strokeWidth = this._getStrokeWidth();\n                $('.Rk-Bin-Item').removeClass(\"selected\");\n                if (this.renderer.minimap) {\n                    this.minimap_circle.strokeColor = undefined;\n                }\n                //when the mouse don't hover the node anymore, we hide it\n                if (this.hidden) {\n                    this.hide();\n                }\n                else {\n                    this.hideNeighbors();\n                }\n                this._super(\"unselect\");\n            }\n        },\n        hide: function(){\n            var _this = this;\n            this.ghost = false;\n            this.hidden = true;\n            if (typeof this.node_image !== 'undefined'){\n                this.node_image.opacity = 0;\n            }\n            this.hideButtons();\n            this.circle.opacity = 0;\n            this.title.css('opacity', 0);\n            this.minimap_circle.opacity = 0;\n\n\n            _.each(\n                    this.project.get(\"edges\").filter(\n                            function (ed) {\n                                return ((ed.get(\"to\") === _this.model) || (ed.get(\"from\") === _this.model));\n                            }\n                    ),\n                    function(edge, index, list) {\n                        var repr = _this.renderer.getRepresentationByModel(edge);\n                        if (repr && typeof repr.from_representation !== \"undefined\" && typeof repr.from_representation.paper_coords !== \"undefined\" && typeof repr.to_representation !== \"undefined\" && typeof repr.to_representation.paper_coords !== \"undefined\") {\n                            repr.hide();\n                        }\n                    }\n            );\n            this.hideNeighbors();\n        },\n        show: function(ghost){\n            var _this = this;\n            this.ghost = ghost;\n            if (this.ghost){\n                if (typeof this.node_image !== 'undefined'){\n                    this.node_image.opacity = this.options.ghost_opacity;\n                }\n                this.circle.opacity = this.options.ghost_opacity;\n                this.title.css('opacity', this.options.ghost_opacity);\n                this.minimap_circle.opacity = this.options.ghost_opacity;\n            } else {\n                this.minimap_circle.opacity = 1; \n                this.hidden = false;\n                this.redraw();\n            }\n\n            _.each(\n                    this.project.get(\"edges\").filter(\n                            function (ed) {\n                                return ((ed.get(\"to\") === _this.model) || (ed.get(\"from\") === _this.model));\n                            }\n                    ),\n                    function(edge, index, list) {\n                        var repr = _this.renderer.getRepresentationByModel(edge);\n                        if (repr && typeof repr.from_representation !== \"undefined\" && typeof repr.from_representation.paper_coords !== \"undefined\" && typeof repr.to_representation !== \"undefined\" && typeof repr.to_representation.paper_coords !== \"undefined\") {\n                            repr.show(_this.ghost);\n                        }\n                    }\n            );\n        },\n        hideNeighbors: function(){\n            var _this = this;\n            _.each(\n                    this.project.get(\"edges\").filter(\n                            function (ed) {\n                                return (ed.get(\"from\") === _this.model);\n                            }\n                    ),\n                    function(edge, index, list) {\n                        var repr = _this.renderer.getRepresentationByModel(edge.get(\"to\"));\n                        if (repr && repr.ghost) {\n                            repr.hide();\n                        }\n                    }\n            );\n        },\n        showNeighbors: function(ghost){\n            var _this = this;\n            _.each(\n                    this.project.get(\"edges\").filter(\n                            function (ed) {\n                                return (ed.get(\"from\") === _this.model);\n                            }\n                    ),\n                    function(edge, index, list) {\n                        var repr = _this.renderer.getRepresentationByModel(edge.get(\"to\"));\n                        if (repr && repr.hidden) {\n                            repr.show(ghost);\n                            if (!ghost){\n                                var indexNode = _this.renderer.view.hiddenNodes.indexOf(repr.model.id);\n                                if (indexNode !== -1){\n                                    _this.renderer.view.hiddenNodes.splice(indexNode, 1);\n                                }\n                            }\n                        }\n                    }\n            );\n        },\n        highlight: function(textToReplace) {\n            var hlvalue = textToReplace || true;\n            if (this.highlighted === hlvalue) {\n                return;\n            }\n            this.highlighted = hlvalue;\n            this.redraw();\n            this.renderer.throttledPaperDraw();\n        },\n        unhighlight: function() {\n            if (!this.highlighted) {\n                return;\n            }\n            this.highlighted = false;\n            this.redraw();\n            this.renderer.throttledPaperDraw();\n        },\n        saveCoords: function() {\n            var _coords = this.renderer.toModelCoords(this.paper_coords),\n            _data = {\n                position: {\n                    x: _coords.x,\n                    y: _coords.y\n                }\n            };\n            if (this.renderer.isEditable()) {\n                this.model.set(_data);\n            }\n        },\n        mousedown: function(_event, _isTouch) {\n            if (_isTouch) {\n                this.renderer.unselectAll();\n                this.select();\n            }\n        },\n        mouseup: function(_event, _isTouch) {\n            if (this.renderer.is_dragging && this.renderer.isEditable()) {\n                this.saveCoords();\n            } else {\n                if (this.hidden) {\n                    var index = this.renderer.view.hiddenNodes.indexOf(this.model.id);\n                    if (index !== -1){\n                        this.renderer.view.hiddenNodes.splice(index, 1);\n                    }\n                    this.show(false);\n                    this.select();\n                } else {\n                    if (!_isTouch && !this.model.get(\"delete_scheduled\")) {\n                        this.openEditor();\n                    }\n                    this.model.trigger(\"clicked\");\n                }\n            }\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            this.is_dragging = false;\n        },\n        destroy: function(_event) {\n            this._super(\"destroy\");\n            this.all_buttons.forEach(function(b) {\n                b.destroy();\n            });\n            this.circle.remove();\n            this.title.remove();\n            if (this.renderer.minimap) {\n                this.minimap_circle.remove();\n            }\n            if (this.node_image) {\n                this.node_image.remove();\n            }\n        }\n    }).value();\n\n    return NodeRepr;\n\n});\n\n\ndefine('renderer/edge',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation'], function ($, _, requtils, BaseRepresentation) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* Edge Class Begin */\n\n    //var Edge = Renderer.Edge = Utils.inherit(Renderer._BaseRepresentation);\n    var Edge = Utils.inherit(BaseRepresentation);\n\n    _(Edge.prototype).extend({\n        _init: function() {\n            this.renderer.edge_layer.activate();\n            this.type = \"Edge\";\n            this.hidden = false;\n            this.ghost = false;\n            this.from_representation = this.renderer.getRepresentationByModel(this.model.get(\"from\"));\n            this.to_representation = this.renderer.getRepresentationByModel(this.model.get(\"to\"));\n            this.bundle = this.renderer.addToBundles(this);\n            this.line = new paper.Path();\n            this.line.add([0,0],[0,0],[0,0]);\n            this.line.__representation = this;\n            this.line.strokeWidth = this.options.edge_stroke_width;\n            this.arrow_scale = 1;\n            this.arrow = new paper.Path();\n            this.arrow.add(\n                    [ 0, 0 ],\n                    [ this.options.edge_arrow_length, this.options.edge_arrow_width / 2 ],\n                    [ 0, this.options.edge_arrow_width ]\n            );\n            this.arrow.pivot = new paper.Point([ this.options.edge_arrow_length / 2, this.options.edge_arrow_width / 2 ]);\n            this.arrow.__representation = this;\n            this.text = $('<div class=\"Rk-Label Rk-Edge-Label\">').appendTo(this.renderer.labels_$);\n            this.arrow_angle = 0;\n            if (this.options.editor_mode) {\n                var Renderer = requtils.getRenderer();\n                this.normal_buttons = [\n                                       new Renderer.EdgeEditButton(this.renderer, null),\n                                       new Renderer.EdgeRemoveButton(this.renderer, null)\n                                       ];\n                this.pending_delete_buttons = [\n                                               new Renderer.EdgeRevertButton(this.renderer, null)\n                                               ];\n                this.all_buttons = this.normal_buttons.concat(this.pending_delete_buttons);\n                for (var i = 0; i < this.all_buttons.length; i++) {\n                    this.all_buttons[i].source_representation = this;\n                }\n                this.active_buttons = [];\n            } else {\n                this.active_buttons = this.all_buttons = [];\n            }\n\n            if (this.renderer.minimap) {\n                this.renderer.minimap.edge_layer.activate();\n                this.minimap_line = new paper.Path();\n                this.minimap_line.add([0,0],[0,0]);\n                this.minimap_line.__representation = this.renderer.minimap.miniframe.__representation;\n                this.minimap_line.strokeWidth = 1;\n            }\n        },\n        _getStrokeWidth: function() {\n            var thickness = (this.model.has('style') && this.model.get('style').thickness) || 1;\n            return this.options.edge_stroke_width + (thickness-1) * (this.options.edge_stroke_max_width - this.options.edge_stroke_width) / (this.options.edge_stroke_witdh_scale-1);\n        },\n        _getSelectedStrokeWidth: function() {\n            var thickness = (this.model.has('style') && this.model.get('style').thickness) || 1;\n            return this.options.selected_edge_stroke_width + (thickness-1) * (this.options.selected_edge_stroke_max_width - this.options.selected_edge_stroke_width) / (this.options.edge_stroke_witdh_scale-1);\n        },\n        _getArrowScale: function() {\n            var thickness = (this.model.has('style') && this.model.get('style').thickness) || 1;\n            return 1 + (thickness-1) * ((this.options.edge_arrow_max_width / this.options.edge_arrow_width) - 1) / (this.options.edge_stroke_witdh_scale-1);\n        },\n        redraw: function() {\n            var from = this.model.get(\"from\"),\n            to = this.model.get(\"to\");\n            if (!from || !to || (this.hidden && !this.ghost)) {\n                return;\n            }\n            this.from_representation = this.renderer.getRepresentationByModel(from);\n            this.to_representation = this.renderer.getRepresentationByModel(to);\n            if (typeof this.from_representation === \"undefined\" || typeof this.to_representation === \"undefined\" ||\n                    (this.from_representation.hidden && !this.from_representation.ghost) ||\n                    (this.to_representation.hidden && !this.to_representation.ghost)) {\n                this.hide();\n                return;\n            }\n            var _strokeWidth = this._getStrokeWidth(),\n                _arrow_scale = this._getArrowScale(),\n                _p0a = this.from_representation.paper_coords,\n                _p1a = this.to_representation.paper_coords,\n                _v = _p1a.subtract(_p0a),\n                _r = _v.length,\n                _u = _v.divide(_r),\n                _ortho = new paper.Point([- _u.y, _u.x]),\n                _group_pos = this.bundle.getPosition(this),\n                _delta = _ortho.multiply( this.options.edge_gap_in_bundles * _group_pos ),\n                _p0b = _p0a.add(_delta), /* Adding a 4 px difference */\n                _p1b = _p1a.add(_delta), /* to differentiate bundled links */\n                _a = _v.angle,\n                _textdelta = _ortho.multiply(this.options.edge_label_distance + 0.5 * _arrow_scale * this.options.edge_arrow_width),\n                _handle = _v.divide(3),\n                _color = (this.model.has(\"style\") && this.model.get(\"style\").color) || (this.model.get(\"created_by\") || Utils._USER_PLACEHOLDER(this.renkan)).get(\"color\"),\n                _dash = (this.model.has(\"style\") && this.model.get(\"style\").dash) ? this.options.default_dash_array : null,\n                _opacity;\n\n            if (this.model.get(\"delete_scheduled\") || this.from_representation.model.get(\"delete_scheduled\") || this.to_representation.model.get(\"delete_scheduled\")) {\n                _opacity = 0.5;\n                this.line.dashArray = [2, 2];\n            } else {\n                _opacity = this.ghost ? this.options.ghost_opacity : 1;\n                this.line.dashArray = null;\n            }\n\n            var old_act_btn = this.active_buttons;\n\n            this.arrow.visible =\n                (this.model.has(\"style\") && this.model.get(\"style\").arrow) ||\n                !this.model.has(\"style\") ||\n                typeof this.model.get(\"style\").arrow === 'undefined';\n\n            this.active_buttons = this.model.get(\"delete_scheduled\") ? this.pending_delete_buttons : this.normal_buttons;\n\n            if (this.selected && this.renderer.isEditable() && old_act_btn !== this.active_buttons) {\n                old_act_btn.forEach(function(b) {\n                    b.hide();\n                });\n                this.active_buttons.forEach(function(b) {\n                    b.show();\n                });\n            }\n\n            this.paper_coords = _p0b.add(_p1b).divide(2);\n            this.line.strokeWidth = _strokeWidth;\n            this.line.strokeColor = _color;\n            this.line.dashArray = _dash;\n            this.line.opacity = _opacity;\n            this.line.segments[0].point = _p0a;\n            this.line.segments[1].point = this.paper_coords;\n            this.line.segments[1].handleIn = _handle.multiply(-1);\n            this.line.segments[1].handleOut = _handle;\n            this.line.segments[2].point = _p1a;\n            this.arrow.scale(_arrow_scale / this.arrow_scale);\n            this.arrow_scale = _arrow_scale;\n            this.arrow.fillColor = _color;\n            this.arrow.opacity = _opacity;\n            this.arrow.rotate(_a - this.arrow_angle, this.arrow.bounds.center);\n            this.arrow.position = this.paper_coords;\n\n            this.arrow_angle = _a;\n            if (_a > 90) {\n                _a -= 180;\n                _textdelta = _textdelta.multiply(-1);\n            }\n            if (_a < -90) {\n                _a += 180;\n                _textdelta = _textdelta.multiply(-1);\n            }\n            var _text = this.model.get(\"title\") || this.renkan.translate(this.options.label_untitled_edges) || \"\";\n            _text = Utils.shortenText(_text, this.options.node_label_max_length);\n            this.text.text(_text);\n            var _textpos = this.paper_coords.add(_textdelta);\n            this.text.css({\n                left: _textpos.x,\n                top: _textpos.y,\n                transform: \"rotate(\" + _a + \"deg)\",\n                \"-moz-transform\": \"rotate(\" + _a + \"deg)\",\n                \"-webkit-transform\": \"rotate(\" + _a + \"deg)\",\n                opacity: _opacity\n            });\n            this.text_angle = _a;\n\n            var _pc = this.paper_coords;\n            this.all_buttons.forEach(function(b) {\n                b.moveTo(_pc);\n            });\n\n            if (this.renderer.minimap) {\n                this.minimap_line.strokeColor = _color;\n                this.minimap_line.segments[0].point = this.renderer.toMinimapCoords(new paper.Point(this.from_representation.model.get(\"position\")));\n                this.minimap_line.segments[1].point = this.renderer.toMinimapCoords(new paper.Point(this.to_representation.model.get(\"position\")));\n            }\n        },\n        hide: function(){\n            this.hidden = true;\n            this.ghost = false;\n\n            this.text.hide();\n            this.line.visible = false;\n            this.arrow.visible = false;\n            this.minimap_line.visible = false;\n        },\n        show: function(ghost){\n            this.ghost = ghost;\n            if (this.ghost) {\n                this.text.css('opacity', 0.3);\n                this.line.opacity = 0.3;\n                this.arrow.opacity = 0.3;\n                this.minimap_line.opacity = 0.3;\n            } else {\n                this.hidden = false;\n\n                this.text.css('opacity', 1);\n                this.line.opacity = 1;\n                this.arrow.opacity = 1;\n                this.minimap_line.opacity = 1;\n            }\n            this.text.show();\n            this.line.visible = true;\n            this.arrow.visible = true;\n            this.minimap_line.visible = true;\n            this.redraw();\n        },\n        openEditor: function() {\n            this.renderer.removeRepresentationsOfType(\"editor\");\n            var _editor = this.renderer.addRepresentation(\"EdgeEditor\",null);\n            _editor.source_representation = this;\n            _editor.draw();\n        },\n        select: function() {\n            this.selected = true;\n            this.line.strokeWidth = this._getSelectedStrokeWidth();\n            if (this.renderer.isEditable()) {\n                this.active_buttons.forEach(function(b) {\n                    b.show();\n                });\n            }\n            if (!this.options.editor_mode) {\n                this.openEditor();\n            }\n            this._super(\"select\");\n        },\n        unselect: function(_newTarget) {\n            if (!_newTarget || _newTarget.source_representation !== this) {\n                this.selected = false;\n                if (this.options.editor_mode) {\n                    this.all_buttons.forEach(function(b) {\n                        b.hide();\n                    });\n                }\n                this.line.strokeWidth = this._getStrokeWidth();\n                this._super(\"unselect\");\n            }\n        },\n        mousedown: function(_event, _isTouch) {\n            if (_isTouch) {\n                this.renderer.unselectAll();\n                this.select();\n            }\n        },\n        mouseup: function(_event, _isTouch) {\n            if (!this.renkan.read_only && this.renderer.is_dragging) {\n                this.from_representation.saveCoords();\n                this.to_representation.saveCoords();\n                this.from_representation.is_dragging = false;\n                this.to_representation.is_dragging = false;\n            } else {\n                if (!_isTouch) {\n                    this.openEditor();\n                }\n                this.model.trigger(\"clicked\");\n            }\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n        },\n        paperShift: function(_delta) {\n            if (this.options.editor_mode) {\n                if (!this.options.read_only) {\n                    this.from_representation.paperShift(_delta);\n                    this.to_representation.paperShift(_delta);\n                }\n            } else {\n                this.renderer.paperShift(_delta);\n            }\n        },\n        destroy: function() {\n            this._super(\"destroy\");\n            this.line.remove();\n            this.arrow.remove();\n            this.text.remove();\n            if (this.renderer.minimap) {\n                this.minimap_line.remove();\n            }\n            this.all_buttons.forEach(function(b) {\n                b.destroy();\n            });\n            var _this = this;\n            this.bundle.edges = _.reject(this.bundle.edges, function(_edge) {\n                return _this === _edge;\n            });\n        }\n    }).value();\n\n    return Edge;\n\n});\n\n\n\ndefine('renderer/tempedge',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation'], function ($, _, requtils, BaseRepresentation) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* TempEdge Class Begin */\n\n    //var TempEdge = Renderer.TempEdge = Utils.inherit(Renderer._BaseRepresentation);\n    var TempEdge = Utils.inherit(BaseRepresentation);\n\n    _(TempEdge.prototype).extend({\n        _init: function() {\n            this.renderer.edge_layer.activate();\n            this.type = \"Temp-edge\";\n\n            var _color = (this.project.get(\"users\").get(this.renkan.current_user) || Utils._USER_PLACEHOLDER(this.renkan)).get(\"color\");\n            this.line = new paper.Path();\n            this.line.strokeColor = _color;\n            this.line.dashArray = [4, 2];\n            this.line.strokeWidth = this.options.selected_edge_stroke_width;\n            this.line.add([0,0],[0,0]);\n            this.line.__representation = this;\n            this.arrow = new paper.Path();\n            this.arrow.fillColor = _color;\n            this.arrow.add(\n                    [ 0, 0 ],\n                    [ this.options.edge_arrow_length, this.options.edge_arrow_width / 2 ],\n                    [ 0, this.options.edge_arrow_width ]\n            );\n            this.arrow.__representation = this;\n            this.arrow_angle = 0;\n        },\n        redraw: function() {\n            var _p0 = this.from_representation.paper_coords,\n            _p1 = this.end_pos,\n            _a = _p1.subtract(_p0).angle,\n            _c = _p0.add(_p1).divide(2);\n            this.line.segments[0].point = _p0;\n            this.line.segments[1].point = _p1;\n            this.arrow.rotate(_a - this.arrow_angle);\n            this.arrow.position = _c;\n            this.arrow_angle = _a;\n        },\n        paperShift: function(_delta) {\n            if (!this.renderer.isEditable()) {\n                this.renderer.removeRepresentation(_this);\n                paper.view.draw();\n                return;\n            }\n            this.end_pos = this.end_pos.add(_delta);\n            var _hitResult = paper.project.hitTest(this.end_pos);\n            this.renderer.findTarget(_hitResult);\n            this.redraw();\n        },\n        mouseup: function(_event, _isTouch) {\n            var _hitResult = paper.project.hitTest(_event.point),\n            _model = this.from_representation.model,\n            _endDrag = true;\n            if (_hitResult && typeof _hitResult.item.__representation !== \"undefined\") {\n                var _target = _hitResult.item.__representation;\n                if (_target.type.substr(0,4) === \"Node\") {\n                    var _destmodel = _target.model || _target.source_representation.model;\n                    if (_model !== _destmodel) {\n                        var _data = {\n                                id: Utils.getUID('edge'),\n                                created_by: this.renkan.current_user,\n                                from: _model,\n                                to: _destmodel\n                        };\n                        if (this.renderer.isEditable()) {\n                            this.project.addEdge(_data);\n                        }\n                    }\n                }\n\n                if (_model === _target.model || (_target.source_representation && _target.source_representation.model === _model)) {\n                    _endDrag = false;\n                    this.renderer.is_dragging = true;\n                }\n            }\n            if (_endDrag) {\n                this.renderer.click_target = null;\n                this.renderer.is_dragging = false;\n                this.renderer.removeRepresentation(this);\n                paper.view.draw();\n            }\n        },\n        destroy: function() {\n            this.arrow.remove();\n            this.line.remove();\n        }\n    }).value();\n\n    /* TempEdge Class End */\n\n    return TempEdge;\n\n});\n\n\ndefine('renderer/baseeditor',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation'], function ($, _, requtils, BaseRepresentation) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* _BaseEditor Begin */\n    //var _BaseEditor = Renderer._BaseEditor = Utils.inherit(Renderer._BaseRepresentation);\n    var _BaseEditor = Utils.inherit(BaseRepresentation);\n\n    _(_BaseEditor.prototype).extend({\n        _init: function() {\n            this.renderer.buttons_layer.activate();\n            this.type = \"editor\";\n            this.editor_block = new paper.Path();\n            var _pts = _.map(_.range(8), function() {return [0,0];});\n            this.editor_block.add.apply(this.editor_block, _pts);\n            this.editor_block.strokeWidth = this.options.tooltip_border_width;\n            this.editor_block.strokeColor = this.options.tooltip_border_color;\n            this.editor_block.opacity = this.options.tooltip_opacity;\n            this.editor_$ = $('<div>')\n                .appendTo(this.renderer.editor_$)\n                .css({\n                    position: \"absolute\",\n                    opacity: this.options.tooltip_opacity\n                })\n                .hide();\n        },\n        destroy: function() {\n            this.editor_block.remove();\n            this.editor_$.remove();\n        }\n    }).value();\n\n    /* _BaseEditor End */\n\n    return _BaseEditor;\n\n});\n\n\ndefine('renderer/nodeeditor',['jquery', 'underscore', 'requtils', 'renderer/baseeditor', 'renderer/shapebuilder', 'ckeditor-jquery'], function ($, _, requtils, BaseEditor, ShapeBuilder) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeEditor Begin */\n    //var NodeEditor = Renderer.NodeEditor = Utils.inherit(Renderer._BaseEditor);\n    var NodeEditor = Utils.inherit(BaseEditor);\n\n    _(NodeEditor.prototype).extend({\n        _init: function() {\n            BaseEditor.prototype._init.apply(this);\n            this.template = this.options.templates['templates/nodeeditor.html'];\n            //this.templates['default']= this.options.templates['templates/nodeeditor.html'];\n            //fusionner avec this.options.node_editor_templates\n            this.readOnlyTemplate = this.options.node_editor_templates;\n        },\n        draw: function() {\n            var _model = this.source_representation.model,\n            _created_by = _model.get(\"created_by\") || Utils._USER_PLACEHOLDER(this.renkan),\n            _template = (this.renderer.isEditable() ? this.template : this.readOnlyTemplate[_model.get(\"type\")] || this.readOnlyTemplate[\"default\"]),\n            _image_placeholder = this.options.static_url + \"img/image-placeholder.png\",\n            _size = (_model.get(\"size\") || 0);\n            this.editor_$\n            .html(_template({\n                node: {\n                    _id: _model.get(\"_id\"),\n                    has_creator: !!_model.get(\"created_by\"),\n                    title: _model.get(\"title\"),\n                    uri: _model.get(\"uri\"),\n                    type: _model.get(\"type\") || \"default\",\n                    short_uri:  Utils.shortenText((_model.get(\"uri\") || \"\").replace(/^(https?:\\/\\/)?(www\\.)?/,'').replace(/\\/$/,''),40),\n                    description: _model.get(\"description\"),\n                    image: _model.get(\"image\") || \"\",\n                    image_placeholder: _image_placeholder,\n                    color: (_model.has(\"style\") && _model.get(\"style\").color) || _created_by.get(\"color\"),\n                    thickness: (_model.has(\"style\") && _model.get(\"style\").thickness) || 1,\n                    dash: _model.has(\"style\") && _model.get(\"style\").dash ? \"checked\" : \"\",\n                    clip_path: _model.get(\"clip_path\") || false,\n                    created_by_color: _created_by.get(\"color\"),\n                    created_by_title: _created_by.get(\"title\"),\n                    size: (_size > 0 ? \"+\" : \"\") + _size,\n                    shape: _model.get(\"shape\") || \"circle\"\n                },\n                renkan: this.renkan,\n                options: this.options,\n                shortenText: Utils.shortenText,\n                shapes : _(ShapeBuilder.builders).omit('svg').keys().value(),\n                types : _(this.options.node_editor_templates).keys().value(),\n            }));\n            this.redraw();\n            var _this = this,\n                editorInstance = _this.options.show_node_editor_description_richtext ?\n                    $(\".Rk-Edit-Description\").ckeditor(_this.options.richtext_editor_config) :\n                    false,\n                closeEditor = function() {\n                    _this.renderer.removeRepresentation(_this);\n                    paper.view.draw();\n                };\n\n            _this.cleanEditor = function() {\n                _this.editor_$.off(\"keyup\");\n                _this.editor_$.find(\"input, textarea, select\").off(\"change keyup paste\");\n                _this.editor_$.find(\".Rk-Edit-Image-File\").off('change');\n                _this.editor_$.find(\".Rk-Edit-ColorPicker-Wrapper\").off('hover');\n                _this.editor_$.find(\".Rk-Edit-Size-Btn\").off('click');\n                _this.editor_$.find(\".Rk-Edit-Image-Del\").off('click');\n                _this.editor_$.find(\".Rk-Edit-ColorPicker\").find(\"li\").off('hover click');\n                _this.editor_$.find(\".Rk-CloseX\").off('click');\n                _this.editor_$.find(\".Rk-Edit-Goto\").off('click');\n\n                if(_this.options.show_node_editor_description_richtext) {\n                    if(typeof editorInstance.editor !== 'undefined') {\n                        var _editor = editorInstance.editor;\n                        delete editorInstance.editor;\n                        _editor.focusManager.blur(true);\n                        _editor.destroy();\n                    }\n                }\n            };\n\n            this.editor_$.find(\".Rk-CloseX\").click(function (e) {\n                e.preventDefault();\n                closeEditor();\n            });\n\n            this.editor_$.find(\".Rk-Edit-Goto\").click(function() {\n                if (!_model.get(\"uri\")) {\n                    return false;\n                }\n            });\n\n            if (this.renderer.isEditable()) {\n\n                var onFieldChange = _.throttle(function() {\n                  _.defer(function() {\n                    if (_this.renderer.isEditable()) {\n                        var _data = {\n                            title: _this.editor_$.find(\".Rk-Edit-Title\").val()\n                        };\n                        if (_this.options.show_node_editor_uri) {\n                            _data.uri = _this.editor_$.find(\".Rk-Edit-URI\").val();\n                            _this.editor_$.find(\".Rk-Edit-Goto\").attr(\"href\",_data.uri || \"#\");\n                        }\n                        if (_this.options.show_node_editor_image) {\n                            _data.image = _this.editor_$.find(\".Rk-Edit-Image\").val();\n                            _this.editor_$.find(\".Rk-Edit-ImgPreview\").attr(\"src\", _data.image || _image_placeholder);\n                        }\n                        if (_this.options.show_node_editor_description) {\n                            if(_this.options.show_node_editor_description_richtext) {\n                                if(typeof editorInstance.editor !== 'undefined' &&\n                                    editorInstance.editor.checkDirty()) {\n                                    _data.description = editorInstance.editor.getData();\n                                    editorInstance.editor.resetDirty();\n                                }\n                            }\n                            else {\n                                _data.description = _this.editor_$.find(\".Rk-Edit-Description\").val();\n                            }\n                        }\n                        if (_this.options.show_node_editor_style) {\n                            var dash = _this.editor_$.find(\".Rk-Edit-Dash\").is(':checked');\n                            _data.style = _.assign( ((_model.has(\"style\") && _.clone(_model.get(\"style\"))) || {}), {dash: dash});\n                        }\n                        if (_this.options.change_shapes) {\n                            if(_model.get(\"shape\")!==_this.editor_$.find(\".Rk-Edit-Shape\").val()){\n                                _data.shape = _this.editor_$.find(\".Rk-Edit-Shape\").val();\n                            }\n                        }\n                        if (_this.options.change_types) {\n                            if(_model.get(\"type\")!==_this.editor_$.find(\".Rk-Edit-Type\").val()){\n                                _data.type = _this.editor_$.find(\".Rk-Edit-Type\").val();\n                            }\n                        }\n                        _model.set(_data);\n                        _this.redraw();\n                    } else {\n                        closeEditor();\n                    }\n                  });\n                }, 1000);\n\n                this.editor_$.on(\"keyup\", function(_e) {\n                    if (_e.keyCode === 27) {\n                        closeEditor();\n                    }\n                });\n\n                this.editor_$.find(\"input, textarea, select\").on(\"change keyup paste\", onFieldChange);\n                if( _this.options.show_node_editor_description &&\n                    _this.options.show_node_editor_description_richtext &&\n                    typeof editorInstance.editor !== 'undefined')\n                {\n                    editorInstance.editor.on(\"change\", onFieldChange);\n                    editorInstance.editor.on(\"blur\", onFieldChange);\n                }\n\n                if(_this.options.allow_image_upload) {\n                    this.editor_$.find(\".Rk-Edit-Image-File\").change(function() {\n                        if (this.files.length) {\n                            var f = this.files[0],\n                            fr = new FileReader();\n                            if (f.type.substr(0,5) !== \"image\") {\n                                alert(_this.renkan.translate(\"This file is not an image\"));\n                                return;\n                            }\n                            if (f.size > (_this.options.uploaded_image_max_kb * 1024)) {\n                                alert(_this.renkan.translate(\"Image size must be under \") + _this.options.uploaded_image_max_kb + _this.renkan.translate(\"KB\"));\n                                return;\n                            }\n                            fr.onload = function(e) {\n                                _this.editor_$.find(\".Rk-Edit-Image\").val(e.target.result);\n                                onFieldChange();\n                            };\n                            fr.readAsDataURL(f);\n                        }\n                    });\n                }\n                this.editor_$.find(\".Rk-Edit-Title\")[0].focus();\n\n                var _picker = _this.editor_$.find(\".Rk-Edit-ColorPicker\");\n\n                this.editor_$.find(\".Rk-Edit-ColorPicker-Wrapper\").hover(\n                        function(_e) {\n                            _e.preventDefault();\n                            _picker.show();\n                        },\n                        function(_e) {\n                            _e.preventDefault();\n                            _picker.hide();\n                        }\n                );\n\n                _picker.find(\"li\").hover(\n                        function(_e) {\n                            _e.preventDefault();\n                            _this.editor_$.find(\".Rk-Edit-Color\").css(\"background\", $(this).attr(\"data-color\"));\n                        },\n                        function(_e) {\n                            _e.preventDefault();\n                            _this.editor_$.find(\".Rk-Edit-Color\").css(\"background\", (_model.has(\"style\") && _model.get(\"style\").color) || (_model.get(\"created_by\") || Utils._USER_PLACEHOLDER(_this.renkan)).get(\"color\"));\n                        }\n                ).click(function(_e) {\n                    _e.preventDefault();\n                    if (_this.renderer.isEditable()) {\n                        _model.set(\"style\", _.assign( ((_model.has(\"style\") && _.clone(_model.get(\"style\"))) || {}), {color: $(this).attr(\"data-color\")}));\n                        _picker.hide();\n                        paper.view.draw();\n                    } else {\n                        closeEditor();\n                    }\n                });\n\n                var shiftSize = function(n) {\n                    if (_this.renderer.isEditable()) {\n                        var _newsize = n+(_model.get(\"size\") || 0);\n                        _this.editor_$.find(\"#Rk-Edit-Size-Value\").text((_newsize > 0 ? \"+\" : \"\") + _newsize);\n                        _model.set(\"size\", _newsize);\n                        paper.view.draw();\n                    } else {\n                        closeEditor();\n                    }\n                };\n\n                this.editor_$.find(\"#Rk-Edit-Size-Down\").click(function() {\n                    shiftSize(-1);\n                    return false;\n                });\n                this.editor_$.find(\"#Rk-Edit-Size-Up\").click(function() {\n                    shiftSize(1);\n                    return false;\n                });\n\n                var shiftThickness = function(n) {\n                    if (_this.renderer.isEditable()) {\n                        var _oldThickness = ((_model.has('style') && _model.get('style').thickness) || 1),\n                            _newThickness = n + _oldThickness;\n                        if(_newThickness < 1 ) {\n                            _newThickness = 1;\n                        }\n                        else if (_newThickness > _this.options.node_stroke_witdh_scale) {\n                            _newThickness = _this.options.node_stroke_witdh_scale;\n                        }\n                        if (_newThickness !== _oldThickness) {\n                            _this.editor_$.find(\"#Rk-Edit-Thickness-Value\").text(_newThickness);\n                            _model.set(\"style\", _.assign( ((_model.has(\"style\") && _.clone(_model.get(\"style\"))) || {}), {thickness: _newThickness}));\n                            paper.view.draw();\n                        }\n                    }\n                    else {\n                        closeEditor();\n                    }\n                };\n\n                this.editor_$.find(\"#Rk-Edit-Thickness-Down\").click(function() {\n                    shiftThickness(-1);\n                    return false;\n                });\n                this.editor_$.find(\"#Rk-Edit-Thickness-Up\").click(function() {\n                    shiftThickness(1);\n                    return false;\n                });\n\n                this.editor_$.find(\".Rk-Edit-Image-Del\").click(function() {\n                    _this.editor_$.find(\".Rk-Edit-Image\").val('');\n                    onFieldChange();\n                    return false;\n                });\n            } else {\n                if (typeof this.source_representation.highlighted === \"object\") {\n                    var titlehtml = this.source_representation.highlighted.replace(_(_model.get(\"title\")).escape(),'<span class=\"Rk-Highlighted\">$1</span>');\n                    this.editor_$.find(\".Rk-Display-Title\" + (_model.get(\"uri\") ? \" a\" : \"\")).html(titlehtml);\n                    if (this.options.show_node_tooltip_description) {\n                        this.editor_$.find(\".Rk-Display-Description\").html(this.source_representation.highlighted.replace(_(_model.get(\"description\")).escape(),'<span class=\"Rk-Highlighted\">$1</span>'));\n                    }\n                }\n            }\n            this.editor_$.find(\"img\").load(function() {\n                _this.redraw();\n            });\n        },\n        redraw: function() {\n            if (this.options.popup_editor){\n                var _coords = this.source_representation.paper_coords;\n                Utils.drawEditBox(this.options, _coords, this.editor_block, this.source_representation.circle_radius * 0.75, this.editor_$);\n            }\n            this.editor_$.show();\n            paper.view.draw();\n        },\n        destroy: function() {\n            if(typeof this.cleanEditor !== 'undefined') {\n                this.cleanEditor();\n            }\n            this.editor_block.remove();\n            this.editor_$.remove();\n        }\n    }).value();\n\n    /* NodeEditor End */\n\n    return NodeEditor;\n\n});\n\n\ndefine('renderer/edgeeditor',['jquery', 'underscore', 'requtils', 'renderer/baseeditor'], function ($, _, requtils, BaseEditor) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* EdgeEditor Begin */\n\n    //var EdgeEditor = Renderer.EdgeEditor = Utils.inherit(Renderer._BaseEditor);\n    var EdgeEditor = Utils.inherit(BaseEditor);\n\n    _(EdgeEditor.prototype).extend({\n        _init: function() {\n          BaseEditor.prototype._init.apply(this);\n          this.template = this.options.templates['templates/edgeeditor.html'];\n          this.readOnlyTemplate = this.options.templates['templates/edgeeditor_readonly.html'];\n        },\n        draw: function() {\n            var _model = this.source_representation.model,\n            _from_model = _model.get(\"from\"),\n            _to_model = _model.get(\"to\"),\n            _created_by = _model.get(\"created_by\") || Utils._USER_PLACEHOLDER(this.renkan),\n            _template = (this.renderer.isEditable() ? this.template : this.readOnlyTemplate);\n            this.editor_$\n              .html(_template({\n                edge: {\n                    has_creator: !!_model.get(\"created_by\"),\n                    title: _model.get(\"title\"),\n                    uri: _model.get(\"uri\"),\n                    short_uri:  Utils.shortenText((_model.get(\"uri\") || \"\").replace(/^(https?:\\/\\/)?(www\\.)?/,'').replace(/\\/$/,''),40),\n                    description: _model.get(\"description\"),\n                    color: (_model.has(\"style\") && _model.get(\"style\").color) || _created_by.get(\"color\"),\n                    dash: _model.has(\"style\") && _model.get(\"style\").dash ? \"checked\" : \"\",\n                    arrow: (_model.has(\"style\") && _model.get(\"style\").arrow) || !_model.has(\"style\") || (typeof _model.get(\"style\").arrow === 'undefined') ? \"checked\" : \"\",\n                    thickness: (_model.has(\"style\") && _model.get(\"style\").thickness) || 1,\n                    from_title: _from_model.get(\"title\"),\n                    to_title: _to_model.get(\"title\"),\n                    from_color: (_from_model.has(\"style\") && _from_model.get(\"style\").color) || (_from_model.get(\"created_by\") || Utils._USER_PLACEHOLDER(this.renkan)).get(\"color\"),\n                    to_color: (_to_model.has(\"style\") && _to_model.get(\"style\").color) || (_to_model.get(\"created_by\") || Utils._USER_PLACEHOLDER(this.renkan)).get(\"color\"),\n                    created_by_color: _created_by.get(\"color\"),\n                    created_by_title: _created_by.get(\"title\")\n                },\n                renkan: this.renkan,\n                shortenText: Utils.shortenText,\n                options: this.options\n            }));\n            this.redraw();\n            var _this = this,\n            closeEditor = function() {\n                _this.renderer.removeRepresentation(_this);\n                _this.editor_$.find(\".Rk-Edit-Size-Btn\").off('click');\n                paper.view.draw();\n            };\n            this.editor_$.find(\".Rk-CloseX\").click(closeEditor);\n            this.editor_$.find(\".Rk-Edit-Goto\").click(function() {\n                if (!_model.get(\"uri\")) {\n                    return false;\n                }\n            });\n\n            if (this.renderer.isEditable()) {\n\n                var onFieldChange = _.throttle(function() {\n                    _.defer(function() {\n                        if (_this.renderer.isEditable()) {\n                            var _data = {\n                                title: _this.editor_$.find(\".Rk-Edit-Title\").val()\n                            };\n                            if (_this.options.show_edge_editor_uri) {\n                                _data.uri = _this.editor_$.find(\".Rk-Edit-URI\").val();\n                            }\n                            if (_this.options.show_node_editor_style) {\n                                var dash = _this.editor_$.find(\".Rk-Edit-Dash\").is(':checked'),\n                                    arrow = _this.editor_$.find(\".Rk-Edit-Arrow\").is(':checked');\n                                _data.style = _.assign( ((_model.has(\"style\") && _.clone(_model.get(\"style\"))) || {}), {dash: dash, arrow: arrow});\n                            }\n                            _this.editor_$.find(\".Rk-Edit-Goto\").attr(\"href\",_data.uri || \"#\");\n                            _model.set(_data);\n                            paper.view.draw();\n                        } else {\n                            closeEditor();\n                        }\n                    });\n                },500);\n\n                this.editor_$.on(\"keyup\", function(_e) {\n                    if (_e.keyCode === 27) {\n                        closeEditor();\n                    }\n                });\n\n                this.editor_$.find(\"input\").on(\"keyup change paste\", onFieldChange);\n\n                this.editor_$.find(\".Rk-Edit-Vocabulary\").change(function() {\n                    var e = $(this),\n                    v = e.val();\n                    if (v) {\n                        _this.editor_$.find(\".Rk-Edit-Title\").val(e.find(\":selected\").text());\n                        _this.editor_$.find(\".Rk-Edit-URI\").val(v);\n                        onFieldChange();\n                    }\n                });\n                this.editor_$.find(\".Rk-Edit-Direction\").click(function() {\n                    if (_this.renderer.isEditable()) {\n                        _model.set({\n                            from: _model.get(\"to\"),\n                            to: _model.get(\"from\")\n                        });\n                        _this.draw();\n                    } else {\n                        closeEditor();\n                    }\n                });\n\n                var _picker = _this.editor_$.find(\".Rk-Edit-ColorPicker\");\n\n                this.editor_$.find(\".Rk-Edit-ColorPicker-Wrapper\").hover(\n                        function(_e) {\n                            _e.preventDefault();\n                            _picker.show();\n                        },\n                        function(_e) {\n                            _e.preventDefault();\n                            _picker.hide();\n                        }\n                );\n\n                _picker.find(\"li\").hover(\n                        function(_e) {\n                            _e.preventDefault();\n                            _this.editor_$.find(\".Rk-Edit-Color\").css(\"background\", $(this).attr(\"data-color\"));\n                        },\n                        function(_e) {\n                            _e.preventDefault();\n                            _this.editor_$.find(\".Rk-Edit-Color\").css(\"background\", (_model.has(\"style\") && _model.get(\"style\").color)|| (_model.get(\"created_by\") || Utils._USER_PLACEHOLDER(_this.renkan)).get(\"color\"));\n                        }\n                ).click(function(_e) {\n                    _e.preventDefault();\n                    if (_this.renderer.isEditable()) {\n                        _model.set(\"style\", _.assign( ((_model.has(\"style\") && _.clone(_model.get(\"style\"))) || {}), {color: $(this).attr(\"data-color\")}));\n                        _picker.hide();\n                        paper.view.draw();\n                    } else {\n                        closeEditor();\n                    }\n                });\n                var shiftThickness = function(n) {\n                    if (_this.renderer.isEditable()) {\n                        var _oldThickness = ((_model.has('style') && _model.get('style').thickness) || 1),\n                            _newThickness = n + _oldThickness;\n                        if(_newThickness < 1 ) {\n                            _newThickness = 1;\n                        }\n                        else if (_newThickness > _this.options.node_stroke_witdh_scale) {\n                            _newThickness = _this.options.node_stroke_witdh_scale;\n                        }\n                        if (_newThickness !== _oldThickness) {\n                            _this.editor_$.find(\"#Rk-Edit-Thickness-Value\").text(_newThickness);\n                            _model.set(\"style\", _.assign( ((_model.has(\"style\") && _.clone(_model.get(\"style\"))) || {}), {thickness: _newThickness}));\n                            paper.view.draw();\n                        }\n                    }\n                    else {\n                        closeEditor();\n                    }\n                };\n\n                this.editor_$.find(\"#Rk-Edit-Thickness-Down\").click(function() {\n                    shiftThickness(-1);\n                    return false;\n                });\n                this.editor_$.find(\"#Rk-Edit-Thickness-Up\").click(function() {\n                    shiftThickness(1);\n                    return false;\n                });\n            }\n        },\n        redraw: function() {\n            if (this.options.popup_editor){\n                var _coords = this.source_representation.paper_coords;\n                Utils.drawEditBox(this.options, _coords, this.editor_block, 5, this.editor_$);\n            }\n            this.editor_$.show();\n            paper.view.draw();\n        }\n    }).value();\n\n    /* EdgeEditor End */\n\n    return EdgeEditor;\n\n});\n\n\ndefine('renderer/nodebutton',['jquery', 'underscore', 'requtils', 'renderer/basebutton'], function ($, _, requtils, BaseButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* _NodeButton Begin */\n\n    //var _NodeButton = Renderer._NodeButton = Utils.inherit(Renderer._BaseButton);\n    var _NodeButton = Utils.inherit(BaseButton);\n\n    _(_NodeButton.prototype).extend({\n        setSectorSize: function() {\n            var sectorInner = this.source_representation.circle_radius;\n            if (sectorInner !== this.lastSectorInner) {\n                if (this.sector) {\n                    this.sector.destroy();\n                }\n                this.sector = this.renderer.drawSector(\n                        this, 1 + sectorInner,\n                        Utils._NODE_BUTTON_WIDTH + sectorInner,\n                        this.startAngle,\n                        this.endAngle,\n                        1,\n                        this.imageName,\n                        this.renkan.translate(this.text)\n                );\n                this.lastSectorInner = sectorInner;\n            }\n        },\n        unselect: function() {\n            BaseButton.prototype.unselect.apply(this, Array.prototype.slice.call(arguments, 1));\n            if(this.source_representation && this.source_representation.buttons_timeout) {\n                clearTimeout(this.source_representation.buttons_timeout);\n                this.source_representation.hideButtons();\n            }\n        },\n        select: function() {\n            if(this.source_representation && this.source_representation.buttons_timeout) {\n                clearTimeout(this.source_representation.buttons_timeout);\n            }\n            this.sector.select();\n        },\n    }).value();\n\n\n    /* _NodeButton End */\n\n    return _NodeButton;\n\n});\n\n\ndefine('renderer/nodeeditbutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeEditButton Begin */\n\n    //var NodeEditButton = Renderer.NodeEditButton = Utils.inherit(Renderer._NodeButton);\n    var NodeEditButton = Utils.inherit(NodeButton);\n\n    _(NodeEditButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-edit-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = this.options.hide_nodes ? -125 : -135;\n            this.endAngle = this.options.hide_nodes ? -55 : -45;\n            this.imageName = \"edit\";\n            this.text = \"Edit\";\n        },\n        mouseup: function() {\n            if (!this.renderer.is_dragging) {\n                this.source_representation.openEditor();\n            }\n        }\n    }).value();\n\n    /* NodeEditButton End */\n\n    return NodeEditButton;\n\n});\n\n\ndefine('renderer/noderemovebutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeRemoveButton Begin */\n\n    //var NodeRemoveButton = Renderer.NodeRemoveButton = Utils.inherit(Renderer._NodeButton);\n    var NodeRemoveButton = Utils.inherit(NodeButton);\n\n    _(NodeRemoveButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-remove-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = this.options.hide_nodes ? -10 : 0;\n            this.endAngle = this.options.hide_nodes ? 45 : 90;\n            this.imageName = \"remove\";\n            this.text = \"Remove\";\n        },\n        mouseup: function() {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            this.renderer.removeRepresentationsOfType(\"editor\");\n            if (this.renderer.isEditable()) {\n                if (this.options.element_delete_delay) {\n                    var delid = Utils.getUID(\"delete\");\n                    this.renderer.delete_list.push({\n                        id: delid,\n                        time: new Date().valueOf() + this.options.element_delete_delay\n                    });\n                    this.source_representation.model.set(\"delete_scheduled\", delid);\n                } else {\n                    if (confirm(this.renkan.translate('Do you really wish to remove node ') + '\"' + this.source_representation.model.get(\"title\") + '\"?')) {\n                        this.project.removeNode(this.source_representation.model);\n                    }\n                }\n            }\n        }\n    }).value();\n\n    /* NodeRemoveButton End */\n\n    return NodeRemoveButton;\n\n});\n\n\ndefine('renderer/nodehidebutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeRemoveButton Begin */\n\n    //var NodeRemoveButton = Renderer.NodeRemoveButton = Utils.inherit(Renderer._NodeButton);\n    var NodeHideButton = Utils.inherit(NodeButton);\n\n    _(NodeHideButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-hide-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = 45;\n            this.endAngle = 90;\n            this.imageName = \"hide\";\n            this.text = \"Hide\";\n        },\n        mouseup: function() {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            this.renderer.removeRepresentationsOfType(\"editor\");\n            if (this.renderer.isEditable()) {\n                this.renderer.view.addHiddenNode(this.source_representation.model);\n            }\n        }\n    }).value();\n\n    /* NodeRemoveButton End */\n\n    return NodeHideButton;\n\n});\n\n\ndefine('renderer/nodeshowbutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeRemoveButton Begin */\n\n    //var NodeRemoveButton = Renderer.NodeRemoveButton = Utils.inherit(Renderer._NodeButton);\n    var NodeShowButton = Utils.inherit(NodeButton);\n\n    _(NodeShowButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-show-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = 90;\n            this.endAngle = 135;\n            this.imageName = \"show\";\n            this.text = \"Show\";\n        },\n        mouseup: function() {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            this.renderer.removeRepresentationsOfType(\"editor\");\n            if (this.renderer.isEditable()) {\n                this.source_representation.showNeighbors(false);\n            }\n        }\n    }).value();\n\n    /* NodeShowButton End */\n\n    return NodeShowButton;\n\n});\n\n\ndefine('renderer/noderevertbutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeRevertButton Begin */\n\n    //var NodeRevertButton = Renderer.NodeRevertButton = Utils.inherit(Renderer._NodeButton);\n    var NodeRevertButton = Utils.inherit(NodeButton);\n\n    _(NodeRevertButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-revert-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = -135;\n            this.endAngle = 135;\n            this.imageName = \"revert\";\n            this.text = \"Cancel deletion\";\n        },\n        mouseup: function() {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            if (this.renderer.isEditable()) {\n                this.source_representation.model.unset(\"delete_scheduled\");\n            }\n        }\n    }).value();\n\n    /* NodeRevertButton End */\n\n    return NodeRevertButton;\n\n});\n\n\ndefine('renderer/nodelinkbutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeLinkButton Begin */\n\n    //var NodeLinkButton = Renderer.NodeLinkButton = Utils.inherit(Renderer._NodeButton);\n    var NodeLinkButton = Utils.inherit(NodeButton);\n\n    _(NodeLinkButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-link-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = this.options.hide_nodes ? 135 : 90;\n            this.endAngle = this.options.hide_nodes ? 190 : 180;\n            this.imageName = \"link\";\n            this.text = \"Link to another node\";\n        },\n        mousedown: function(_event, _isTouch) {\n            if (this.renderer.isEditable()) {\n                var _off = this.renderer.canvas_$.offset(),\n                _point = new paper.Point([\n                                          _event.pageX - _off.left,\n                                          _event.pageY - _off.top\n                                          ]);\n                this.renderer.click_target = null;\n                this.renderer.removeRepresentationsOfType(\"editor\");\n                this.renderer.addTempEdge(this.source_representation, _point);\n            }\n        }\n    }).value();\n\n    /* NodeLinkButton End */\n\n    return NodeLinkButton;\n\n});\n\n\n\ndefine('renderer/nodeenlargebutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeEnlargeButton Begin */\n\n    //var NodeEnlargeButton = Renderer.NodeEnlargeButton = Utils.inherit(Renderer._NodeButton);\n    var NodeEnlargeButton = Utils.inherit(NodeButton);\n\n    _(NodeEnlargeButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-enlarge-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = this.options.hide_nodes ? -55 : -45;\n            this.endAngle = this.options.hide_nodes ? -10 : 0;\n            this.imageName = \"enlarge\";\n            this.text = \"Enlarge\";\n        },\n        mouseup: function() {\n            var _newsize = 1 + (this.source_representation.model.get(\"size\") || 0);\n            this.source_representation.model.set(\"size\", _newsize);\n            this.source_representation.select();\n            this.select();\n            paper.view.draw();\n        }\n    }).value();\n\n    /* NodeEnlargeButton End */\n\n    return NodeEnlargeButton;\n\n});\n\n\ndefine('renderer/nodeshrinkbutton',['jquery', 'underscore', 'requtils', 'renderer/nodebutton'], function ($, _, requtils, NodeButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* NodeShrinkButton Begin */\n\n    //var NodeShrinkButton = Renderer.NodeShrinkButton = Utils.inherit(Renderer._NodeButton);\n    var NodeShrinkButton = Utils.inherit(NodeButton);\n\n    _(NodeShrinkButton.prototype).extend({\n        _init: function() {\n            this.type = \"Node-shrink-button\";\n            this.lastSectorInner = 0;\n            this.startAngle = this.options.hide_nodes ? -170 : -180;\n            this.endAngle = this.options.hide_nodes ? -125 : -135;\n            this.imageName = \"shrink\";\n            this.text = \"Shrink\";\n        },\n        mouseup: function() {\n            var _newsize = -1 + (this.source_representation.model.get(\"size\") || 0);\n            this.source_representation.model.set(\"size\", _newsize);\n            this.source_representation.select();\n            this.select();\n            paper.view.draw();\n        }\n    }).value();\n\n    /* NodeShrinkButton End */\n\n    return NodeShrinkButton;\n\n});\n\n\ndefine('renderer/edgeeditbutton',['jquery', 'underscore', 'requtils', 'renderer/basebutton'], function ($, _, requtils, BaseButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* EdgeEditButton Begin */\n\n    //var EdgeEditButton = Renderer.EdgeEditButton = Utils.inherit(Renderer._BaseButton);\n    var EdgeEditButton = Utils.inherit(BaseButton);\n\n    _(EdgeEditButton.prototype).extend({\n        _init: function() {\n            this.type = \"Edge-edit-button\";\n            this.sector = this.renderer.drawSector(this, Utils._EDGE_BUTTON_INNER, Utils._EDGE_BUTTON_OUTER, -270, -90, 1, \"edit\", this.renkan.translate(\"Edit\"));\n        },\n        mouseup: function() {\n            if (!this.renderer.is_dragging) {\n                this.source_representation.openEditor();\n            }\n        }\n    }).value();\n\n    /* EdgeEditButton End */\n\n    return EdgeEditButton;\n\n});\n\n\ndefine('renderer/edgeremovebutton',['jquery', 'underscore', 'requtils', 'renderer/basebutton'], function ($, _, requtils, BaseButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* EdgeRemoveButton Begin */\n\n    //var EdgeRemoveButton = Renderer.EdgeRemoveButton = Utils.inherit(Renderer._BaseButton);\n    var EdgeRemoveButton = Utils.inherit(BaseButton);\n\n    _(EdgeRemoveButton.prototype).extend({\n        _init: function() {\n            this.type = \"Edge-remove-button\";\n            this.sector = this.renderer.drawSector(this, Utils._EDGE_BUTTON_INNER, Utils._EDGE_BUTTON_OUTER, -90, 90, 1, \"remove\", this.renkan.translate(\"Remove\"));\n        },\n        mouseup: function() {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            this.renderer.removeRepresentationsOfType(\"editor\");\n            if (this.renderer.isEditable()) {\n                if (this.options.element_delete_delay) {\n                    var delid = Utils.getUID(\"delete\");\n                    this.renderer.delete_list.push({\n                        id: delid,\n                        time: new Date().valueOf() + this.options.element_delete_delay\n                    });\n                    this.source_representation.model.set(\"delete_scheduled\", delid);\n                } else {\n                    if (confirm(this.renkan.translate('Do you really wish to remove edge ') + '\"' + this.source_representation.model.get(\"title\") + '\"?')) {\n                        this.project.removeEdge(this.source_representation.model);\n                    }\n                }\n            }\n        }\n    }).value();\n\n    /* EdgeRemoveButton End */\n\n    return EdgeRemoveButton;\n\n});\n\n\ndefine('renderer/edgerevertbutton',['jquery', 'underscore', 'requtils', 'renderer/basebutton'], function ($, _, requtils, BaseButton) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* EdgeRevertButton Begin */\n\n    //var EdgeRevertButton = Renderer.EdgeRevertButton = Utils.inherit(Renderer._BaseButton);\n    var EdgeRevertButton = Utils.inherit(BaseButton);\n\n    _(EdgeRevertButton.prototype).extend({\n        _init: function() {\n            this.type = \"Edge-revert-button\";\n            this.sector = this.renderer.drawSector(this, Utils._EDGE_BUTTON_INNER, Utils._EDGE_BUTTON_OUTER, -135, 135, 1, \"revert\", this.renkan.translate(\"Cancel deletion\"));\n        },\n        mouseup: function() {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n            if (this.renderer.isEditable()) {\n                this.source_representation.model.unset(\"delete_scheduled\");\n            }\n        }\n    }).value();\n\n    /* EdgeRevertButton End */\n\n    return EdgeRevertButton;\n\n});\n\n\ndefine('renderer/miniframe',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation'], function ($, _, requtils, BaseRepresentation) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* MiniFrame Begin */\n\n    //var MiniFrame = Renderer.MiniFrame = Utils.inherit(Renderer._BaseRepresentation);\n    var MiniFrame = Utils.inherit(BaseRepresentation);\n\n    _(MiniFrame.prototype).extend({\n        paperShift: function(_delta) {\n            this.renderer.offset = this.renderer.offset.subtract(_delta.divide(this.renderer.minimap.scale).multiply(this.renderer.scale));\n            this.renderer.redraw();\n        },\n        mouseup: function(_delta) {\n            this.renderer.click_target = null;\n            this.renderer.is_dragging = false;\n        }\n    }).value();\n\n\n    /* MiniFrame End */\n\n    return MiniFrame;\n\n});\n\n\ndefine('renderer/scene',['jquery', 'underscore', 'filesaver', 'requtils', 'renderer/miniframe'], function ($, _, filesaver, requtils, MiniFrame) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* Scene Begin */\n\n    var Scene = function(_renkan) {\n        this.renkan = _renkan;\n        this.$ = $(\".Rk-Render\");\n        this.representations = [];\n        this.$.html(_renkan.options.templates['templates/scene.html'](_renkan));\n        this.onStatusChange();\n        this.canvas_$ = this.$.find(\".Rk-Canvas\");\n        this.labels_$ = this.$.find(\".Rk-Labels\");\n        if (!_renkan.options.popup_editor){\n            this.editor_$ = $(\"#\" + _renkan.options.editor_panel);\n        }else{\n            this.editor_$ = this.$.find(\".Rk-Editor\");\n        }\n        this.notif_$ = this.$.find(\".Rk-Notifications\");\n        paper.setup(this.canvas_$[0]);\n        this.totalScroll = 0;\n        this.mouse_down = false;\n        this.click_target = null;\n        this.selected_target = null;\n        this.edge_layer = new paper.Layer();\n        this.node_layer = new paper.Layer();\n        this.buttons_layer = new paper.Layer();\n        this.delete_list = [];\n        this.redrawActive = true;\n\n        if (_renkan.options.show_minimap) {\n            this.minimap = {\n                    background_layer: new paper.Layer(),\n                    edge_layer: new paper.Layer(),\n                    node_layer: new paper.Layer(),\n                    node_group: new paper.Group(),\n                    size: new paper.Size( _renkan.options.minimap_width, _renkan.options.minimap_height )\n            };\n\n            this.minimap.background_layer.activate();\n            this.minimap.topleft = paper.view.bounds.bottomRight.subtract(this.minimap.size);\n            this.minimap.rectangle = new paper.Path.Rectangle(this.minimap.topleft.subtract([2,2]), this.minimap.size.add([4,4]));\n            this.minimap.rectangle.fillColor = _renkan.options.minimap_background_color;\n            this.minimap.rectangle.strokeColor = _renkan.options.minimap_border_color;\n            this.minimap.rectangle.strokeWidth = 4;\n            this.minimap.offset = new paper.Point(this.minimap.size.divide(2));\n            this.minimap.scale = 0.1;\n\n            this.minimap.node_layer.activate();\n            this.minimap.cliprectangle = new paper.Path.Rectangle(this.minimap.topleft, this.minimap.size);\n            this.minimap.node_group.addChild(this.minimap.cliprectangle);\n            this.minimap.node_group.clipped = true;\n            this.minimap.miniframe = new paper.Path.Rectangle(this.minimap.topleft, this.minimap.size);\n            this.minimap.node_group.addChild(this.minimap.miniframe);\n            this.minimap.miniframe.fillColor = '#c0c0ff';\n            this.minimap.miniframe.opacity = 0.3;\n            this.minimap.miniframe.strokeColor = '#000080';\n            this.minimap.miniframe.strokeWidth = 2;\n            this.minimap.miniframe.__representation = new MiniFrame(this, null);\n        }\n\n        this.throttledPaperDraw = _(function() {\n            paper.view.draw();\n        }).throttle(100).value();\n\n        this.bundles = [];\n        this.click_mode = false;\n\n        var _this = this,\n        _allowScroll = true,\n        _originalScale = 1,\n        _zooming = false,\n        _lastTapX = 0,\n        _lastTapY = 0;\n\n        this.image_cache = {};\n        this.icon_cache = {};\n\n        ['edit', 'remove', 'hide', 'show', 'link', 'enlarge', 'shrink', 'revert' ].forEach(function(imgname) {\n            var img = new Image();\n            img.src = _renkan.options.static_url + 'img/' + imgname + '.png';\n            _this.icon_cache[imgname] = img;\n        });\n\n        var throttledMouseMove = _.throttle(function(_event, _isTouch) {\n            _this.onMouseMove(_event, _isTouch);\n        }, Utils._MOUSEMOVE_RATE);\n\n        this.canvas_$.on({\n            mousedown: function(_event) {\n                _event.preventDefault();\n                _this.onMouseDown(_event, false);\n            },\n            mousemove: function(_event) {\n                _event.preventDefault();\n                throttledMouseMove(_event, false);\n            },\n            mouseup: function(_event) {\n                _event.preventDefault();\n                _this.onMouseUp(_event, false);\n            },\n            mousewheel: function(_event, _delta) {\n                if(_renkan.options.zoom_on_scroll) {\n                    _event.preventDefault();\n                    if (_allowScroll) {\n                        _this.onScroll(_event, _delta);\n                    }\n                }\n            },\n            touchstart: function(_event) {\n                _event.preventDefault();\n                var _touches = _event.originalEvent.touches[0];\n                if (\n                        _renkan.options.allow_double_click &&\n                        new Date() - _lastTap < Utils._DOUBLETAP_DELAY &&\n                        ( Math.pow(_lastTapX - _touches.pageX, 2) + Math.pow(_lastTapY - _touches.pageY, 2) < Utils._DOUBLETAP_DISTANCE )\n                ) {\n                    _lastTap = 0;\n                    _this.onDoubleClick(_touches);\n                } else {\n                    _lastTap = new Date();\n                    _lastTapX = _touches.pageX;\n                    _lastTapY = _touches.pageY;\n                    _originalScale = _this.view.scale;\n                    _zooming = false;\n                    _this.onMouseDown(_touches, true);\n                }\n            },\n            touchmove: function(_event) {\n                _event.preventDefault();\n                _lastTap = 0;\n                if (_event.originalEvent.touches.length === 1) {\n                    _this.onMouseMove(_event.originalEvent.touches[0], true);\n                } else {\n                    if (!_zooming) {\n                        _this.onMouseUp(_event.originalEvent.touches[0], true);\n                        _this.click_target = null;\n                        _this.is_dragging = false;\n                        _zooming = true;\n                    }\n                    if (_event.originalEvent.scale === \"undefined\") {\n                        return;\n                    }\n                    var _newScale = _event.originalEvent.scale * _originalScale,\n                    _scaleRatio = _newScale / _this.view.scale,\n                    _newOffset = new paper.Point([\n                                                  _this.canvas_$.width(),\n                                                  _this.canvas_$.height()\n                                                  ]).multiply( 0.5 * ( 1 - _scaleRatio ) ).add(_this.view.offset.multiply( _scaleRatio ));\n                    _this.view.setScale(_newScale, _newOffset);\n                }\n            },\n            touchend: function(_event) {\n                _event.preventDefault();\n                _this.onMouseUp(_event.originalEvent.changedTouches[0], true);\n            },\n            dblclick: function(_event) {\n                _event.preventDefault();\n                if (_renkan.options.allow_double_click) {\n                    _this.onDoubleClick(_event);\n                }\n            },\n            mouseleave: function(_event) {\n                _event.preventDefault();\n                //_this.onMouseUp(_event, false);\n                _this.click_target = null;\n                _this.is_dragging = false;\n            },\n            dragover: function(_event) {\n                _event.preventDefault();\n            },\n            dragenter: function(_event) {\n                _event.preventDefault();\n                _allowScroll = false;\n            },\n            dragleave: function(_event) {\n                _event.preventDefault();\n                _allowScroll = true;\n            },\n            drop: function(_event) {\n                _event.preventDefault();\n                _allowScroll = true;\n                var res = {};\n                _.each(_event.originalEvent.dataTransfer.types, function(t) {\n                    try {\n                        res[t] = _event.originalEvent.dataTransfer.getData(t);\n                    } catch(e) {}\n                });\n                var text = _event.originalEvent.dataTransfer.getData(\"Text\");\n                if (typeof text === \"string\") {\n                    switch(text[0]) {\n                    case \"{\":\n                    case \"[\":\n                        try {\n                            var data = JSON.parse(text);\n                            _.extend(res,data);\n                        }\n                        catch(e) {\n                            if (!res[\"text/plain\"]) {\n                                res[\"text/plain\"] = text;\n                            }\n                        }\n                        break;\n                    case \"<\":\n                        if (!res[\"text/html\"]) {\n                            res[\"text/html\"] = text;\n                        }\n                        break;\n                    default:\n                        if (!res[\"text/plain\"]) {\n                            res[\"text/plain\"] = text;\n                        }\n                    }\n                }\n                var url = _event.originalEvent.dataTransfer.getData(\"URL\");\n                if (url && !res[\"text/uri-list\"]) {\n                    res[\"text/uri-list\"] = url;\n                }\n                _this.dropData(res, _event.originalEvent);\n            }\n        });\n\n        var bindClick = function(selector, fname) {\n            _this.$.find(selector).click(function(evt) {\n                _this[fname](evt);\n                return false;\n            });\n        };\n\n        if(this.renkan.project.get(\"views\").length > 0 && this.renkan.options.save_view){\n            this.$.find(\".Rk-ZoomSetSaved\").show();\n        }\n        this.$.find(\".Rk-CurrentUser\").mouseenter(\n                function() { _this.$.find(\".Rk-UserList\").slideDown(); }\n        );\n        this.$.find(\".Rk-Users\").mouseleave(\n                function() { _this.$.find(\".Rk-UserList\").slideUp(); }\n        );\n        bindClick(\".Rk-FullScreen-Button\", \"fullScreen\");\n        bindClick(\".Rk-AddNode-Button\", \"addNodeBtn\");\n        bindClick(\".Rk-AddEdge-Button\", \"addEdgeBtn\");\n        bindClick(\".Rk-Save-Button\", \"save\");\n        bindClick(\".Rk-Open-Button\", \"open\");\n        bindClick(\".Rk-Export-Button\", \"exportProject\");\n        this.$.find(\".Rk-Bookmarklet-Button\")\n          /*jshint scripturl:true */\n          .attr(\"href\",\"javascript:\" + Utils._BOOKMARKLET_CODE(_renkan))\n          .click(function(){\n              _this.notif_$\n              .text(_renkan.translate(\"Drag this button to your bookmark bar. When on a third-party website, click it to enable drag-and-drop from the website to Renkan.\"))\n              .fadeIn()\n              .delay(5000)\n              .fadeOut();\n              return false;\n          });\n        this.$.find(\".Rk-TopBar-Button\").mouseover(function() {\n            $(this).find(\".Rk-TopBar-Tooltip\").show();\n        }).mouseout(function() {\n            $(this).find(\".Rk-TopBar-Tooltip\").hide();\n        });\n        bindClick(\".Rk-Fold-Bins\", \"foldBins\");\n\n        paper.view.onResize = function(_event) {\n            var _ratio,\n                newWidth = _event.width,\n                newHeight = _event.height;\n\n            if (_this.minimap) {\n                _this.minimap.topleft = paper.view.bounds.bottomRight.subtract(_this.minimap.size);\n                _this.minimap.rectangle.fitBounds(_this.minimap.topleft.subtract([2,2]), _this.minimap.size.add([4,4]));\n                _this.minimap.cliprectangle.fitBounds(_this.minimap.topleft, _this.minimap.size);\n            }\n\n            var ratioH = newHeight/(newHeight-_event.delta.height),\n                ratioW = newWidth/(newWidth-_event.delta.width);\n            if (newHeight < newWidth) {\n                    _ratio = ratioH;\n            } else {\n                _ratio = ratioW;\n            }\n\n            _this.view.resizeZoom(ratioW, ratioH, _ratio);\n\n            _this.redraw();\n\n        };\n\n        var _thRedraw = _.throttle(function() {\n            _this.redraw();\n        },50);\n           \n        this.addRepresentations(\"Node\", this.renkan.project.get(\"nodes\"));\n        this.addRepresentations(\"Edge\", this.renkan.project.get(\"edges\"));\n        this.renkan.project.on(\"change:title\", function() {\n            _this.$.find(\".Rk-PadTitle\").val(_renkan.project.get(\"title\"));\n        });\n\n        this.$.find(\".Rk-PadTitle\").on(\"keyup input paste\", function() {\n            _renkan.project.set({\"title\": $(this).val()});\n        });\n\n        var _thRedrawUsers = _.throttle(function() {\n            _this.redrawUsers();\n        }, 100);\n\n        _thRedrawUsers();\n\n        // register model events\n        this.renkan.project.on(\"change:saveStatus\", function(){\n            switch (_this.renkan.project.get(\"saveStatus\")) {\n                case 0: //clean\n                    _this.$.find(\".Rk-Save-Button\").removeClass(\"to-save\");\n                    _this.$.find(\".Rk-Save-Button\").removeClass(\"saving\");\n                    _this.$.find(\".Rk-Save-Button\").addClass(\"saved\");\n                    break;\n                case 1: //dirty\n                    _this.$.find(\".Rk-Save-Button\").removeClass(\"saved\");\n                    _this.$.find(\".Rk-Save-Button\").removeClass(\"saving\");\n                    _this.$.find(\".Rk-Save-Button\").addClass(\"to-save\");\n                    break;\n                case 2: //saving\n                    _this.$.find(\".Rk-Save-Button\").removeClass(\"saved\");\n                    _this.$.find(\".Rk-Save-Button\").removeClass(\"to-save\");\n                    _this.$.find(\".Rk-Save-Button\").addClass(\"saving\");\n                    break;\n            }\n        });\n\n        this.renkan.project.on(\"change:loadingStatus\", function(){\n            if (_this.renkan.project.get(\"loadingStatus\")){\n                var animate = _this.$.find(\".loader\").addClass(\"run\");\n                var timer = setTimeout(function(){\n                    _this.$.find(\".loader\").hide(250);\n                }, 3000);\n            }\n            else{\n                Backbone.history.start();\n                _thRedraw();\n            }\n        });\n\n        this.renkan.project.on(\"add:users remove:users\", _thRedrawUsers);\n\n        this.renkan.project.on(\"add:views remove:views\", function(_node) {\n            if(_this.renkan.project.get('views').length > 0) {\n                _this.$.find(\".Rk-ZoomSetSaved\").show();\n            }\n            else {\n                _this.$.find(\".Rk-ZoomSetSaved\").hide();\n            }\n        });\n\n        this.renkan.project.on(\"add:nodes\", function(_node) {\n            _this.addRepresentation(\"Node\", _node);\n            if (!_this.renkan.project.get(\"loadingStatus\")){\n                _thRedraw();\n            }\n        });\n        this.renkan.project.on(\"add:edges\", function(_edge) {\n            _this.addRepresentation(\"Edge\", _edge);\n            if (!_this.renkan.project.get(\"loadingStatus\")){\n                _thRedraw();\n            }\n        });\n        this.renkan.project.on(\"change:title\", function(_model, _title) {\n            var el = _this.$.find(\".Rk-PadTitle\");\n            if (el.is(\"input\")) {\n                if (el.val() !== _title) {\n                    el.val(_title);\n                }\n            } else {\n                el.text(_title);\n            }\n        });\n        \n        //register router events\n        this.renkan.router.on(\"router\", function(_params){\n            _this.parameters(_params);\n        });\n\n        if (_renkan.options.size_bug_fix) {\n            var _delay = (\n                    typeof _renkan.options.size_bug_fix === \"number\" ?\n                        _renkan.options.size_bug_fix\n                                : 500\n            );\n            window.setTimeout(\n                    function() {\n                        _this.fixSize();\n                    },\n                    _delay\n            );\n        }\n\n        if (_renkan.options.force_resize) {\n            $(window).resize(function() {\n                _this.autoScale();\n            });\n        }\n\n        if (_renkan.options.show_user_list && _renkan.options.user_color_editable) {\n            var $cpwrapper = this.$.find(\".Rk-Users .Rk-Edit-ColorPicker-Wrapper\"),\n            $cplist = this.$.find(\".Rk-Users .Rk-Edit-ColorPicker\");\n\n            $cpwrapper.hover(\n                    function(_e) {\n                        if (_this.isEditable()) {\n                            _e.preventDefault();\n                            $cplist.show();\n                        }\n                    },\n                    function(_e) {\n                        _e.preventDefault();\n                        $cplist.hide();\n                    }\n            );\n\n            $cplist.find(\"li\").mouseenter(\n                    function(_e) {\n                        if (_this.isEditable()) {\n                            _e.preventDefault();\n                            _this.$.find(\".Rk-CurrentUser-Color\").css(\"background\", $(this).attr(\"data-color\"));\n                        }\n                    }\n            );\n        }\n\n        if (_renkan.options.show_search_field) {\n\n            var lastval = '';\n\n            this.$.find(\".Rk-GraphSearch-Field\").on(\"keyup change paste input\", function() {\n                var $this = $(this),\n                val = $this.val();\n                if (val === lastval) {\n                    return;\n                }\n                lastval = val;\n                if (val.length < 2) {\n                    _renkan.project.get(\"nodes\").each(function(n) {\n                        _this.getRepresentationByModel(n).unhighlight();\n                    });\n                } else {\n                    var rxs = Utils.regexpFromTextOrArray(val);\n                    _renkan.project.get(\"nodes\").each(function(n) {\n                        if (rxs.test(n.get(\"title\")) || rxs.test(n.get(\"description\"))) {\n                            _this.getRepresentationByModel(n).highlight(rxs);\n                        } else {\n                            _this.getRepresentationByModel(n).unhighlight();\n                        }\n                    });\n                }\n            });\n        }\n\n        this.redraw();\n\n        window.setInterval(function() {\n            var _now = new Date().valueOf();\n            _this.delete_list.forEach(function(d) {\n                if (_now >= d.time) {\n                    var el = _renkan.project.get(\"nodes\").findWhere({\"delete_scheduled\":d.id});\n                    if (el) {\n                        project.removeNode(el);\n                    }\n                    el = _renkan.project.get(\"edges\").findWhere({\"delete_scheduled\":d.id});\n                    if (el) {\n                        project.removeEdge(el);\n                    }\n                }\n            });\n            _this.delete_list = _this.delete_list.filter(function(d) {\n                return _renkan.project.get(\"nodes\").findWhere({\"delete_scheduled\":d.id}) || _renkan.project.get(\"edges\").findWhere({\"delete_scheduled\":d.id});\n            });\n        }, 500);\n\n        if (this.minimap) {\n            window.setInterval(function() {\n                _this.rescaleMinimap();\n            }, 2000);\n        }\n\n    };\n\n    _(Scene.prototype).extend({\n        fixSize: function() {\n            if(typeof this.view === 'undefined') {\n                this.view = this.addRepresentation(\"View\", this.renkan.project.get(\"views\").last());\n                this.view.setScale(view.get(\"zoom_level\"), new paper.Point(view.get(\"offset\")));\n            }\n            else{\n                this.view.autoScale();\n            }\n        },\n        drawSector: function(_repr, _inR, _outR, _startAngle, _endAngle, _padding, _imgname, _caption) {\n            var _options = this.renkan.options,\n                _startRads = _startAngle * Math.PI / 180,\n                _endRads = _endAngle * Math.PI / 180,\n                _img = this.icon_cache[_imgname],\n                _startdx = - Math.sin(_startRads),\n                _startdy = Math.cos(_startRads),\n                _startXIn = Math.cos(_startRads) * _inR + _padding * _startdx,\n                _startYIn = Math.sin(_startRads) * _inR + _padding * _startdy,\n                _startXOut = Math.cos(_startRads) * _outR + _padding * _startdx,\n                _startYOut = Math.sin(_startRads) * _outR + _padding * _startdy,\n                _enddx = - Math.sin(_endRads),\n                _enddy = Math.cos(_endRads),\n                _endXIn = Math.cos(_endRads) * _inR - _padding * _enddx,\n                _endYIn = Math.sin(_endRads) * _inR - _padding * _enddy,\n                _endXOut = Math.cos(_endRads) * _outR - _padding * _enddx,\n                _endYOut = Math.sin(_endRads) * _outR - _padding * _enddy,\n                _centerR = (_inR + _outR) / 2,\n                _centerRads = (_startRads + _endRads) / 2,\n                _centerX = Math.cos(_centerRads) * _centerR,\n                _centerY = Math.sin(_centerRads) * _centerR,\n                _centerXIn = Math.cos(_centerRads) * _inR,\n                _centerXOut = Math.cos(_centerRads) * _outR,\n                _centerYIn = Math.sin(_centerRads) * _inR,\n                _centerYOut = Math.sin(_centerRads) * _outR,\n                _textX = Math.cos(_centerRads) * (_outR + 3),\n                _textY = Math.sin(_centerRads) * (_outR + _options.buttons_label_font_size) + _options.buttons_label_font_size / 2;\n            this.buttons_layer.activate();\n            var _path = new paper.Path();\n            _path.add([_startXIn, _startYIn]);\n            _path.arcTo([_centerXIn, _centerYIn], [_endXIn, _endYIn]);\n            _path.lineTo([_endXOut,  _endYOut]);\n            _path.arcTo([_centerXOut, _centerYOut], [_startXOut, _startYOut]);\n            _path.fillColor = _options.buttons_background;\n            _path.opacity = 0.5;\n            _path.closed = true;\n            _path.__representation = _repr;\n            var _text = new paper.PointText(_textX,_textY);\n            _text.characterStyle = {\n                    fontSize: _options.buttons_label_font_size,\n                    fillColor: _options.buttons_label_color\n            };\n            if (_textX > 2) {\n                _text.paragraphStyle.justification = 'left';\n            } else if (_textX < -2) {\n                _text.paragraphStyle.justification = 'right';\n            } else {\n                _text.paragraphStyle.justification = 'center';\n            }\n            _text.visible = false;\n            var _visible = false,\n                _restPos = new paper.Point(-200, -200),\n                _grp = new paper.Group([_path, _text]),\n                //_grp = new paper.Group([_path]),\n                _delta = _grp.position,\n                _imgdelta = new paper.Point([_centerX, _centerY]),\n                _currentPos = new paper.Point(0,0);\n            _text.content = _caption;\n            // set group pivot to not depend on text visibility that changes the group bounding box.\n            _grp.pivot = _grp.bounds.center;\n            _grp.visible = false;\n            _grp.position = _restPos;\n            var _res = {\n                    show: function() {\n                        _visible = true;\n                        _grp.position = _currentPos.add(_delta);\n                        _grp.visible = true;\n                    },\n                    moveTo: function(_point) {\n                        _currentPos = _point;\n                        if (_visible) {\n                            _grp.position = _point.add(_delta);\n                        }\n                    },\n                    hide: function() {\n                        _visible = false;\n                        _grp.visible = false;\n                        _grp.position = _restPos;\n                    },\n                    select: function() {\n                        _path.opacity = 0.8;\n                        _text.visible = true;\n                    },\n                    unselect: function() {\n                        _path.opacity = 0.5;\n                        _text.visible = false;\n                    },\n                    destroy: function() {\n                        _grp.remove();\n                    }\n            };\n            var showImage = function() {\n                var _raster = new paper.Raster(_img);\n                _raster.position = _imgdelta.add(_grp.position).subtract(_delta);\n                _raster.locked = true; // Disable mouse events on icon\n                _grp.addChild(_raster);\n            };\n            if (_img.width) {\n                showImage();\n            } else {\n                $(_img).on(\"load\",showImage);\n            }\n\n            return _res;\n        },\n        addToBundles: function(_edgeRepr) {\n            var _bundle = _(this.bundles).find(function(_bundle) {\n                return (\n                        ( _bundle.from === _edgeRepr.from_representation && _bundle.to === _edgeRepr.to_representation ) ||\n                        ( _bundle.from === _edgeRepr.to_representation && _bundle.to === _edgeRepr.from_representation )\n                );\n            });\n            if (typeof _bundle !== \"undefined\") {\n                _bundle.edges.push(_edgeRepr);\n            } else {\n                _bundle = {\n                        from: _edgeRepr.from_representation,\n                        to: _edgeRepr.to_representation,\n                        edges: [ _edgeRepr ],\n                        getPosition: function(_er) {\n                            var _dir = (_er.from_representation === this.from) ? 1 : -1;\n                            return _dir * ( _(this.edges).indexOf(_er) - (this.edges.length - 1) / 2 );\n                        }\n                };\n                this.bundles.push(_bundle);\n            }\n            return _bundle;\n        },\n        isEditable: function() {\n            return (this.renkan.options.editor_mode && !this.renkan.read_only);\n        },\n        onStatusChange: function() {\n            var savebtn = this.$.find(\".Rk-Save-Button\"),\n            tip = savebtn.find(\".Rk-TopBar-Tooltip-Contents\");\n            if (this.renkan.read_only) {\n                savebtn.removeClass(\"disabled Rk-Save-Online\").addClass(\"Rk-Save-ReadOnly\");\n                tip.text(this.renkan.translate(\"Connection lost\"));\n            } else {\n                if (this.renkan.options.manual_save) {\n                    savebtn.removeClass(\"Rk-Save-ReadOnly Rk-Save-Online\");\n                    tip.text(this.renkan.translate(\"Save Project\"));\n                } else {\n                    savebtn.removeClass(\"disabled Rk-Save-ReadOnly\").addClass(\"Rk-Save-Online\");\n                    tip.text(this.renkan.translate(\"Auto-save enabled\"));\n                }\n            }\n            this.redrawUsers();\n        },\n        redrawMiniframe: function() {\n            var topleft = this.toMinimapCoords(this.toModelCoords(new paper.Point([0,0]))),\n                bottomright = this.toMinimapCoords(this.toModelCoords(paper.view.bounds.bottomRight));\n            this.minimap.miniframe.fitBounds(topleft, bottomright);\n        },\n        rescaleMinimap: function() {\n            var nodes = this.renkan.project.get(\"nodes\");\n            if (nodes.length > 1) {\n                var _xx = nodes.map(function(_node) { return _node.get(\"position\").x; }),\n                    _yy = nodes.map(function(_node) { return _node.get(\"position\").y; }),\n                    _minx = Math.min.apply(Math, _xx),\n                    _miny = Math.min.apply(Math, _yy),\n                    _maxx = Math.max.apply(Math, _xx),\n                    _maxy = Math.max.apply(Math, _yy);\n                var _scale = Math.min(\n                        this.view.scale * 0.8 * this.renkan.options.minimap_width / paper.view.bounds.width,\n                        this.view.scale * 0.8 * this.renkan.options.minimap_height / paper.view.bounds.height,\n                        ( this.renkan.options.minimap_width - 2 * this.renkan.options.minimap_padding ) / (_maxx - _minx),\n                        ( this.renkan.options.minimap_height - 2 * this.renkan.options.minimap_padding ) / (_maxy - _miny)\n                );\n                this.minimap.offset = this.minimap.size.divide(2).subtract(new paper.Point([(_maxx + _minx) / 2, (_maxy + _miny) / 2]).multiply(_scale));\n                this.minimap.scale = _scale;\n            }\n            if (nodes.length === 1) {\n                this.minimap.scale = 0.1;\n                this.minimap.offset = this.minimap.size.divide(2).subtract(new paper.Point([nodes.at(0).get(\"position\").x, nodes.at(0).get(\"position\").y]).multiply(this.minimap.scale));\n            }\n            this.redraw();\n        },\n        toPaperCoords: function(_point) {\n            return _point.multiply(this.view.scale).add(this.view.offset);\n        },\n        toMinimapCoords: function(_point) {\n            return _point.multiply(this.minimap.scale).add(this.minimap.offset).add(this.minimap.topleft);\n        },\n        toModelCoords: function(_point) {\n            return _point.subtract(this.view.offset).divide(this.view.scale);\n        },\n        addRepresentation: function(_type, _model) {\n            var RendererType = requtils.getRenderer()[_type];\n            var _repr = new RendererType(this, _model);\n            this.representations.push(_repr);\n            return _repr;                \n        },\n        addRepresentations: function(_type, _collection) {\n            var _this = this;\n            _collection.forEach(function(_model) {\n                _this.addRepresentation(_type, _model);\n            });\n        },\n        userTemplate: _.template(\n                '<li class=\"Rk-User\"><span class=\"Rk-UserColor\" style=\"background:<%=background%>;\"></span><%=name%></li>'\n        ),\n        redrawUsers: function() {\n            if (!this.renkan.options.show_user_list) {\n                return;\n            }\n            var allUsers = [].concat((this.renkan.project.current_user_list || {}).models || [], (this.renkan.project.get(\"users\") || {}).models || []),\n            ulistHtml = '',\n            $userpanel = this.$.find(\".Rk-Users\"),\n            $name = $userpanel.find(\".Rk-CurrentUser-Name\"),\n            $cpitems = $userpanel.find(\".Rk-Edit-ColorPicker li\"),\n            $colorsquare = $userpanel.find(\".Rk-CurrentUser-Color\"),\n            _this = this;\n            $name.off(\"click\").text(this.renkan.translate(\"<unknown user>\"));\n            $cpitems.off(\"mouseleave click\");\n            allUsers.forEach(function(_user) {\n                if (_user.get(\"_id\") === _this.renkan.current_user) {\n                    $name.text(_user.get(\"title\"));\n                    $colorsquare.css(\"background\", _user.get(\"color\"));\n                    if (_this.isEditable()) {\n\n                        if (_this.renkan.options.user_name_editable) {\n                            $name.click(function() {\n                                var $this = $(this),\n                                $input = $('<input>').val(_user.get(\"title\")).blur(function() {\n                                    _user.set(\"title\", $(this).val());\n                                    _this.redrawUsers();\n                                    _this.redraw();\n                                });\n                                $this.empty().html($input);\n                                $input.select();\n                            });\n                        }\n\n                        if (_this.renkan.options.user_color_editable) {\n                            $cpitems.click(\n                                    function(_e) {\n                                        _e.preventDefault();\n                                        if (_this.isEditable()) {\n                                            _user.set(\"color\", $(this).attr(\"data-color\"));\n                                        }\n                                        $(this).parent().hide();\n                                    }\n                            ).mouseleave(function() {\n                                $colorsquare.css(\"background\", _user.get(\"color\"));\n                            });\n                        }\n                    }\n\n                } else {\n                    ulistHtml += _this.userTemplate({\n                        name: _user.get(\"title\"),\n                        background: _user.get(\"color\")\n                    });\n                }\n            });\n            $userpanel.find(\".Rk-UserList\").html(ulistHtml);\n        },\n        removeRepresentation: function(_representation) {\n            _representation.destroy();\n            this.representations = _.reject(this.representations,\n                function(_repr) {\n                    return _repr === _representation;\n                }\n            );\n        },\n        getRepresentationByModel: function(_model) {\n            if (!_model) {\n                return undefined;\n            }\n            return _.find(this.representations, function(_repr) {\n                return _repr.model === _model;\n            });\n        },\n        removeRepresentationsOfType: function(_type) {\n            var _representations = _.filter(this.representations,function(_repr) {\n                return _repr.type === _type;\n                }),\n                _this = this;\n            _.each(_representations, function(_repr) {\n                _this.removeRepresentation(_repr);\n            });\n        },\n        highlightModel: function(_model) {\n            var _repr = this.getRepresentationByModel(_model);\n            if (_repr) {\n                _repr.highlight();\n            }\n        },\n        unhighlightAll: function(_model) {\n            _.each(this.representations, function(_repr) {\n                _repr.unhighlight();\n            });\n        },\n        unselectAll: function(_model) {\n            _.each(this.representations, function(_repr) {\n                _repr.unselect();\n            });\n        },\n        redraw: function() {\n            var _this = this;\n            if(! this.redrawActive ) {\n                return;\n            }\n            _.each(this.representations, function(_representation) {\n                _representation.redraw({ dontRedrawEdges:true });\n            });\n            if (this.minimap && typeof this.view !== 'undefined') {\n                this.redrawMiniframe();\n            }\n            paper.view.draw();\n        },\n        addTempEdge: function(_from, _point) {\n            var _tmpEdge = this.addRepresentation(\"TempEdge\",null);\n            _tmpEdge.end_pos = _point;\n            _tmpEdge.from_representation = _from;\n            _tmpEdge.redraw();\n            this.click_target = _tmpEdge;\n        },\n        findTarget: function(_hitResult) {\n            if (_hitResult && typeof _hitResult.item.__representation !== \"undefined\") {\n                var _newTarget = _hitResult.item.__representation;\n                if (this.selected_target !== _hitResult.item.__representation) {\n                    if (this.selected_target) {\n                        this.selected_target.unselect(_newTarget);\n                    }\n                    _newTarget.select(this.selected_target);\n                    this.selected_target = _newTarget;\n                }\n            } else {\n                if (this.selected_target) {\n                    this.selected_target.unselect();\n                }\n                this.selected_target = null;\n            }\n        },\n        onMouseMove: function(_event) {\n            var _off = this.canvas_$.offset(),\n            _point = new paper.Point([\n                                      _event.pageX - _off.left,\n                                      _event.pageY - _off.top\n                                      ]),\n                                      _delta = _point.subtract(this.last_point);\n            this.last_point = _point;\n            if (!this.is_dragging && this.mouse_down && _delta.length > Utils._MIN_DRAG_DISTANCE) {\n                this.is_dragging = true;\n            }\n            var _hitResult = paper.project.hitTest(_point);\n            if (this.is_dragging) {\n                if (this.click_target && typeof this.click_target.paperShift === \"function\") {\n                    this.click_target.paperShift(_delta);\n                } else {\n                    this.view.paperShift(_delta);\n                }\n            } else {\n                this.findTarget(_hitResult);\n            }\n            paper.view.draw();\n        },\n        onMouseDown: function(_event, _isTouch) {\n            var _off = this.canvas_$.offset(),\n            _point = new paper.Point([\n                                      _event.pageX - _off.left,\n                                      _event.pageY - _off.top\n                                      ]);\n            this.last_point = _point;\n            this.mouse_down = true;\n            if (!this.click_target || this.click_target.type !== \"Temp-edge\") {\n                this.removeRepresentationsOfType(\"editor\");\n                this.is_dragging = false;\n                var _hitResult = paper.project.hitTest(_point);\n                if (_hitResult && typeof _hitResult.item.__representation !== \"undefined\") {\n                    this.click_target = _hitResult.item.__representation;\n                    this.click_target.mousedown(_event, _isTouch);\n                } else {\n                    this.click_target = null;\n                    if (this.isEditable() && this.click_mode === Utils._CLICKMODE_ADDNODE) {\n                        var _coords = this.toModelCoords(_point),\n                        _data = {\n                            id: Utils.getUID('node'),\n                            created_by: this.renkan.current_user,\n                            position: {\n                                x: _coords.x,\n                                y: _coords.y\n                            }\n                        };\n                        var _node = this.renkan.project.addNode(_data);\n                        this.getRepresentationByModel(_node).openEditor();\n                    }\n                }\n            }\n            if (this.click_mode) {\n                if (this.isEditable() && this.click_mode === Utils._CLICKMODE_STARTEDGE && this.click_target && this.click_target.type === \"Node\") {\n                    this.removeRepresentationsOfType(\"editor\");\n                    this.addTempEdge(this.click_target, _point);\n                    this.click_mode = Utils._CLICKMODE_ENDEDGE;\n                    this.notif_$.fadeOut(function() {\n                        $(this).html(this.renkan.translate(\"Click on a second node to complete the edge\")).fadeIn();\n                    });\n                } else {\n                    this.notif_$.hide();\n                    this.click_mode = false;\n                }\n            }\n            paper.view.draw();\n        },\n        onMouseUp: function(_event, _isTouch) {\n            this.mouse_down = false;\n            if (this.click_target) {\n                var _off = this.canvas_$.offset();\n                this.click_target.mouseup(\n                        {\n                            point: new paper.Point([\n                                                    _event.pageX - _off.left,\n                                                    _event.pageY - _off.top\n                                                    ])\n                        },\n                        _isTouch\n                );\n            } else {\n                this.click_target = null;\n                this.is_dragging = false;\n                if (_isTouch) {\n                    this.unselectAll();\n                }\n                this.view.updateUrl();\n            }\n            paper.view.draw();\n        },\n        onScroll: function(_event, _scrolldelta) {\n            this.totalScroll += _scrolldelta;\n            if (Math.abs(this.totalScroll) >= 1) {\n                var _off = this.canvas_$.offset(),\n                _delta = new paper.Point([\n                                          _event.pageX - _off.left,\n                                          _event.pageY - _off.top\n                                          ]).subtract(this.view.offset).multiply( Math.SQRT2 - 1 );\n                if (this.totalScroll > 0) {\n                    this.view.setScale( this.view.scale * Math.SQRT2, this.view.offset.subtract(_delta) );\n                } else {\n                    this.view.setScale( this.view.scale * Math.SQRT1_2, this.view.offset.add(_delta.divide(Math.SQRT2)));\n                }\n                this.totalScroll = 0;\n            }\n        },\n        onDoubleClick: function(_event) {\n            var _off = this.canvas_$.offset(),\n            _point = new paper.Point([\n                                      _event.pageX - _off.left,\n                                      _event.pageY - _off.top\n                                      ]);\n            var _hitResult = paper.project.hitTest(_point);\n\n            if (!this.isEditable()) {\n                if (_hitResult && typeof _hitResult.item.__representation !== \"undefined\") {\n                    if (_hitResult.item.__representation.model.get('uri')){\n                        window.open(_hitResult.item.__representation.model.get('uri'), '_blank');\n                    }\n                }\n                return;\n            }\n            if (this.isEditable() && (!_hitResult || typeof _hitResult.item.__representation === \"undefined\")) {\n                var _coords = this.toModelCoords(_point),\n                _data = {\n                    id: Utils.getUID('node'),\n                    created_by: this.renkan.current_user,\n                    position: {\n                        x: _coords.x,\n                        y: _coords.y\n                    }\n                },\n                _node = this.renkan.project.addNode(_data);\n                this.getRepresentationByModel(_node).openEditor();\n            }\n            paper.view.draw();\n        },\n        defaultDropHandler: function(_data) {\n            var newNode = {};\n            var snippet = \"\";\n            switch(_data[\"text/x-iri-specific-site\"]) {\n                case \"twitter\":\n                    snippet = $('<div>').html(_data[\"text/x-iri-selected-html\"]);\n                    var tweetdiv = snippet.find(\".tweet\");\n                    newNode.title = this.renkan.translate(\"Tweet by \") + tweetdiv.attr(\"data-name\");\n                    newNode.uri = \"http://twitter.com/\" + tweetdiv.attr(\"data-screen-name\") + \"/status/\" + tweetdiv.attr(\"data-tweet-id\");\n                    newNode.image = tweetdiv.find(\".avatar\").attr(\"src\");\n                    newNode.description = tweetdiv.find(\".js-tweet-text:first\").text();\n                    break;\n                case \"google\":\n                    snippet = $('<div>').html(_data[\"text/x-iri-selected-html\"]);\n                    newNode.title = snippet.find(\"h3:first\").text().trim();\n                    newNode.uri = snippet.find(\"h3 a\").attr(\"href\");\n                    newNode.description = snippet.find(\".st:first\").text().trim();\n                    break;\n                default:\n                    if (_data[\"text/x-iri-source-uri\"]) {\n                        newNode.uri = _data[\"text/x-iri-source-uri\"];\n                    }\n            }\n            if (_data[\"text/plain\"] || _data[\"text/x-iri-selected-text\"]) {\n                newNode.description = (_data[\"text/plain\"] || _data[\"text/x-iri-selected-text\"]).replace(/[\\s\\n]+/gm,' ').trim();\n            }\n            if (_data[\"text/html\"] || _data[\"text/x-iri-selected-html\"]) {\n                snippet = $('<div>').html(_data[\"text/html\"] || _data[\"text/x-iri-selected-html\"]);\n                var _svgimgs = snippet.find(\"image\");\n                if (_svgimgs.length) {\n                    newNode.image = _svgimgs.attr(\"xlink:href\");\n                }\n                var _svgpaths = snippet.find(\"path\");\n                if (_svgpaths.length) {\n                    newNode.clipPath = _svgpaths.attr(\"d\");\n                }\n                var _imgs = snippet.find(\"img\");\n                if (_imgs.length) {\n                    newNode.image = _imgs[0].src;\n                }\n                var _as = snippet.find(\"a\");\n                if (_as.length) {\n                    newNode.uri = _as[0].href;\n                }\n                newNode.title = snippet.find(\"[title]\").attr(\"title\") || newNode.title;\n                newNode.description = snippet.text().replace(/[\\s\\n]+/gm,' ').trim();\n            }\n            if (_data[\"text/uri-list\"]) {\n                newNode.uri = _data[\"text/uri-list\"];\n            }\n            if (_data[\"text/x-moz-url\"] && !newNode.title) {\n                newNode.title = (_data[\"text/x-moz-url\"].split(\"\\n\")[1] || \"\").trim();\n                if (newNode.title === newNode.uri) {\n                    newNode.title = false;\n                }\n            }\n            if (_data[\"text/x-iri-source-title\"] && !newNode.title) {\n                newNode.title = _data[\"text/x-iri-source-title\"];\n            }\n            if (_data[\"text/html\"] || _data[\"text/x-iri-selected-html\"]) {\n                snippet = $('<div>').html(_data[\"text/html\"] || _data[\"text/x-iri-selected-html\"]);\n                newNode.image = snippet.find(\"[data-image]\").attr(\"data-image\") || newNode.image;\n                newNode.uri = snippet.find(\"[data-uri]\").attr(\"data-uri\") || newNode.uri;\n                newNode.title = snippet.find(\"[data-title]\").attr(\"data-title\") || newNode.title;\n                newNode.description = snippet.find(\"[data-description]\").attr(\"data-description\") || newNode.description;\n                newNode.clipPath = snippet.find(\"[data-clip-path]\").attr(\"data-clip-path\") || newNode.clipPath;\n            }\n\n            if (!newNode.title) {\n                newNode.title = this.renkan.translate(\"Dragged resource\");\n            }\n            var fields = [\"title\", \"description\", \"uri\", \"image\"];\n            for (var i = 0; i < fields.length; i++) {\n                var f = fields[i];\n                if (_data[\"text/x-iri-\" + f] || _data[f]) {\n                    newNode[f] = _data[\"text/x-iri-\" + f] || _data[f];\n                }\n                if (newNode[f] === \"none\" || newNode[f] === \"null\") {\n                    newNode[f] = undefined;\n                }\n            }\n\n            if(typeof this.renkan.options.drop_enhancer === \"function\"){\n                newNode = this.renkan.options.drop_enhancer(newNode, _data);\n            }\n\n            return newNode;\n\n        },\n        dropData: function(_data, _event) {\n            if (!this.isEditable()) {\n                return;\n            }\n            if (_data[\"text/json\"] || _data[\"application/json\"]) {\n                try {\n                    var jsondata = JSON.parse(_data[\"text/json\"] || _data[\"application/json\"]);\n                    _.extend(_data,jsondata);\n                }\n                catch(e) {}\n            }\n\n            var newNode = (typeof this.renkan.options.drop_handler === \"undefined\")?this.defaultDropHandler(_data):this.renkan.options.drop_handler(_data);\n\n            var _off = this.canvas_$.offset(),\n            _point = new paper.Point([\n                                      _event.pageX - _off.left,\n                                      _event.pageY - _off.top\n                                      ]),\n                                      _coords = this.toModelCoords(_point),\n                                      _nodedata = {\n                id: Utils.getUID('node'),\n                created_by: this.renkan.current_user,\n                uri: newNode.uri || \"\",\n                title: newNode.title || \"\",\n                description: newNode.description || \"\",\n                image: newNode.image || \"\",\n                color: newNode.color || undefined,\n                clip_path: newNode.clipPath || undefined,\n                position: {\n                    x: _coords.x,\n                    y: _coords.y\n                }\n            };\n            var _node = this.renkan.project.addNode(_nodedata),\n            _repr = this.getRepresentationByModel(_node);\n            if (_event.type === \"drop\") {\n                _repr.openEditor();\n            }\n        },\n        fullScreen: function() {\n            var _isFull = document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen,\n                _el = this.renkan.$[0],\n                _requestMethods = [\"requestFullScreen\",\"mozRequestFullScreen\",\"webkitRequestFullScreen\"],\n                _cancelMethods = [\"cancelFullScreen\",\"mozCancelFullScreen\",\"webkitCancelFullScreen\"],\n                i;\n            if (_isFull) {\n                for (i = 0; i < _cancelMethods.length; i++) {\n                    if (typeof document[_cancelMethods[i]] === \"function\") {\n                        document[_cancelMethods[i]]();\n                        break;\n                    }\n                }\n                var widthAft = this.$.width();\n                var heightAft = this.$.height();\n\n                if (this.renkan.options.show_top_bar) {\n                    heightAft -= this.$.find(\".Rk-TopBar\").height();\n                }\n                if (this.renkan.options.show_bins && (this.renkan.$.find(\".Rk-Bins\").position().left > 0)) {\n                    widthAft -= this.renkan.$.find(\".Rk-Bins\").width();\n                }\n\n                paper.view.viewSize = new paper.Size([widthAft, heightAft]);\n\n            } else {\n                for (i = 0; i < _requestMethods.length; i++) {\n                    if (typeof _el[_requestMethods[i]] === \"function\") {\n                        _el[_requestMethods[i]]();\n                        break;\n                    }\n                }\n                this.redraw();\n            }\n        },\n        addNodeBtn: function() {\n            if (this.click_mode === Utils._CLICKMODE_ADDNODE) {\n                this.click_mode = false;\n                this.notif_$.hide();\n            } else {\n                this.click_mode = Utils._CLICKMODE_ADDNODE;\n                this.notif_$.text(this.renkan.translate(\"Click on the background canvas to add a node\")).fadeIn();\n            }\n            return false;\n        },\n        addEdgeBtn: function() {\n            if (this.click_mode === Utils._CLICKMODE_STARTEDGE || this.click_mode === Utils._CLICKMODE_ENDEDGE) {\n                this.click_mode = false;\n                this.notif_$.hide();\n            } else {\n                this.click_mode = Utils._CLICKMODE_STARTEDGE;\n                this.notif_$.text(this.renkan.translate(\"Click on a first node to start the edge\")).fadeIn();\n            }\n            return false;\n        },\n        exportProject: function() {\n          var projectJSON = this.renkan.project.toJSON(),\n              downloadLink = document.createElement(\"a\"),\n              projectId = projectJSON.id,\n              fileNameToSaveAs = projectId + \".json\";\n\n          // clean ids\n          delete projectJSON.id;\n          delete projectJSON._id;\n          delete projectJSON.space_id;\n\n          var objId,\n              idsMap = {},\n              hiddenNodes;\n\n          _.each(projectJSON.nodes, function(e,i,l) {\n            objId = e.id || e._id;\n            delete e._id;\n            delete e.id;\n            idsMap[objId] = e['@id'] = Utils.getUUID4();\n          });\n          _.each(projectJSON.edges, function(e,i,l) {\n            delete e._id;\n            delete e.id;\n            e.to = idsMap[e.to];\n            e.from = idsMap[e.from];\n          });\n          _.each(projectJSON.views, function(e,i,l) {\n            delete e._id;\n            delete e.id;\n\n            if(e.hidden_nodes) {\n                hiddenNodes = e.hidden_nodes;\n                e.hidden_nodes = [];\n                _.each(hiddenNodes, function(h,j) {\n                    e.hidden_nodes.push(idsMap[h]);\n                });\n            }\n          });\n          projectJSON.users = [];\n\n          var projectJSONStr = JSON.stringify(projectJSON, null, 2);\n          var blob = new Blob([projectJSONStr], {type: \"application/json;charset=utf-8\"});\n          filesaver(blob,fileNameToSaveAs);\n\n        },\n        parameters: function(_params){\n            this.removeRepresentationsOfType(\"View\");\n            if ($.isEmptyObject(_params)){\n                this.view = this.addRepresentation(\"View\", this.renkan.project.get(\"views\").at(this.validViewIndex(this.renkan.options.default_index_view)));\n                if (!this.renkan.options.default_view){\n                    this.view.autoScale();\n                }\n                return;\n            }\n            if (typeof _params.viewIndex !== 'undefined'){\n                this.view = this.addRepresentation(\"View\", this.renkan.project.get(\"views\").at(this.validViewIndex(_params.viewIndex)));\n                if (!this.renkan.options.default_view){\n                    this.view.autoScale();\n                }\n            }\n            if (typeof _params.view !== 'undefined' && _params.view.split(\",\").length >= 3){\n                var viewParams = _params.view.split(\",\");\n                var params = {\n                        \"project\": this.renkan.project,\n                        \"offset\": {\n                            \"x\": parseFloat(viewParams[0]),\n                            \"y\": parseFloat(viewParams[1])\n                        },\n                        \"zoom_level\": parseFloat(viewParams[2])\n                };\n                if (this.view){\n                    this.view.setScale(params.zoom_level, new paper.Point(params.offset));\n                } else{\n                    this.view = this.addRepresentation(\"View\", null);\n                    this.view.params = params;\n                    this.view.init();                    \n                }\n            }\n            if (!this.view){\n                this.view = this.addRepresentation(\"View\", this.renkan.project.get(\"views\").at(this.validViewIndex(this.renkan.options.default_index_view)));\n                this.view.autoScale();\n            }\n            //other parameters must go after because most of them depends on a view that must be initialize before\n            this.unhighlightAll();\n            if (typeof _params.idNode !== 'undefined'){\n                this.highlightModel(this.renkan.project.get(\"nodes\").get(_params.idNode));                 \n            }\n        },\n        validViewIndex: function(index){\n            //check if the view index exist (negative index is from the end) and return the correct index or false if doesn't exist\n            var _index = parseInt(index);\n            var validIndex = 0;\n            if (_index < 0){\n                validIndex = this.renkan.project.get(\"views\").length + _index;\n            } else {\n                validIndex = _index; \n            }\n            if (typeof this.renkan.project.get(\"views\").at(_index) === 'undefined'){\n                validIndex = 0;\n            }\n            return validIndex;\n        },\n        foldBins: function() {\n            var foldBinsButton = this.$.find(\".Rk-Fold-Bins\"),\n                bins = this.renkan.$.find(\".Rk-Bins\");\n            var _this = this,\n                sizeBef = _this.canvas_$.width(),\n                sizeAft;\n            if (bins.position().left < 0) {\n                bins.animate({left: 0},250);\n                this.$.animate({left: 300},250,function() {\n                    var w = _this.$.width();\n                    paper.view.viewSize = new paper.Size([w, _this.canvas_$.height()]);\n                });\n                if ((sizeBef -  bins.width()) < bins.height()){\n                    sizeAft = sizeBef;\n                } else {\n                    sizeAft = sizeBef - bins.width();\n                }\n                foldBinsButton.html(\"&laquo;\");\n            } else {\n                bins.animate({left: -300},250);\n                this.$.animate({left: 0},250,function() {\n                    var w = _this.$.width();\n                    paper.view.viewSize = new paper.Size([w, _this.canvas_$.height()]);\n                });\n                sizeAft = sizeBef+300;\n                foldBinsButton.html(\"&raquo;\");\n            }\n            _this.view.resizeZoom(1, 1, (sizeAft/sizeBef));\n        },\n        save: function() { },\n        open: function() { }\n    }).value();\n\n    /* Scene End */\n\n    return Scene;\n\n});\n\ndefine('renderer/viewrepr',['jquery', 'underscore', 'requtils', 'renderer/baserepresentation'], function ($, _, requtils, BaseRepresentation) {\n    'use strict';\n\n    var Utils = requtils.getUtils();\n\n    /* Rkns.Renderer.View Class */\n\n    /* The representation for the view. */\n\n    var ViewRepr = Utils.inherit(BaseRepresentation);\n\n    _(ViewRepr.prototype).extend({\n        _init: function() {\n            var _this = this;\n            this.$ = $(\".Rk-Render\");\n            this.type = \"View\";\n            this.hiddenNodes = [];\n            this.scale = 1;\n            this.initialScale = 1;\n            this.offset = paper.view.center;\n            this.params = {};\n            \n            if (this.model){\n                this.params = {\n                    \"zoom_level\": _this.model.get(\"zoom_level\"),\n                    \"offset\": _this.model.get(\"offset\"),\n                    \"hidden_nodes\": _this.model.get(\"hidden_nodes\")\n                };\n            }\n                \n            this.init();\n            \n            var bindClick = function(selector, fname) {\n                _this.$.find(selector).click(function(evt) {\n                    _this[fname](evt);\n                    return false;\n                });\n            };\n            \n            bindClick(\".Rk-ZoomOut\", \"zoomOut\");\n            bindClick(\".Rk-ZoomIn\", \"zoomIn\");\n            bindClick(\".Rk-ZoomFit\", \"autoScale\");\n            \n            this.$.find(\".Rk-ZoomSave\").click( function() {\n                var offset = {\n                    \"x\": _this.offset.x,\n                    \"y\": _this.offset.y\n                };\n                _this.model = _this.renkan.project.addView( { zoom_level:_this.scale, offset:offset, hidden_nodes: _this.hiddenNodes.concat() } );\n                _this.params = {\n                        \"zoom_level\": _this.model.get(\"zoom_level\"),\n                        \"offset\": _this.model.get(\"offset\"),\n                        \"hidden_nodes\": _this.model.get(\"hidden_nodes\")\n                };\n                _this.updateUrl();\n            });\n            \n            this.$.find(\".Rk-ZoomSetSaved\").click( function() {\n                _this.model = _this.renkan.project.get(\"views\").at(_this.renkan.project.get(\"views\").length -1);\n                _this.params = {\n                        \"zoom_level\": _this.model.get(\"zoom_level\"),\n                        \"offset\": _this.model.get(\"offset\"),\n                        \"hidden_nodes\": _this.model.get(\"hidden_nodes\")\n                };\n                _this.setScale(_this.params.zoom_level, new paper.Point(_this.params.offset));\n                _this.showNodes(false);\n                if (_this.options.hide_nodes){\n                    _this.hiddenNodes = (_this.params.hidden_nodes || []).concat();\n                    _this.hideNodes();\n                }\n                _this.updateUrl();\n            });\n            \n            this.$.find(\".Rk-ShowHiddenNodes\").mouseenter( function() {\n                _this.showNodes(true);\n                _this.$.find(\".Rk-ShowHiddenNodes\").mouseleave( function() {\n                    _this.hideNodes();\n                });\n            });\n            this.$.find(\".Rk-ShowHiddenNodes\").click( function() {\n                _this.showNodes(false);\n                _this.$.find(\".Rk-ShowHiddenNodes\").off( \"mouseleave\" ); \n            });\n            if(this.renkan.project.get(\"views\").length > 0 && this.renkan.options.save_view){\n                this.$.find(\".Rk-ZoomSetSaved\").show();\n            }\n        },\n        redraw: function(options) {\n            //console.log(\"view : \", this.model.toJSON());\n        },\n        init: function(){\n            var _this = this;\n            _this.setScale(_this.params.zoom_level, new paper.Point(_this.params.offset));\n            \n            if (_this.options.hide_nodes){\n                _this.hiddenNodes = (_this.params.hidden_nodes || []).concat();\n                _this.hideNodes();\n            }\n        },\n        addHiddenNode: function(_model){\n            this.hideNode(_model);\n            this.hiddenNodes.push(_model.id);\n            this.updateUrl();\n        },\n        hideNode: function(_model){\n            if (typeof this.renderer.getRepresentationByModel(_model) !== 'undefined'){\n                this.renderer.getRepresentationByModel(_model).hide();\n            }\n        },\n        hideNodes: function(){\n            var _this = this;\n            this.hiddenNodes.forEach(function(_id, index){\n                var node = _this.renkan.project.get(\"nodes\").get(_id);\n                if (typeof node !== 'undefined'){\n                    return _this.hideNode(_this.renkan.project.get(\"nodes\").get(_id));\n                }else{\n                    _this.hiddenNodes.splice(index, 1);\n                }\n            });\n            paper.view.draw();\n        },\n        showNodes: function(ghost){\n            var _this = this;\n            this.hiddenNodes.forEach(function(_id){\n                _this.renderer.getRepresentationByModel(_this.renkan.project.get(\"nodes\").get(_id)).show(ghost);\n            });\n            if (!ghost){\n                this.hiddenNodes = [];\n            }\n            paper.view.draw();\n        },\n        setScale: function(_newScale, _offset) {\n            if ((_newScale/this.initialScale) > Utils._MIN_SCALE && (_newScale/this.initialScale) < Utils._MAX_SCALE) {\n                this.scale = _newScale;\n                if (_offset) {\n                    this.offset = _offset;\n                }\n                this.renderer.redraw();\n                this.updateUrl();\n            }\n        },\n        zoomOut: function() {\n            var _newScale = this.scale * Math.SQRT1_2,\n            _offset = new paper.Point([\n                                       this.renderer.canvas_$.width(),\n                                       this.renderer.canvas_$.height()\n                                       ]).multiply( 0.5 * ( 1 - Math.SQRT1_2 ) ).add(this.offset.multiply( Math.SQRT1_2 ));\n            this.setScale( _newScale, _offset );\n        },\n        zoomIn: function() {\n            var _newScale = this.scale * Math.SQRT2,\n            _offset = new paper.Point([\n                                       this.renderer.canvas_$.width(),\n                                       this.renderer.canvas_$.height()\n                                       ]).multiply( 0.5 * ( 1 - Math.SQRT2 ) ).add(this.offset.multiply( Math.SQRT2 ));\n            this.setScale( _newScale, _offset );\n        },\n        resizeZoom: function(_scaleWidth, _scaleHeight, _ratio) {\n            var _newScale = this.scale * _ratio,\n                _offset = new paper.Point([\n                                       (this.offset.x * _scaleWidth),\n                                       (this.offset.y * _scaleHeight)\n                                       ]);\n            this.setScale( _newScale, _offset );\n        },\n        autoScale: function(force_view) {\n            var nodes = this.renkan.project.get(\"nodes\");\n            if (nodes.length > 1) {\n                var _xx = nodes.map(function(_node) { return _node.get(\"position\").x; }),\n                _yy = nodes.map(function(_node) { return _node.get(\"position\").y; }),\n                _minx = Math.min.apply(Math, _xx),\n                _miny = Math.min.apply(Math, _yy),\n                _maxx = Math.max.apply(Math, _xx),\n                _maxy = Math.max.apply(Math, _yy);\n                var _scale = Math.min( (paper.view.size.width - 2 * this.renkan.options.autoscale_padding) / (_maxx - _minx), (paper.view.size.height - 2 * this.renkan.options.autoscale_padding) / (_maxy - _miny));\n                this.initialScale = _scale;\n                // Override calculated scale if asked\n                if((typeof force_view !== \"undefined\") && parseFloat(force_view.zoom_level)>0 && parseFloat(force_view.offset.x)>0 && parseFloat(force_view.offset.y)>0){\n                    this.setScale(parseFloat(force_view.zoom_level), new paper.Point(parseFloat(force_view.offset.x), parseFloat(force_view.offset.y)));\n                }\n                else{\n                    this.setScale(_scale, paper.view.center.subtract(new paper.Point([(_maxx + _minx) / 2, (_maxy + _miny) / 2]).multiply(_scale)));\n                }\n            }\n            if (nodes.length === 1) {\n                this.setScale(1, paper.view.center.subtract(new paper.Point([nodes.at(0).get(\"position\").x, nodes.at(0).get(\"position\").y])));\n            }\n        },\n        paperShift: function(_delta) {\n            this.offset = this.offset.add(_delta);\n            this.renderer.redraw();\n        },\n        updateUrl: function(){\n            if(this.options.update_url){\n                var result = {};\n                var parameters = Backbone.history.getFragment().split('?');\n                if (parameters.length > 1){\n                    parameters[1].split(\"&\").forEach(function(part) {\n                        var item = part.split(\"=\");\n                        result[item[0]] = decodeURIComponent(item[1]);\n                    });\n                }\n                result.view = Math.round(this.offset.x*1000)/1000 + ',' + Math.round(this.offset.y*1000)/1000 + ',' + Math.round(this.scale*1000)/1000;\n\n                if (this.renkan.project.get(\"views\").indexOf(this.model) > -1){\n                    result.viewIndex = this.renkan.project.get(\"views\").indexOf(this.model);\n                    if (result.viewIndex === this.renkan.project.get(\"views\").length - 1){\n                        result.viewIndex = -1;\n                    }\n                } else {\n                    if (result.viewIndex){\n                        delete result.viewIndex;\n                    }\n                }\n                this.renkan.router.navigate(\"?\" + decodeURIComponent($.param(result)), {trigger: false, replace: true});\n            }\n        },\n        destroy: function(_event) {\n            this._super(\"destroy\");\n            this.showNodes(false);\n        }\n    }).value();\n\n    return ViewRepr;\n\n});\n\n\n//Load modules and use them\nif( typeof require.config === \"function\" ) {\n    require.config({\n        paths: {\n            'jquery':'../lib/jquery/jquery',\n            'underscore':'../lib/lodash/lodash',\n            'filesaver' :'../lib/FileSaver/FileSaver',\n            'requtils':'require-utils',\n            'ckeditor-core':'../lib/ckeditor/ckeditor',\n            'ckeditor-jquery':'../lib/ckeditor/adapters/jquery'\n        },\n        shim: {\n            'ckeditor-jquery':{\n                deps:['jquery','ckeditor-core']\n            }\n        },\n    });\n}\n\nrequire(['renderer/baserepresentation',\n         'renderer/basebutton',\n         'renderer/noderepr',\n         'renderer/edge',\n         'renderer/tempedge',\n         'renderer/baseeditor',\n         'renderer/nodeeditor',\n         'renderer/edgeeditor',\n         'renderer/nodebutton',\n         'renderer/nodeeditbutton',\n         'renderer/noderemovebutton',\n         'renderer/nodehidebutton',\n         'renderer/nodeshowbutton',\n         'renderer/noderevertbutton',\n         'renderer/nodelinkbutton',\n         'renderer/nodeenlargebutton',\n         'renderer/nodeshrinkbutton',\n         'renderer/edgeeditbutton',\n         'renderer/edgeremovebutton',\n         'renderer/edgerevertbutton',\n         'renderer/miniframe',\n         'renderer/scene',\n         'renderer/viewrepr'\n         ], function(BaseRepresentation, BaseButton, NodeRepr, Edge, TempEdge, BaseEditor, NodeEditor, EdgeEditor, NodeButton, NodeEditButton, NodeRemoveButton, NodeHideButton, NodeShowButton, NodeRevertButton, NodeLinkButton, NodeEnlargeButton, NodeShrinkButton, EdgeEditButton, EdgeRemoveButton, EdgeRevertButton, MiniFrame, Scene, ViewRepr){\n\n    'use strict';\n\n    var Rkns = window.Rkns;\n\n    if(typeof Rkns.Renderer === \"undefined\"){\n        Rkns.Renderer = {};\n    }\n    var Renderer = Rkns.Renderer;\n\n    Renderer._BaseRepresentation = BaseRepresentation;\n    Renderer._BaseButton = BaseButton;\n    Renderer.Node = NodeRepr;\n    Renderer.Edge = Edge;\n    Renderer.View = ViewRepr;\n    Renderer.TempEdge = TempEdge;\n    Renderer._BaseEditor = BaseEditor;\n    Renderer.NodeEditor = NodeEditor;\n    Renderer.EdgeEditor = EdgeEditor;\n    Renderer._NodeButton = NodeButton;\n    Renderer.NodeEditButton = NodeEditButton;\n    Renderer.NodeRemoveButton = NodeRemoveButton;\n    Renderer.NodeHideButton = NodeHideButton;\n    Renderer.NodeShowButton = NodeShowButton;\n    Renderer.NodeRevertButton = NodeRevertButton;\n    Renderer.NodeLinkButton = NodeLinkButton;\n    Renderer.NodeEnlargeButton = NodeEnlargeButton;\n    Renderer.NodeShrinkButton = NodeShrinkButton;\n    Renderer.EdgeEditButton = EdgeEditButton;\n    Renderer.EdgeRemoveButton = EdgeRemoveButton;\n    Renderer.EdgeRevertButton = EdgeRevertButton;\n    Renderer.MiniFrame = MiniFrame;\n    Renderer.Scene = Scene;\n\n    startRenkan();\n});\n\ndefine(\"main-renderer\", function(){});\n\n"]}